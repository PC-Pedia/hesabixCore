import{a as m,_ as R}from"./main-9b36f05f.js";import{h as _,a as i,o as F,c as P,w as s,b as t,d,t as k,s as G,C as $,F as j,e as q,A as z}from"./vendor-adef9cb4.js";const H=_({name:"registry",data:()=>({loading:!0,tab:null,settings:{canRegister:!0,canFreeAccounting:!1,smsPrice:"0",cloudPricePerGb:"0",unlimitedPrice:"0",accountingDocPrice:"0",giftCredit:"0",unlimitedDuration:[],smsAlertEnabled:!1,smsAlertMobile:"",autoUpdateTicketsEnabled:!1,autoUpdateTicketsInterval:24,sponsorMessage:"",footerLeft:"",footerRight:"",appName:"",appUrl:"",appSlogan:"",verifyMobileViaSms:!1},dialogVisible:!1,dialogMessage:"",dialogLoading:!1}),methods:{async loadData(){this.loading=!0;try{const u=await m.post("/api/admin/registry/settings/load");if(u.data.result===1){const n=u.data.data;this.settings={...this.settings,...n,smsPrice:this.formatNumber(n.smsPrice),cloudPricePerGb:this.formatNumber(n.cloudPricePerGb),unlimitedPrice:this.formatNumber(n.unlimitedPrice),accountingDocPrice:this.formatNumber(n.accountingDocPrice),giftCredit:this.formatNumber(n.giftCredit),appUrl:n.appUrl||"",appSlogan:n.appSlogan||"",verifyMobileViaSms:n.verifyMobileViaSms||!1},this.checkFreeAccounting()}const e=await m.get("/api/admin/cron/check-autoupdate-tickets");this.settings.autoUpdateTicketsEnabled=e.data.enabled,this.settings.autoUpdateTicketsInterval=e.data.interval||24}catch(u){console.error("Error loading data:",u)}finally{this.loading=!1}},async submit(){var e,n;if(!this.validateForm())return;this.dialogLoading=!0,this.dialogVisible=!0,this.dialogMessage="در حال ذخیره تنظیمات...";const u={...this.settings,smsPrice:this.parseNumber(this.settings.smsPrice),cloudPricePerGb:this.parseNumber(this.settings.cloudPricePerGb),unlimitedPrice:this.parseNumber(this.settings.unlimitedPrice),accountingDocPrice:this.parseNumber(this.settings.accountingDocPrice),giftCredit:this.parseNumber(this.settings.giftCredit),appUrl:this.settings.appUrl,appSlogan:this.settings.appSlogan,verifyMobileViaSms:this.settings.verifyMobileViaSms};try{let f=[(await m.post("/api/admin/registry/settings/save",u)).data.result===1?"تنظیمات با موفقیت ذخیره شد":"خطا در ذخیره تنظیمات"];if(this.settings.autoUpdateTicketsEnabled){const b=await m.post("/api/admin/cron/add-autoupdate-tickets",{interval:this.settings.autoUpdateTicketsInterval});f.push(b.data.message)}else{const b=await m.post("/api/admin/cron/remove-autoupdate-tickets");f.push(b.data.message)}this.dialogMessage=f.join(`
`)}catch(c){this.dialogMessage=((n=(e=c.response)==null?void 0:e.data)==null?void 0:n.message)||"خطایی رخ داد"}finally{this.dialogLoading=!1,this.loading=!1}},validateForm(){if(!this.settings.canFreeAccounting){const e=[{value:this.parseNumber(this.settings.accountingDocPrice),message:"قیمت هر سند حسابداری باید بزرگ‌تر از صفر باشد"},{value:this.parseNumber(this.settings.unlimitedPrice),message:"قیمت هر ماه استفاده نامحدود باید بزرگ‌تر از صفر باشد"},{value:this.settings.unlimitedDuration.length,message:"حداقل یکی از مدت زمان‌های بسته نامحدود باید انتخاب شود"}].find(n=>n.value<=0);if(e)return this.showErrorDialog(e.message),!1}return!0},async runTicketUpdate(){var u,e;this.dialogVisible=!0,this.dialogLoading=!0,this.dialogMessage="در حال بررسی تیکت‌ها...";try{const n=await m.post("/api/admin/cron/run-autoupdate-tickets");this.dialogMessage=n.data.message}catch(n){this.dialogMessage=((e=(u=n.response)==null?void 0:u.data)==null?void 0:e.message)||"خطایی در بررسی تیکت‌ها رخ داد"}finally{this.dialogLoading=!1}},showErrorDialog(u){this.dialogVisible=!0,this.dialogMessage=u,this.dialogLoading=!1},formatNumber(u){return u.toString().replace(/[^0-9]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")||"0"},parseNumber(u){return Number(u.replace(/,/g,""))||0},handleInput(u,e){this.settings[u]=this.formatNumber(e)},checkFreeAccounting(){this.settings.canFreeAccounting&&(this.settings.accountingDocPrice="0",this.settings.unlimitedPrice="0",this.settings.unlimitedDuration=[])},validateInterval(){this.settings.autoUpdateTicketsInterval<1&&(this.settings.autoUpdateTicketsInterval=1)}},watch:{"settings.canFreeAccounting"(u){this.checkFreeAccounting()}},beforeMount(){this.loadData()}});const J={style:{"white-space":"pre-line"}};function K(u,e,n,c,f,b){const h=i("v-toolbar-title"),y=i("v-spacer"),v=i("v-btn"),D=i("v-toolbar"),V=i("v-tab"),E=i("v-tabs"),g=i("v-switch"),a=i("v-col"),o=i("v-text-field"),r=i("v-row"),w=i("v-textarea"),p=i("v-card-text"),A=i("v-window-item"),U=i("v-card-title"),M=i("v-checkbox"),C=i("v-card"),I=i("v-window"),N=i("v-progress-circular"),S=i("v-card-actions"),T=i("v-dialog"),L=i("v-container");return F(),P(L,{fluid:"",class:"pa-0"},{default:s(()=>[t(D,{color:"toolbar"},{default:s(()=>[t(h,null,{default:s(()=>[d(k(u.$t("pages.manager.system_settings_registry")),1)]),_:1}),t(y),t(v,{icon:"mdi-content-save",color:"primary",loading:u.loading,onClick:u.submit},null,8,["loading","onClick"])]),_:1}),t(E,{modelValue:u.tab,"onUpdate:modelValue":e[0]||(e[0]=l=>u.tab=l),grow:""},{default:s(()=>[t(V,{value:"general"},{default:s(()=>e[29]||(e[29]=[d("تنظیمات عمومی")])),_:1}),t(V,{value:"pricing"},{default:s(()=>e[30]||(e[30]=[d("قیمت‌گذاری")])),_:1}),t(V,{value:"automation"},{default:s(()=>e[31]||(e[31]=[d("اتوماسیون")])),_:1})]),_:1},8,["modelValue"]),t(C,{loading:u.loading?"red":void 0,disabled:u.loading},{default:s(()=>[t(I,{modelValue:u.tab,"onUpdate:modelValue":e[26]||(e[26]=l=>u.tab=l)},{default:s(()=>[t(A,{value:"general"},{default:s(()=>[t(p,null,{default:s(()=>[t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(g,{modelValue:u.settings.canRegister,"onUpdate:modelValue":e[1]||(e[1]=l=>u.settings.canRegister=l),label:"فعال بودن ثبت‌نام کاربران جدید",color:"primary"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(g,{modelValue:u.settings.verifyMobileViaSms,"onUpdate:modelValue":e[2]||(e[2]=l=>u.settings.verifyMobileViaSms=l),label:"تایید شماره موبایل از طریق پیامک",color:"primary"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(g,{modelValue:u.settings.canFreeAccounting,"onUpdate:modelValue":e[3]||(e[3]=l=>u.settings.canFreeAccounting=l),label:"فعال بودن ثبت رایگان سند حسابداری",color:"primary"},null,8,["modelValue"])]),_:1}),t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(o,{modelValue:u.settings.appName,"onUpdate:modelValue":e[4]||(e[4]=l=>u.settings.appName=l),label:"اسم برنامه",hint:"این نام در بخش‌های مختلف نرم‌افزار مانند هدر و نمایش فاکتور برای مشتریان و ... نمایش داده می‌شود","persistent-hint":"",type:"text"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(o,{modelValue:u.settings.appUrl,"onUpdate:modelValue":e[5]||(e[5]=l=>u.settings.appUrl=l),label:"آدرس برنامه",hint:"آدرس URL برنامه","persistent-hint":"",type:"url"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"12",md:"4"},{default:s(()=>[t(o,{modelValue:u.settings.giftCredit,"onUpdate:modelValue":e[6]||(e[6]=l=>u.settings.giftCredit=l),label:"اعتبار هدیه به کسب‌و‌کار جدید (ریال)",type:"text",onInput:e[7]||(e[7]=l=>u.handleInput("giftCredit",l.target.value)),prefix:"₽"},null,8,["modelValue"])]),_:1})]),_:1}),t(a,{cols:"12",sm:"12",md:"12"},{default:s(()=>[t(o,{modelValue:u.settings.appSlogan,"onUpdate:modelValue":e[8]||(e[8]=l=>u.settings.appSlogan=l),label:"شعار برنامه",hint:"این شعار در بخش‌های مختلف نرم‌افزار نمایش داده می‌شود","persistent-hint":"",type:"text"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"12",md:"12"},{default:s(()=>[t(w,{modelValue:u.settings.sponsorMessage,"onUpdate:modelValue":e[9]||(e[9]=l=>u.settings.sponsorMessage=l),label:"پیام اسپانسر (نمایش در صفحه ورود به کسب و کار)",hint:"این پیام در صفحه لودینگ ورود به کسب و کار نمایش داده می‌شود","persistent-hint":"",rows:"4",class:"mt-4"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.footerLeft,"onUpdate:modelValue":e[10]||(e[10]=l=>u.settings.footerLeft=l),label:"پاورقی سمت چپ اسناد چاپی",type:"text"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.footerRight,"onUpdate:modelValue":e[11]||(e[11]=l=>u.settings.footerRight=l),label:"پاورقی سمت راست اسناد چاپی",type:"text"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(A,{value:"pricing"},{default:s(()=>[t(p,null,{default:s(()=>[t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.smsPrice,"onUpdate:modelValue":e[12]||(e[12]=l=>u.settings.smsPrice=l),label:"قیمت هر پیامک (ریال)",type:"text",onInput:e[13]||(e[13]=l=>u.handleInput("smsPrice",l.target.value)),prefix:"₽"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.cloudPricePerGb,"onUpdate:modelValue":e[14]||(e[14]=l=>u.settings.cloudPricePerGb=l),label:"قیمت هر گیگ/ماه فضای ابری (ریال)",type:"text",onInput:e[15]||(e[15]=l=>u.handleInput("cloudPricePerGb",l.target.value)),prefix:"₽"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.accountingDocPrice,"onUpdate:modelValue":e[16]||(e[16]=l=>u.settings.accountingDocPrice=l),label:"قیمت ثبت هر سند حسابداری (ریال)",type:"text",onInput:e[17]||(e[17]=l=>u.handleInput("accountingDocPrice",l.target.value)),prefix:"₽",disabled:u.settings.canFreeAccounting},null,8,["modelValue","disabled"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.unlimitedPrice,"onUpdate:modelValue":e[18]||(e[18]=l=>u.settings.unlimitedPrice=l),label:"قیمت هر ماه استفاده نامحدود (ریال)",type:"text",onInput:e[19]||(e[19]=l=>u.handleInput("unlimitedPrice",l.target.value)),prefix:"₽",disabled:u.settings.canFreeAccounting},null,8,["modelValue","disabled"])]),_:1}),t(a,{cols:"12"},{default:s(()=>[t(C,{flat:"",disabled:u.settings.canFreeAccounting},{default:s(()=>[t(U,null,{default:s(()=>e[32]||(e[32]=[d("مدت زمان بسته‌های نامحدود")])),_:1}),t(p,null,{default:s(()=>[t(r,null,{default:s(()=>[(F(),G(j,null,$(["1","3","6","12"],l=>t(a,{key:l,cols:"12",sm:"3"},{default:s(()=>[t(M,{modelValue:u.settings.unlimitedDuration,"onUpdate:modelValue":e[20]||(e[20]=B=>u.settings.unlimitedDuration=B),label:`${l} ماه`,value:l,disabled:u.settings.canFreeAccounting},null,8,["modelValue","label","value","disabled"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),t(A,{value:"automation"},{default:s(()=>[t(p,null,{default:s(()=>[t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"12",md:"6"},{default:s(()=>[t(C,{variant:"outlined",class:"pa-4 mb-4"},{default:s(()=>[t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"4"},{default:s(()=>[t(g,{modelValue:u.settings.smsAlertEnabled,"onUpdate:modelValue":e[21]||(e[21]=l=>u.settings.smsAlertEnabled=l),label:"هشدار پیامکی",color:"primary",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"8"},{default:s(()=>[t(o,{modelValue:u.settings.smsAlertMobile,"onUpdate:modelValue":e[22]||(e[22]=l=>u.settings.smsAlertMobile=l),label:"شماره موبایل پشتیبانی",disabled:!u.settings.smsAlertEnabled,type:"tel",placeholder:"09180000000",density:"comfortable"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{cols:"12",sm:"12",md:"6"},{default:s(()=>[t(C,{variant:"outlined",class:"pa-4 mb-4"},{default:s(()=>[t(r,null,{default:s(()=>[t(a,{cols:"12",sm:"6"},{default:s(()=>[t(g,{modelValue:u.settings.autoUpdateTicketsEnabled,"onUpdate:modelValue":e[23]||(e[23]=l=>u.settings.autoUpdateTicketsEnabled=l),label:"به‌روزرسانی خودکار تیکت‌ها",color:"primary",density:"comfortable"},null,8,["modelValue"])]),_:1}),t(a,{cols:"12",sm:"6"},{default:s(()=>[t(o,{modelValue:u.settings.autoUpdateTicketsInterval,"onUpdate:modelValue":e[24]||(e[24]=l=>u.settings.autoUpdateTicketsInterval=l),modelModifiers:{number:!0},label:"فاصله زمانی (ساعت)",type:"number",min:"1",onInput:u.validateInterval,disabled:!u.settings.autoUpdateTicketsEnabled,density:"comfortable"},null,8,["modelValue","onInput","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{cols:"12",class:"text-center"},{default:s(()=>[t(v,{onClick:e[25]||(e[25]=l=>u.runTicketUpdate()),color:"secondary","prepend-icon":"mdi-refresh",loading:u.dialogLoading,class:"mt-4"},{default:s(()=>e[33]||(e[33]=[d(" بررسی فوری تیکت‌ها ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["loading","disabled"]),t(T,{modelValue:u.dialogVisible,"onUpdate:modelValue":e[28]||(e[28]=l=>u.dialogVisible=l),"max-width":"500px"},{default:s(()=>[t(C,null,{default:s(()=>[t(U,null,{default:s(()=>e[34]||(e[34]=[d("نتیجه عملیات")])),_:1}),t(p,null,{default:s(()=>[q("p",J,k(u.dialogMessage),1),u.dialogLoading?(F(),P(N,{key:0,indeterminate:"",color:"primary"})):z("",!0)]),_:1}),t(S,null,{default:s(()=>[t(y),t(v,{color:"primary",text:"",onClick:e[27]||(e[27]=l=>u.dialogVisible=!1),disabled:u.dialogLoading},{default:s(()=>e[35]||(e[35]=[d(" بستن ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const W=R(H,[["render",K],["__scopeId","data-v-e1a17a38"]]);export{W as default};
