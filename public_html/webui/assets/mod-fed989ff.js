import{_ as $,L as j,a as b,S as k}from"./main-9b36f05f.js";import"./vue-persian-datetime-picker.common-0e5ba5b7.js";import{A as N}from"./archiveUpload-31fb560b.js";import{T as Y}from"./vue3-treeselect.common-f8cf97d9.js";/* empty css                        */import{q as M}from"./quickAdd-3f821e67.js";import{a as f,o as r,s as u,e as o,b as m,w as _,d as i,c as A,A as V,u as v,ab as y,t as p,F as C,C as w,_ as U}from"./vendor-adef9cb4.js";const L={name:"mod",components:{Loading:j,Treeselect:Y,archiveUpload:N,quickAdd:M},data:()=>({isLoading:!1,canSubmit:!1,updateID:null,sum:0,balance:0,listPersons:[],listscosts:[],listBanks:[],listCashdesks:[],listSalarys:[],persons:[],costs:[],banks:[],salarys:[],cashdesks:[],year:"",currencyConfig:{masked:!1,prefix:"",suffix:"ریال",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0},data:{date:"",des:""}}),beforeMount(){this.loadData()},beforeRouteUpdate(t,s){this.loadData(t.params.id)},methods:{calc(){this.sum=0,this.costs.forEach(s=>{this.sum=parseInt(this.sum)+parseInt(s.amount)});let t=0;this.banks.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.salarys.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.cashdesks.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.persons.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.balance=parseInt(this.sum)-parseInt(t),this.funcCanSubmit()},funcCanSubmit(){parseInt(this.balance)==0&&this.sum>0?this.canSubmit=!0:this.canSubmit=!1},addItem(){this.costs.push({id:this.costs[1],amount:"",des:""})},removeItem(t){this.costs.splice(t,1)},addBank(){this.banks.push({person:null,amount:"",des:""})},removeBank(t){this.banks.splice(t,1)},addCashdesk(){this.cashdesks.push({person:"",amount:"",des:""})},removeCashdesk(t){this.cashdesks.splice(t,1)},addSalary(){this.salarys.push({person:"",amount:"",des:""})},removeSalary(t){this.salarys.splice(t,1)},addPerson(){this.persons.push({person:"",amount:"",des:""})},removePerson(t){this.persons.splice(t,1)},searchPerson(t,s){s(!0),b.post("/api/person/list/search",{search:t}).then(h=>{this.listPersons=h.data,s(!1)})},loadData(){this.$route.params.id?(this.updateID=this.$route.params.id,b.post("/api/accounting/doc/get",{code:this.updateID}).then(t=>{this.data.des=t.data.doc.des,this.data.date=t.data.doc.date,t.data.rows.forEach(s=>{s.type=="calc"?this.costs.push({id:s.refCode,amount:s.bd,des:s.des}):s.type=="bank"?this.banks.push({id:s.bank,amount:s.bs,des:s.des}):s.type=="cashdesk"?this.cashdesks.push({id:s.cashdesk,amount:s.bs,des:s.des}):s.type=="salary"?this.salarys.push({id:s.salary,amount:s.bs,des:s.des}):s.type=="person"&&this.persons.push({id:s.person,amount:s.bs,des:s.des})})})):(this.addBank(),this.addItem(),b.post("/api/year/get").then(t=>{this.year=t.data,this.data.date=t.data.now})),b.post("/api/accounting/table/childs/cost").then(t=>{this.listscosts=t.data}),b.post("/api/bank/list").then(t=>{this.listBanks=t.data}),b.post("/api/cashdesk/list").then(t=>{this.listCashdesks=t.data}),b.post("/api/salary/list").then(t=>{this.listSalarys=t.data}),b.post("/api/person/list/search").then(t=>{this.listPersons=t.data})},save(){let t=!1;this.costs.forEach(d=>{(d.amount==null||d.amount==0)&&(k.fire({text:"مبلغ صفر نامعتبر است",icon:"error",confirmButtonText:"قبول"}),t=!0)}),this.costs.length==0&&k.fire({text:"انتخاب حداقل یک مرکز هزینه الزامی است.",icon:"error",confirmButtonText:"قبول"});let s=!0;this.banks.forEach(d=>{(d.id==null||d.id=="")&&(s=!1)}),this.salarys.forEach(d=>{(d.id==null||d.id=="")&&(s=!1)}),this.cashdesks.forEach(d=>{(d.id==null||d.id=="")&&(s=!1)}),this.persons.forEach(d=>{(d.id==null||d.id=="")&&(s=!1)}),s==!1&&k.fire({text:"یکی از طرف‌های حساب انتخاب نشده است.",icon:"error",confirmButtonText:"قبول"});let h=!0;if(this.costs.forEach(d=>{(d.id==null||d.id=="")&&(h=!1)}),h==!1&&k.fire({text:"یکی از مراکز هزینه انتخاب نشده است.",icon:"error",confirmButtonText:"قبول"}),h&&s&&!t){let d=[];this.data.des==""&&(this.data.des="هزینه‌ها"),this.costs.forEach(a=>{a.des==""&&(a.des="هزینه"),d.push({id:a.id,bs:0,bd:parseInt(a.amount),des:a.des,type:"calc",table:a.id})}),this.banks.forEach(a=>{a.des==""&&(a.des="هزینه"),d.push({id:a.id.id,bs:parseInt(a.amount),bd:0,des:a.des,type:"bank",table:5})}),this.salarys.forEach(a=>{a.des==""&&(a.des="هزینه"),d.push({id:a.id.id,bs:parseInt(a.amount),bd:0,des:a.des,type:"salary",table:124})}),this.cashdesks.forEach(a=>{a.des==""&&(a.des="هزینه"),d.push({id:a.id.id,bs:parseInt(a.amount),bd:0,des:a.des,type:"cashdesk",table:123})}),this.persons.forEach(a=>{a.des==""&&(a.des="هزینه"),d.push({id:a.id.id,bs:parseInt(a.amount),bd:0,des:a.des,type:"person",table:3})}),b.post("/api/accounting/insert",{update:this.updateID,date:this.data.date,type:"cost",des:this.data.des,rows:d}).then(a=>{a.data.result==1?k.fire({text:"سند ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(n=>{n.isConfirmed&&this.$router.push("/acc/costs/list")}):a.data.result=="4"&&k.fire({text:a.data.msg,icon:"error",confirmButtonText:"قبول"})})}}}},q={class:"block block-content-full"},R={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},F={class:"block-title text-primary-dark"},K={class:"block-options"},z={class:"dropdown me-2"},G={"aria-labelledby":"dropdown-dropup-secondary",class:"border border-danger dropdown-menu",style:{}},H=["disabled"],J={class:"block-content py-3 px-0 vl-parent"},Q={class:"container"},W={class:"row mb-2 px-1"},X={class:"col-sm-12 col-md-6"},Z={class:"col-sm-12 col-md-6"},ss={class:"row border border-danger rounded-1 mx-1 mb-2"},os={class:"col-6"},ts={class:"text-danger"},ls={class:"col-6"},es={class:"text-danger"},as={class:"row"},ns={class:"col-sm-12 col-md-12"},ds={class:"block block-rounded border border-gray"},is={class:"block-header bg-default-dark py-1"},rs={class:"block-title"},us={class:"text-white"},cs={class:"text-danger mx-2"},ms={class:"block-options"},ps=["onClick"],bs={class:"block-content-sm mx-2"},fs={class:"row mb-1"},hs={class:"col-sm-12 col-md-4"},ks={class:"col-sm-12 col-md-4"},vs={class:"col-sm-12 col-md-4"},ys=["onUpdate:modelValue"],gs={class:"col-sm-12 col-md-12 mt-2"},_s={class:"block block-rounded border border-gray"},Vs={class:"block-header bg-light py-1"},Cs={class:"block-title"},ws={class:"text-black"},Us={class:"mx-2"},Is={class:"block-options"},xs=["onClick"],Ss={class:"block-content-sm mx-2"},Bs={class:"row mb-1"},Es={class:"col-sm-12 col-md-4"},Ds={class:"col-sm-12 col-md-4"},Ts={class:"col-sm-12 col-md-4"},Os=["onUpdate:modelValue"],Ps={class:"col-sm-12 col-md-12"},$s={class:"block block-rounded border border-gray"},js={class:"block-header bg-light py-1"},Ns={class:"block-title"},Ys={class:"text-black"},Ms={class:"mx-2"},As={class:"block-options"},Ls=["onClick"],qs={class:"block-content-sm mx-2"},Rs={class:"row mb-1"},Fs={class:"col-sm-12 col-md-4"},Ks={class:"col-sm-12 col-md-4"},zs={class:"col-sm-12 col-md-4"},Gs=["onUpdate:modelValue"],Hs={class:"col-sm-12 col-md-12"},Js={class:"block block-rounded border border-gray"},Qs={class:"block-header bg-light py-1"},Ws={class:"block-title"},Xs={class:"text-black"},Zs={class:"mx-2"},so={class:"block-options"},oo=["onClick"],to={class:"block-content-sm mx-2"},lo={class:"row mb-1"},eo={class:"col-sm-12 col-md-4"},ao={class:"col-sm-12 col-md-4"},no={class:"col-sm-12 col-md-4"},io=["onUpdate:modelValue"],ro={class:"col-sm-12 col-md-12"},uo={class:"block block-rounded border border-gray"},co={class:"block-header bg-light py-1"},mo={class:"block-title"},po={class:"text-black"},bo={class:"mx-2"},fo={class:"block-options"},ho=["onClick"],ko={class:"block-content-sm mx-2"},vo={class:"row mb-1"},yo={class:"col-sm-12 col-md-4"},go={class:"row mb-1"},_o={class:"col-12"},Vo={class:"col-12"},Co={class:"row"},wo={key:0,class:"col-6"},Uo={key:1,class:"col-6"},Io={key:0,class:""},xo={key:1,class:""},So={class:"col-sm-12 col-md-4"},Bo={class:"col-sm-12 col-md-4"},Eo=["onUpdate:modelValue"];function Do(t,s,h,d,a,n){const B=f("router-link"),E=f("archive-upload"),D=f("loading"),T=f("date-picker"),O=f("treeselect"),g=f("money3"),I=f("v-cob"),P=f("quickAdd");return r(),u("div",q,[o("div",R,[o("h3",F,[m(B,{class:"text-warning mx-2 px-2",to:"/acc/costs/list"},{default:_(()=>s[23]||(s[23]=[o("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),_:1}),s[24]||(s[24]=i(" هزینه "))]),o("div",K,[this.$route.params.id!=""?(r(),A(E,{key:0,docid:this.$route.params.id,doctype:"cost",cat:"cost"},null,8,["docid"])):V("",!0),o("div",z,[s[30]||(s[30]=o("button",{"aria-expanded":"false","aria-haspopup":"true",class:"btn btn-sm btn-danger dropdown-toggle","data-bs-toggle":"dropdown",type:"button"}," افزودن حساب ",-1)),o("div",G,[o("button",{onClick:s[0]||(s[0]=e=>n.addItem()),type:"button",class:"dropdown-item"},s[25]||(s[25]=[o("i",{class:"fa fa-plus"},null,-1),i(" مرکز هزینه ")])),o("button",{onClick:s[1]||(s[1]=e=>n.addBank()),type:"button",class:"dropdown-item"},s[26]||(s[26]=[o("i",{class:"fa fa-bank"},null,-1),i(" حساب بانکی ")])),o("button",{onClick:s[2]||(s[2]=e=>n.addCashdesk()),type:"button",class:"dropdown-item",href:"javascript:void(0)"},s[27]||(s[27]=[o("i",{class:"fa fa-money-bill-wheat"},null,-1),i(" صندوق ")])),o("button",{onClick:s[3]||(s[3]=e=>n.addSalary()),type:"button",class:"dropdown-item",href:"javascript:void(0)"},s[28]||(s[28]=[o("i",{class:"fa fa-dot-circle"},null,-1),i(" تنخواه گردان ")])),o("button",{onClick:s[4]||(s[4]=e=>n.addPerson()),type:"button",class:"dropdown-item",href:"javascript:void(0)"},s[29]||(s[29]=[o("i",{class:"fa fa-person"},null,-1),i(" شخص ")]))])]),o("button",{disabled:this.canSubmit!=!0,onClick:s[5]||(s[5]=e=>n.save()),type:"button",class:"btn btn-sm btn-alt-primary"},s[31]||(s[31]=[o("i",{class:"fa fa-save"},null,-1),i(" ثبت ")]),8,H)])]),o("div",J,[m(D,{color:"blue",loader:"dots",active:t.isLoading,"onUpdate:active":s[6]||(s[6]=e=>t.isLoading=e),"is-full-page":!1},null,8,["active"]),o("div",Q,[o("div",W,[o("div",X,[m(T,{class:"",modelValue:t.data.date,"onUpdate:modelValue":s[7]||(s[7]=e=>t.data.date=e),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:t.year.start,max:t.year.end},null,8,["modelValue","min","max"])]),o("div",Z,[v(o("input",{placeholder:"شرح","onUpdate:modelValue":s[8]||(s[8]=e=>t.data.des=e),class:"form-control form-control-sm",type:"text"},null,512),[[y,t.data.des]])])]),o("div",ss,[o("div",os,[s[32]||(s[32]=i(" مجموع : ")),o("span",ts,p(t.$filters.formatNumber(t.sum)),1)]),o("div",ls,[s[33]||(s[33]=i(" باقی‌مانده: ")),o("span",es,p(t.$filters.formatNumber(t.balance)),1)])]),o("div",as,[(r(!0),u(C,null,w(t.costs,(e,c)=>(r(),u("div",ns,[o("div",ds,[o("div",is,[o("h3",rs,[o("small",us,[o("span",cs,p(c+1),1),s[34]||(s[34]=o("i",{class:"fa fa-ticket"},null,-1)),s[35]||(s[35]=i(" مرکز هزینه "))])]),o("span",ms,[o("button",{title:"حذف",class:"btn-block-option text-white ps-2",onClick:l=>n.removeItem(c)},s[36]||(s[36]=[o("i",{class:"fa fa-trash"},null,-1)]),8,ps)])]),o("div",bs,[o("div",fs,[o("div",hs,[s[37]||(s[37]=o("small",{class:"mb-2"},"مرکز هزینه",-1)),m(O,{"disable-branch-nodes":!0,modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,multiple:!1,options:t.listscosts,placeholder:"انتخاب  مرکز هزینه",noOptionsText:"آیتمی انتخاب نشده است.",noChildrenText:"فاقد زیرمجموعه",noResultsText:"نتیجه‌ای یافت نشد"},null,8,["modelValue","onUpdate:modelValue","options"])]),o("div",ks,[s[38]||(s[38]=o("small",{class:"mb-2"},"مبلغ",-1)),m(g,U({onChange:s[9]||(s[9]=l=>n.calc()),class:"form-control form-control-sm",modelValue:e.amount,"onUpdate:modelValue":l=>e.amount=l,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])]),o("div",vs,[s[39]||(s[39]=o("small",null,"شرح",-1)),v(o("input",{"onUpdate:modelValue":l=>e.des=l,type:"text",class:"form-control form-control-sm"},null,8,ys),[[y,e.des]])])])])])]))),256)),(r(!0),u(C,null,w(t.banks,(e,c)=>(r(),u("div",gs,[o("div",_s,[o("div",Vs,[o("h3",Cs,[o("small",ws,[o("span",Us,p(c+1),1),s[40]||(s[40]=o("i",{class:"fa fa-bank"},null,-1)),s[41]||(s[41]=i(" حساب بانکی "))])]),o("span",Is,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:l=>n.removeBank(c)},s[42]||(s[42]=[o("i",{class:"fa fa-trash"},null,-1)]),8,xs)])]),o("div",Ss,[o("div",Bs,[o("div",Es,[s[44]||(s[44]=o("small",{class:"mb-2"},"بانک",-1)),m(I,{dir:"rtl",options:t.listBanks,label:"name",modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,"onOption:deselecting":s[10]||(s[10]=l=>n.funcCanSubmit()),"onSearch:focus":s[11]||(s[11]=l=>n.funcCanSubmit()),"onOption:selecting":s[12]||(s[12]=l=>n.funcCanSubmit())},{"no-options":_(({search:l,searching:x,loading:S})=>s[43]||(s[43]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",Ds,[s[45]||(s[45]=o("small",{class:"mb-2"},"مبلغ",-1)),m(g,U({onChange:s[13]||(s[13]=l=>n.calc()),class:"form-control form-control-sm",modelValue:e.amount,"onUpdate:modelValue":l=>e.amount=l,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])]),o("div",Ts,[s[46]||(s[46]=o("small",null,"شرح",-1)),v(o("input",{"onUpdate:modelValue":l=>e.des=l,type:"text",class:"form-control form-control-sm"},null,8,Os),[[y,e.des]])])])])])]))),256)),(r(!0),u(C,null,w(t.salarys,(e,c)=>(r(),u("div",Ps,[o("div",$s,[o("div",js,[o("h3",Ns,[o("small",Ys,[o("span",Ms,p(c+1),1),s[47]||(s[47]=o("i",{class:"fa fa-dot-circle"},null,-1)),s[48]||(s[48]=i(" تنخواه گردان "))])]),o("span",As,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:l=>n.removeSalary(c)},s[49]||(s[49]=[o("i",{class:"fa fa-trash"},null,-1)]),8,Ls)])]),o("div",qs,[o("div",Rs,[o("div",Fs,[s[51]||(s[51]=o("small",{class:"mb-2"},"تنخواه گردان",-1)),m(I,{dir:"rtl",options:t.listSalarys,label:"name",modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,"onOption:deselecting":s[14]||(s[14]=l=>n.funcCanSubmit()),"onSearch:focus":s[15]||(s[15]=l=>n.funcCanSubmit()),"onOption:selecting":s[16]||(s[16]=l=>n.funcCanSubmit())},{"no-options":_(({search:l,searching:x,loading:S})=>s[50]||(s[50]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",Ks,[s[52]||(s[52]=o("small",{class:"mb-2"},"مبلغ",-1)),m(g,U({onChange:s[17]||(s[17]=l=>n.calc()),class:"form-control form-control-sm",modelValue:e.amount,"onUpdate:modelValue":l=>e.amount=l,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])]),o("div",zs,[s[53]||(s[53]=o("small",null,"شرح",-1)),v(o("input",{"onUpdate:modelValue":l=>e.des=l,type:"text",class:"form-control form-control-sm"},null,8,Gs),[[y,e.des]])])])])])]))),256)),(r(!0),u(C,null,w(t.cashdesks,(e,c)=>(r(),u("div",Hs,[o("div",Js,[o("div",Qs,[o("h3",Ws,[o("small",Xs,[o("span",Zs,p(c+1),1),s[54]||(s[54]=o("i",{class:"fa fa-money-bill-wheat"},null,-1)),s[55]||(s[55]=i(" صندوق "))])]),o("span",so,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:l=>n.removeCashdesk(c)},s[56]||(s[56]=[o("i",{class:"fa fa-trash"},null,-1)]),8,oo)])]),o("div",to,[o("div",lo,[o("div",eo,[s[58]||(s[58]=o("small",{class:"mb-2"},"صندوق",-1)),m(I,{dir:"rtl",options:t.listCashdesks,label:"name",modelValue:e.id,"onUpdate:modelValue":l=>e.id=l,"onOption:deselecting":s[18]||(s[18]=l=>n.funcCanSubmit()),"onSearch:focus":s[19]||(s[19]=l=>n.funcCanSubmit()),"onOption:selecting":s[20]||(s[20]=l=>n.funcCanSubmit())},{"no-options":_(({search:l,searching:x,loading:S})=>s[57]||(s[57]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",ao,[s[59]||(s[59]=o("small",{class:"mb-2"},"مبلغ",-1)),m(g,U({onChange:s[21]||(s[21]=l=>n.calc()),class:"form-control form-control-sm",modelValue:e.amount,"onUpdate:modelValue":l=>e.amount=l,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])]),o("div",no,[s[60]||(s[60]=o("small",null,"شرح",-1)),v(o("input",{"onUpdate:modelValue":l=>e.des=l,type:"text",class:"form-control form-control-sm"},null,8,io),[[y,e.des]])])])])])]))),256)),(r(!0),u(C,null,w(t.persons,(e,c)=>(r(),u("div",ro,[o("div",uo,[o("div",co,[o("h3",mo,[o("small",po,[o("span",bo,p(c+1),1),s[61]||(s[61]=o("i",{class:"fa fa-person"},null,-1)),s[62]||(s[62]=i(" شخص "))])]),o("span",fo,[m(P,{code:0}),o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:l=>n.removePerson(c)},s[63]||(s[63]=[o("i",{class:"fa fa-trash"},null,-1)]),8,ho)])]),o("div",ko,[o("div",vo,[o("div",yo,[s[67]||(s[67]=o("small",{class:"mb-2"},"شخص",-1)),m(I,{filterable:!1,onSearch:n.searchPerson,class:"",dir:"rtl",options:t.listPersons,label:"nikename",modelValue:e.id,"onUpdate:modelValue":l=>e.id=l},{option:_(l=>[o("div",go,[o("div",_o,[s[64]||(s[64]=o("i",{class:"fa fa-user me-2"},null,-1)),i(" "+p(l.nikename),1)]),o("div",Vo,[o("div",Co,[l.mobile!=""?(r(),u("div",wo,[s[65]||(s[65]=o("i",{class:"fa fa-phone me-2"},null,-1)),i(" "+p(l.mobile),1)])):V("",!0),parseInt(l.bs)-parseInt(l.bd)!=0?(r(),u("div",Uo,[s[66]||(s[66]=o("i",{class:"fa fa-bars"},null,-1)),i(" تراز: "+p(t.$filters.formatNumber(Math.abs(parseInt(l.bs)-parseInt(l.bd))))+" ",1),parseInt(l.bs)-parseInt(l.bd)<0?(r(),u("span",Io," بدهکار ")):V("",!0),parseInt(l.bs)-parseInt(l.bd)>0?(r(),u("span",xo," بستانکار ")):V("",!0)])):V("",!0)])])])]),_:2},1032,["onSearch","options","modelValue","onUpdate:modelValue"])]),o("div",So,[s[68]||(s[68]=o("small",{class:"mb-2"},"مبلغ",-1)),m(g,U({onChange:s[22]||(s[22]=l=>n.calc()),class:"form-control form-control-sm",modelValue:e.amount,"onUpdate:modelValue":l=>e.amount=l,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])]),o("div",Bo,[s[69]||(s[69]=o("small",null,"شرح",-1)),v(o("input",{"onUpdate:modelValue":l=>e.des=l,type:"text",class:"form-control form-control-sm"},null,8,Eo),[[y,e.des]])])])])])]))),256))])])])])}const Mo=$(L,[["render",Do]]);export{Mo as default};
