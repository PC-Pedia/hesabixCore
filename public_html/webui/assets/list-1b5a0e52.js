import{_ as T,S as p,a as h}from"./main-9b36f05f.js";import{r as S,a as V,o as d,s as u,e,u as m,au as O,ao as g,d as i,F as x,C,b as v,w as r,ab as B,t as n,A as w}from"./vendor-adef9cb4.js";const A={name:"list",data:()=>({printOptions:{pays:!0,note:!0,bidInfo:!0,taxInfo:!0,discountInfo:!0,selectedPrintCode:0,paper:"A4-L"},sumSelected:0,sumTotal:0,itemsSelected:[],searchValue:"",types:[],loading:S(!0),items:[],orgItems:[],headers:[{text:"عملیات",value:"operation"},{text:"فاکتور",value:"code",sortable:!0},{text:"تاریخ",value:"date",sortable:!0},{text:"خریدار",value:"person",sortable:!0},{text:"تخفیف",value:"discountAll",sortable:!0},{text:"حمل و نقل",value:"transferCost",sortable:!0},{text:"مبلغ",value:"amount",sortable:!0},{text:"پرداختی",value:"relatedDocsCount",sortable:!0},{text:"برچسب",value:"label",width:100},{text:"شرح",value:"des",sortable:!0}]}),methods:{changeLabel(s){this.itemsSelected.length==0?p.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):(this.loading=!0,h.post("/api/rfbuy/label/change",{items:this.itemsSelected,label:s}).then(t=>{this.loading==!1,t.data.code==0?(p.fire({text:"فاکتور‌ها با موفقیت ویرایش شد.",icon:"success",confirmButtonText:"قبول"}),this.itemsSelected=[]):t.data.result==2&&p.fire({text:t.data.message,icon:"warning",confirmButtonText:"قبول"}),this.loadData()}))},filterTable(){this.loading=!0;let s=[],t=!0,a=[];this.types.forEach(l=>{l.checked==!0&&(t=!1,a.push(l))}),t?this.items=this.orgItems:(this.orgItems.forEach(l=>{a.forEach(y=>{if(l.label&&y.code==l.label.code){let c=!1;s.forEach(k=>{l.label.code==k.code&&(c=!0)}),c==!1&&s.push(l)}})}),this.items=s),this.loading=!1},loadData(){h.post("/api/printers/options/info").then(s=>{this.printOptions=s.data.rfbuy}),h.post("/api/invoice/types",{type:"rfbuy"}).then(s=>{this.types=s.data}),h.post("/api/rfbuy/docs/search",{type:"rfbuy"}).then(s=>{this.items=s.data,this.orgItems=s.data,this.items.forEach(t=>{this.sumTotal+=parseInt(t.amount)}),this.loading=!1})},canEditItem(s){this.loading=!0,h.post("/api/rfbuy/edit/can/"+s).then(t=>{this.loading=!1,t.data.result==!1?p.fire({text:"این فاکتور به دلیل وجود اسناد پرداخت یا حواله های انبار مرتبط با آن قابل ویرایش نیست",confirmButtonText:"قبول",icon:"error"}):this.$router.push("/acc/rfbuy/mod/"+s)})},deleteItems(){this.itemsSelected.length==0?p.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):p.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(s=>{s.isConfirmed&&(this.loading=!0,h.post("/api/accounting/remove/group",{items:this.itemsSelected}).then(t=>{this.loading=!1,t.data.result==1?(this.loadData(),p.fire({text:"فاکتور ها با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})):t.data.result==2&&p.fire({text:t.data.message,icon:"warning",confirmButtonText:"قبول"})}))})},printInvoice(s=!0,t=!0){this.loading=!0,h.post("/api/rfbuy/print/invoice",{code:this.printOptions.selectedPrintCode,pdf:s,printers:t,printOptions:this.printOptions}).then(a=>{this.loading=!1,window.open(this.$API_URL+"/front/print/"+a.data.id,"_blank","noreferrer")})},deleteItem(s){p.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(t=>{t.isConfirmed&&h.post("/api/accounting/remove",{code:s}).then(a=>{if(a.data.result==1){let l=0;for(let y=0;y<this.items.length;y++)l++,this.items[y].code==s&&this.items.splice(l-1,1);p.fire({text:"فاکتور برگشت از خرید با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})}else a.data.result==2&&p.fire({text:a.data.message,icon:"warning",confirmButtonText:"قبول"})})})}},beforeMount(){this.loadData()},watch:{itemsSelected:{handler:function(s,t){this.sumSelected=0,this.itemsSelected.forEach(a=>{typeof a.amount.valueOf()=="string"?this.sumSelected+=parseInt(a.amount.replaceAll(",","")):this.sumSelected+=a.amount})},deep:!0},searchValue:{handler:function(s,t){if(this.searchValue=="")this.items=this.orgItems;else{let a=[];this.orgItems.forEach(l=>{(l.person.nikename.includes(this.searchValue)||l.date.includes(this.searchValue)||l.amount.toString().includes(this.searchValue)||l.des.includes(this.searchValue)||l.code.includes(this.searchValue)||l.label&&l.label.label.includes(this.searchValue))&&a.push(l)}),this.items=a}},deep:!1}}},$={class:"modal fade",id:"printModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"printModalLabel","aria-hidden":"true"},M={class:"modal-dialog"},U={class:"modal-content"},E={class:"modal-body"},N={class:"form-floating mb-2"},D={class:"form-check form-switch"},L={class:"form-check form-switch"},P={class:"form-check form-switch"},F={class:"form-check form-switch"},z={class:"form-check form-switch"},_={class:"modal-footer"},j={class:"block block-content-full"},R={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},q={class:"block-title text-primary-dark"},G={class:"block-options"},H={class:"dropdown-center block-options-item"},J={"aria-labelledby":"dropdown-align-center-outline-primary",class:"dropdown-menu dropdown-menu-end",style:{}},K=["onClick"],Q={class:"block-content pt-1 pb-3"},W={class:"row"},X={class:"col-sm-12 col-md-12 m-0 p-0"},Y={class:"mb-1"},Z={class:"input-group input-group-sm"},tt={class:"dropdown-menu dropdown-menu-end"},et={class:"form-check"},st=["onUpdate:modelValue"],ot={class:"form-check-label"},lt={class:"col-sm-12 col-md-12 border rounded mb-2 px-2 py-1 d-none d-sm-block"},at={class:"form-check form-check-inline"},nt=["onUpdate:modelValue"],it={class:"form-check-label"},rt={class:"dropdown-center"},dt={"aria-labelledby":"dropdown-align-center-outline-primary",class:"dropdown-menu dropdown-menu-end",style:{}},ut=["onClick"],ct=["onClick"],pt=["onClick"],ft={key:0},mt={key:0,class:"text-success"},bt={key:1,class:"text-danger"},ht={key:2,class:"text-info"},kt={key:0,class:"text-success"},gt={class:"text-dark"},yt={class:"text-dark"},vt={class:"text-dark"},wt={class:"container-fluid p-0 mx-0 my-3"},xt={class:"block block-rounded block-link-shadow border-start border-success border-3",href:"javascript:void(0)"},Ct={class:"block-content block-content-full block-content-sm bg-body-light"},Vt={class:"row"},It={class:"col-sm-6 com-md-6"},Tt={class:"text-primary"},St={class:"col-sm-6 com-md-6"},Ot={class:"text-primary"};function Bt(s,t,a,l,y,c){const k=V("router-link"),I=V("EasyDataTable");return d(),u(x,null,[e("div",$,[e("div",M,[e("div",U,[t[23]||(t[23]=e("div",{class:"modal-header bg-primary-light text-white"},[e("h1",{class:"modal-title fs-5",id:"printModalLabel"},"چاپ فاکتور"),e("div",{class:"block-options"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})])],-1)),e("div",E,[t[21]||(t[21]=e("p",{class:"mb-2"},"برای تغییر تنظیمات پیشفرض به بخش تنظیمات چاپ مراجعه نمایید",-1)),e("div",N,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.printOptions.paper=o),class:"form-select"},t[14]||(t[14]=[e("option",{value:"A4-L"},"A4 افقی",-1),e("option",{value:"A4"},"A4 عمودی",-1),e("option",{value:"A5-L"},"A5 افقی",-1),e("option",{value:"A5"},"A5 عمودی",-1)]),512),[[O,s.printOptions.paper]]),t[15]||(t[15]=e("label",null,"سایز کاغذ و حالت چاپ",-1))]),e("div",D,[m(e("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=o=>s.printOptions.bidInfo=o),type:"checkbox"},null,512),[[g,s.printOptions.bidInfo]]),t[16]||(t[16]=e("label",{class:"form-check-label"},"اطلاعات کسب‌وکار",-1))]),e("div",L,[m(e("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=o=>s.printOptions.pays=o),type:"checkbox"},null,512),[[g,s.printOptions.pays]]),t[17]||(t[17]=e("label",{class:"form-check-label"},"نمایش پرداخت‌های فاکتور",-1))]),e("div",P,[m(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=o=>s.printOptions.note=o),type:"checkbox"},null,512),[[g,s.printOptions.note]]),t[18]||(t[18]=e("label",{class:"form-check-label"},"یاداشت پایین فاکتور",-1))]),e("div",F,[m(e("input",{class:"form-check-input","onUpdate:modelValue":t[4]||(t[4]=o=>s.printOptions.taxInfo=o),type:"checkbox"},null,512),[[g,s.printOptions.taxInfo]]),t[19]||(t[19]=e("label",{class:"form-check-label"},"مالیات به تفکیک اقلام",-1))]),e("div",z,[m(e("input",{class:"form-check-input","onUpdate:modelValue":t[5]||(t[5]=o=>s.printOptions.discountInfo=o),type:"checkbox"},null,512),[[g,s.printOptions.discountInfo]]),t[20]||(t[20]=e("label",{class:"form-check-label"},"تخفیف به تفکیک اقلام",-1))])]),e("div",_,[e("button",{class:"btn btn-primary mx-2",onClick:t[6]||(t[6]=o=>c.printInvoice()),type:"button"},t[22]||(t[22]=[e("i",{class:"si si-printer me-1"},null,-1),e("span",{class:""},"چاپ",-1)]))])])])]),e("div",j,[e("div",R,[e("h3",q,[e("button",{onClick:t[7]||(t[7]=o=>s.$router.back()),type:"button",class:"float-start d-none d-sm-none d-md-block btn btn-sm btn-link text-warning"},t[24]||(t[24]=[e("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),t[25]||(t[25]=e("i",{class:"fa fa-book"},null,-1)),t[26]||(t[26]=i(" فاکتورهای برگشت از خرید "))]),e("div",G,[e("div",H,[t[31]||(t[31]=e("button",{"aria-expanded":"false","aria-haspopup":"true",class:"btn btn-sm btn-link","data-bs-toggle":"dropdown",id:"dropdown-align-center-alt-primary",type:"button"},[e("i",{class:"fa-solid fa-ellipsis"})],-1)),e("div",J,[(d(!0),u(x,null,C(s.types,o=>(d(),u("button",{class:"dropdown-item",onClick:f=>c.changeLabel(o)},[t[27]||(t[27]=e("i",{class:"fa fa-undo text-dark pe-2"},null,-1)),i(" تغییر به "+n(o.label),1)],8,K))),256)),e("button",{class:"dropdown-item text-danger",onClick:t[8]||(t[8]=o=>c.changeLabel("clear"))},t[28]||(t[28]=[e("i",{class:"fa fa-undo pe-2"},null,-1),i(" حذف برچسب‌ها ")])),t[30]||(t[30]=e("hr",{class:"dropdown-divider"},null,-1)),e("button",{class:"dropdown-item text-danger",onClick:t[9]||(t[9]=o=>c.deleteItems())},t[29]||(t[29]=[e("i",{class:"fa fa-trash pe-2"},null,-1),i(" حذف گروهی ")]))])]),v(k,{to:"/acc/rfbuy/mod/",type:"button",class:"block-options-item"},{default:r(()=>t[32]||(t[32]=[e("span",{class:"fa fa-plus fw-bolder"},null,-1)])),_:1})])]),e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[e("div",Z,[t[33]||(t[33]=e("span",{class:"input-group-text"},[e("i",{class:"fa fa-search"})],-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.searchValue=o),class:"form-control",type:"text",placeholder:"جست و جو ..."},null,512),[[B,s.searchValue]]),t[34]||(t[34]=e("button",{class:"btn btn-outline-success dropdown-toggle d-block d-sm-none",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa fa-filter"})],-1)),e("ul",tt,[(d(!0),u(x,null,C(s.types,(o,f)=>(d(),u("div",et,[m(e("input",{onChange:t[11]||(t[11]=b=>c.filterTable()),"onUpdate:modelValue":b=>s.types[f].checked=b,checked:"",class:"form-check-input",type:"checkbox"},null,40,st),[[g,s.types[f].checked]]),e("label",ot,n(o.label),1)]))),256))])])]),e("div",lt,[(d(!0),u(x,null,C(s.types,(o,f)=>(d(),u("div",at,[m(e("input",{onChange:t[12]||(t[12]=b=>c.filterTable()),"onUpdate:modelValue":b=>s.types[f].checked=b,checked:"",class:"form-check-input",type:"checkbox"},null,40,nt),[[g,s.types[f].checked]]),e("label",it,n(o.label),1)]))),256))]),v(I,{"table-class-name":"customize-table","items-selected":s.itemsSelected,"onUpdate:itemsSelected":t[13]||(t[13]=o=>s.itemsSelected=o),"show-index":"",alternating:"",headers:s.headers,items:s.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:s.loading},{"item-operation":r(({code:o,type:f})=>[e("div",rt,[t[40]||(t[40]=e("button",{"aria-expanded":"false","aria-haspopup":"true",class:"btn btn-sm btn-link","data-bs-toggle":"dropdown",id:"dropdown-align-center-alt-primary",type:"button"},[e("i",{class:"fa-solid fa-ellipsis"})],-1)),e("div",dt,[v(k,{class:"dropdown-item",to:"/acc/accounting/view/"+o},{default:r(()=>t[35]||(t[35]=[e("i",{class:"fa fa-file text-success pe-2"},null,-1),i(" سند حسابداری ")])),_:2},1032,["to"]),v(k,{class:"dropdown-item",to:"/acc/rfbuy/view/"+o},{default:r(()=>t[36]||(t[36]=[e("i",{class:"fa fa-eye text-info pe-2"},null,-1),i(" مشاهده فاکتور ")])),_:2},1032,["to"]),e("button",{class:"dropdown-item",onClick:b=>s.printOptions.selectedPrintCode=o,"data-bs-toggle":"modal","data-bs-target":"#printModal"},t[37]||(t[37]=[e("i",{class:"fa fa-file-pdf pe-2"},null,-1),i(" خروجی PDF ")]),8,ut),e("button",{type:"button",onClick:b=>c.canEditItem(o),class:"dropdown-item"},t[38]||(t[38]=[e("i",{class:"fa fa-edit pe-2"},null,-1),i(" ویرایش ")]),8,ct),e("button",{type:"button",onClick:b=>c.deleteItem(o),class:"dropdown-item text-danger"},t[39]||(t[39]=[e("i",{class:"fa fa-trash pe-2"},null,-1),i(" حذف ")]),8,pt)])])]),"item-label":r(({label:o})=>[o?(d(),u("span",ft,[o.code=="payed"?(d(),u("span",mt,n(o.label),1)):w("",!0),o.code=="returned"?(d(),u("span",bt,n(o.label),1)):w("",!0),o.code=="accepted"?(d(),u("span",ht,n(o.label),1)):w("",!0)])):w("",!0)]),"item-des":r(({des:o})=>[i(n(o.replace("فاکتور برگشت از خرید:","")),1)]),"item-relatedDocsCount":r(({relatedDocsCount:o,relatedDocsPays:f})=>[o!="0"?(d(),u("span",kt,[t[41]||(t[41]=e("i",{class:"fa fa-money"},null,-1)),i(" "+n(s.$filters.formatNumber(f)),1)])):w("",!0)]),"item-amount":r(({amount:o})=>[e("span",gt,n(s.$filters.formatNumber(o)),1)]),"item-transferCost":r(({transferCost:o})=>[e("span",yt,n(s.$filters.formatNumber(o)),1)]),"item-discountAll":r(({discountAll:o})=>[e("span",vt,n(s.$filters.formatNumber(o)),1)]),"item-person":r(({person:o})=>[v(k,{to:"/acc/persons/card/view/"+o.code},{default:r(()=>[i(n(o.nikename),1)]),_:2},1032,["to"])]),"item-code":r(({code:o})=>[v(k,{to:"/acc/rfbuy/view/"+o},{default:r(()=>[i(n(o),1)]),_:2},1032,["to"])]),_:1},8,["items-selected","headers","items","loading"]),e("div",wt,[e("a",xt,[e("div",Ct,[e("div",Vt,[e("div",It,[t[42]||(t[42]=e("span",{class:"text-dark"},[e("i",{class:"fa fa-list-dots"}),i(" مبلغ کل: ")],-1)),e("span",Tt,n(s.$filters.formatNumber(this.sumTotal))+" "+n(s.$filters.getActiveMoney().shortName),1)]),e("div",St,[t[43]||(t[43]=e("span",{class:"text-dark"},[e("i",{class:"fa fa-list-check"}),i(" جمع مبلغ موارد انتخابی: ")],-1)),e("span",Ot,n(s.$filters.formatNumber(this.sumSelected))+" "+n(s.$filters.getActiveMoney().shortName),1)])])])])])])])])])],64)}const Mt=T(A,[["render",Bt]]);export{Mt as default};
