import{_ as I,u as j,a as P}from"./main-9b36f05f.js";import{h as R,r as y,n as U,a as s,o as E,s as q,b as o,w as a,d as i,t as d,c as z,e as H}from"./vendor-adef9cb4.js";const L=R({name:"DetailsBtn",props:{node:{type:Number,required:!0},nodeType:{type:String,required:!0},isObject:{type:Boolean,required:!0},upperId:{type:Number,default:null}},setup(e){const{t}=j(),c=y(!1),h=y(!1),r=y([]),u=y(""),l=y(0),m=y({page:1,rowsPerPage:10}),b=[{text:t("reports.details.date"),value:"date"},{text:t("reports.details.doc_code"),value:"doc_code"},{text:t("reports.details.description"),value:"des"},{text:t("reports.details.debit"),value:"bd"},{text:t("reports.details.credit"),value:"bs"},{text:t("reports.details.quantity"),value:"commodity_count"}],v=async()=>{var g;c.value=!0;try{const p=await P.post("/api/report/acc/get_details",{node:e.node,type:e.nodeType,isObject:e.isObject,upperId:e.upperId,page:m.value.page,perPage:m.value.rowsPerPage});r.value=p.data.items||[],l.value=p.data.pagination.totalItems||0,m.value.page=p.data.pagination.currentPage||1,m.value.rowsPerPage=p.data.pagination.perPage||10}catch(p){console.error("Error loading details:",((g=p.response)==null?void 0:g.data)||p)}finally{c.value=!1}},w=async()=>{c.value=!0;try{const g=await P.post("/api/report/acc/export_details_excel",{node:e.node,type:e.nodeType,isObject:e.isObject,upperId:e.upperId},{responseType:"blob"}),p=window.URL.createObjectURL(new Blob([g.data])),f=document.createElement("a");f.href=p,f.setAttribute("download","details_export.xlsx"),document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(g){console.error("Error exporting to Excel:",g)}finally{c.value=!1}},x=g=>g?Number(g).toLocaleString("fa-IR"):"0";return U(m,()=>{v()},{deep:!0}),{loading:c,dialog:h,items:r,searchValue:u,totalItems:l,serverOptions:m,headers:b,loadData:v,exportToExcel:w,formatNumber:x}}}),S={class:"text-center pa-4"};function A(e,t,c,h,r,u){const l=s("v-btn"),m=s("v-icon"),b=s("v-toolbar-title"),v=s("v-spacer"),w=s("v-toolbar"),x=s("EasyDataTable"),g=s("v-card-text"),p=s("v-card"),f=s("v-dialog");return E(),q("div",S,[o(l,{onClick:t[0]||(t[0]=_=>{e.dialog=!0,e.loadData(1)}),color:"primary",size:"xs",variant:"plain",icon:"mdi-magnify"}),o(f,{modelValue:e.dialog,"onUpdate:modelValue":t[3]||(t[3]=_=>e.dialog=_),fullscreen:""},{default:a(()=>[o(p,{loading:e.loading},{default:a(()=>[o(w,{class:"position-sticky top-0",style:{"z-index":"1000"},flat:""},{default:a(()=>[o(l,{icon:"",small:"",onClick:t[1]||(t[1]=_=>e.dialog=!1),title:e.$t("dialog.close")},{default:a(()=>[o(m,null,{default:a(()=>t[4]||(t[4]=[i("mdi-close")])),_:1})]),_:1},8,["title"]),o(b,null,{default:a(()=>[i(d(e.$t("dialog.details")),1)]),_:1}),o(v),o(l,{icon:"",small:"",onClick:e.exportToExcel,title:e.$t("button.export_excel")},{default:a(()=>[o(m,null,{default:a(()=>t[5]||(t[5]=[i("mdi-file-excel")])),_:1})]),_:1},8,["onClick","title"])]),_:1}),o(g,{class:"p-0 m-0",style:{"max-height":"500px","overflow-y":"auto"}},{default:a(()=>[o(x,{"table-class-name":"customize-table","multi-sort":"","show-index":"",alternating:"","search-value":e.searchValue,headers:e.headers,items:e.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center","server-items-length":e.totalItems,"server-options":e.serverOptions,"onUpdate:serverOptions":t[2]||(t[2]=_=>e.serverOptions=_),loading:e.loading,"rows-per-page-message":e.$t("table.rows_per_page"),"empty-message":e.$t("table.no_data"),"rows-of-page-separator-message":e.$t("table.of")},{"item-bs":a(({bs:_})=>[i(d(e.formatNumber(_)),1)]),"item-bd":a(({bd:_})=>[i(d(e.formatNumber(_)),1)]),"item-doc_code":a(({doc_code:_})=>[o(l,{color:"primary",block:"",variant:"plain",text:e.formatNumber(_),to:"/acc/accounting/view/"+_},null,8,["text","to"])]),_:1},8,["search-value","headers","items","server-items-length","server-options","loading","rows-per-page-message","empty-message","rows-of-page-separator-message"])]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const M=I(L,[["render",A],["__scopeId","data-v-41ff17af"]]);const F={name:"ExploreAccounts",components:{DetailsBtn:M},data(){return{loading:!1,tree:[],items:[],plugins:[],errorDialog:!1,errorMessage:"",headers:[{text:this.$t("table.account"),value:"account",sortable:!0},{text:this.$t("table.debit_turnover"),value:"his_bd",sortable:!0,width:100},{text:this.$t("table.credit_turnover"),value:"his_bs",sortable:!0,width:100},{text:this.$t("table.debit_balance"),value:"bal_bd",sortable:!0,width:100},{text:this.$t("table.credit_balance"),value:"bal_bs",sortable:!0,width:100},{text:this.$t("table.operations"),value:"operation",width:100,sortable:!1}],pagination:{totalItems:0,totalPages:0,currentPage:1,perPage:10},currentNode:"root",currentType:"calc",currentHasChild:!0}},methods:{async loadNode(e,t,c,h){var r,u;this.loading=!0,this.currentNode=e,this.currentType=t,this.currentHasChild=c;try{const l=await P.post("/api/report/acc/explore_accounts_det",{node:e,type:t,hasChild:c,page:h||this.pagination.currentPage,perPage:this.pagination.perPage});this.items=l.data.itemData||[],this.tree=l.data.tree||[],this.pagination=l.data.pagination||{totalItems:0,totalPages:0,currentPage:1,perPage:10}}catch(l){this.showError(this.$t("error.fetch_data")+(((u=(r=l.response)==null?void 0:r.data)==null?void 0:u.message)||l.message))}finally{this.loading=!1}},async loadInitialData(){var e,t;this.loading=!0;try{const c=await P.post("/api/plugin/get/actives");this.plugins=c.data||[],await this.loadNode("root","calc",!0,1)}catch(c){this.showError(this.$t("error.initial_load")+(((t=(e=c.response)==null?void 0:e.data)==null?void 0:t.message)||c.message))}finally{this.loading=!1}},showError(e){this.errorMessage=e,this.errorDialog=!0},formatNumber(e){return e?Number(e).toLocaleString("fa-IR"):"0"},isPluginActive(e){return!!this.plugins[e]}},mounted(){this.loadInitialData()}},G={class:"mx-2 text-caption"};function J(e,t,c,h,r,u){const l=s("v-spacer"),m=s("v-icon"),b=s("v-btn"),v=s("v-toolbar"),w=s("v-breadcrumbs"),x=s("v-col"),g=s("v-row"),p=s("v-card-text"),f=s("DetailsBtn"),_=s("EasyDataTable"),T=s("v-card-title"),B=s("v-card-actions"),C=s("v-card"),V=s("v-dialog");return E(),z(C,{loading:r.loading?"red":null,disabled:r.loading},{default:a(()=>[o(v,{color:"toolbar",title:e.$t("dialog.explore_accounts"),flat:""},{default:a(()=>[o(l),o(b,{icon:"",onClick:t[0]||(t[0]=n=>u.loadNode("root","calc",!0,1)),title:e.$t("button.back_to_root")},{default:a(()=>[o(m,null,{default:a(()=>t[5]||(t[5]=[i("mdi-home")])),_:1})]),_:1},8,["title"])]),_:1},8,["title"]),o(p,null,{default:a(()=>[o(g,null,{default:a(()=>[o(x,null,{default:a(()=>[o(w,{items:r.tree,class:"ma-0 pa-0"},{prepend:a(()=>[o(m,{icon:"mdi-family-tree",color:"primary",class:"me-3"})]),title:a(({item:n})=>[o(b,{density:"compact",onClick:N=>u.loadNode(n.id,"calc",n.hasChild,1),color:"info",variant:"text"},{default:a(()=>[i(d(n.name),1)]),_:2},1032,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),o(p,{class:"mt-0 pt-0 px-0"},{default:a(()=>[o(_,{headers:r.headers,items:r.items,loading:r.loading,"table-class-name":"customize-table","multi-sort":"","show-index":"",alternating:"","theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center","hide-default-footer":"","rows-per-page-message":e.$t("table.rows_per_page"),"empty-message":e.$t("table.no_data"),"rows-of-page-separator-message":e.$t("table.of")},{"item-operation":a(({id:n,type:N,isObject:k,upperID:D})=>[o(f,{node:n,"node-type":N,"is-object":k,"upper-id":D},null,8,["node","node-type","is-object","upper-id"])]),"item-account":a(({hasChild:n,type:N,isObject:k,code:D,account:O,id:$})=>[o(b,{color:"primary",disabled:!n&&k||!n&&N==="calc",block:"",variant:"text",onClick:K=>u.loadNode($,N,n,1)},{default:a(()=>[i(d(O),1)]),_:2},1032,["disabled","onClick"])]),"item-bal_bd":a(({bal_bd:n})=>[i(d(u.formatNumber(n)),1)]),"item-bal_bs":a(({bal_bs:n})=>[i(d(u.formatNumber(n)),1)]),"item-his_bd":a(({his_bd:n})=>[i(d(u.formatNumber(n)),1)]),"item-his_bs":a(({his_bs:n})=>[i(d(u.formatNumber(n)),1)]),_:1},8,["headers","items","loading","rows-per-page-message","empty-message","rows-of-page-separator-message"]),o(g,{class:"mt-2",justify:"center",align:"center"},{default:a(()=>[o(b,{small:"",icon:"",disabled:r.pagination.currentPage===1,onClick:t[1]||(t[1]=n=>u.loadNode(r.currentNode,r.currentType,r.currentHasChild,r.pagination.currentPage-1))},{default:a(()=>[o(m,{small:""},{default:a(()=>t[6]||(t[6]=[i("mdi-chevron-right")])),_:1})]),_:1},8,["disabled"]),H("span",G,d(e.$t("pagination.page"))+" "+d(r.pagination.currentPage)+" "+d(e.$t("pagination.of"))+" "+d(r.pagination.totalPages),1),o(b,{small:"",icon:"",disabled:r.pagination.currentPage===r.pagination.totalPages,onClick:t[2]||(t[2]=n=>u.loadNode(r.currentNode,r.currentType,r.currentHasChild,r.pagination.currentPage+1))},{default:a(()=>[o(m,{small:""},{default:a(()=>t[7]||(t[7]=[i("mdi-chevron-left")])),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),o(V,{modelValue:r.errorDialog,"onUpdate:modelValue":t[4]||(t[4]=n=>r.errorDialog=n),"max-width":"500"},{default:a(()=>[o(C,null,{default:a(()=>[o(T,{class:"text-error"},{default:a(()=>[i(d(e.$t("error.title")),1)]),_:1}),o(p,null,{default:a(()=>[i(d(r.errorMessage),1)]),_:1}),o(B,null,{default:a(()=>[o(l),o(b,{color:"primary",onClick:t[3]||(t[3]=n=>r.errorDialog=!1)},{default:a(()=>[i(d(e.$t("button.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["loading","disabled"])}const X=I(F,[["render",J],["__scopeId","data-v-983f8841"]]);export{X as default};
