import{a as w,S as m,_ as E}from"./main-9b36f05f.js";import{d as Q}from"./debounce-342dfd77.js";import{h as N,a as n,o as C,s as z,b as o,w as s,F as L,c as y,A as T,d as i,t as c,_ as h}from"./vendor-adef9cb4.js";const j=N({name:"SupportList",data(){return{loading:!1,activeTab:"pending",headers:[{title:"",key:"operation",align:"center",sortable:!1},{title:"شناسه",key:"id",align:"center",sortable:!0},{title:"کاربر",key:"submitter.fullName",align:"center",sortable:!0},{title:"کسب‌وکار",key:"bid.name",align:"center",sortable:!0,value:e=>e.bid?e.bid.name:"بدون کسب‌وکار"},{title:"عنوان",key:"title",align:"center",sortable:!0},{title:"تاریخ",key:"dateSubmit",align:"center",sortable:!0}],pendingItems:[],respondedItems:[],closedItems:[],pagePending:1,pageResponded:1,pageClosed:1,itemsPerPagePending:10,itemsPerPageResponded:10,itemsPerPageClosed:10,totalPending:0,totalResponded:0,totalClosed:0,selectedTickets:[],bulkState:null,states:["در حال پیگیری","پاسخ داده شده","خاتمه یافته"],searchQuery:""}},watch:{searchQuery:{handler:Q(function(){this.pagePending=1,this.pageResponded=1,this.pageClosed=1,this.refreshAllData()},1e3),immediate:!1}},methods:{async loadPendingData(e){await this.loadData("در حال پیگیری",e,"pending")},async loadRespondedData(e){await this.loadData("پاسخ داده شده",e,"responded")},async loadClosedData(e){await this.loadData("خاتمه یافته",e,"closed")},async loadData(e,t,d){this.loading=!0;try{const l=(await w.post("/api/admin/support/list",{state:e,page:t.page,itemsPerPage:t.itemsPerPage,searchQuery:this.searchQuery||null})).data.data;d==="pending"?(this.pendingItems=l.items,this.totalPending=l.total,this.totalPending>0&&this.activeTab!=="pending"&&(this.activeTab="pending")):d==="responded"?(this.respondedItems=l.items,this.totalResponded=l.total,this.totalPending===0&&this.totalResponded>0&&this.activeTab!=="responded"&&(this.activeTab="responded")):d==="closed"&&(this.closedItems=l.items,this.totalClosed=l.total)}catch(u){console.error(`Error loading ${d} tickets:`,u),m.fire({text:`خطا در بارگذاری تیکت‌های ${e}: ${u.message}`,icon:"error",confirmButtonText:"تأیید"})}finally{this.loading=!1}},async bulkUpdateState(){if(!this.bulkState){m.fire({text:"لطفاً یک وضعیت انتخاب کنید",icon:"warning",confirmButtonText:"تأیید"});return}this.loading=!0;try{const e=await w.post("/api/admin/support/bulk-update",{ticketIds:this.selectedTickets.map(t=>t.id),state:this.bulkState});if(e.data.error===0)m.fire({text:"وضعیت تیکت‌ها با موفقیت تغییر کرد",icon:"success",confirmButtonText:"تأیید"}),this.selectedTickets=[],this.bulkState=null,await this.refreshAllData();else throw new Error(e.data.message||"خطای ناشناخته")}catch(e){m.fire({text:"خطا در تغییر وضعیت: "+e.message,icon:"error",confirmButtonText:"تأیید"})}finally{this.loading=!1}},async refreshAllData(){await this.loadPendingData({page:this.pagePending,itemsPerPage:this.itemsPerPagePending}),await this.loadRespondedData({page:this.pageResponded,itemsPerPage:this.itemsPerPageResponded}),await this.loadClosedData({page:this.pageClosed,itemsPerPage:this.itemsPerPageClosed})}},mounted(){this.refreshAllData()}});function q(e,t,d,u,l,G){const V=n("v-spacer"),U=n("v-select"),p=n("v-btn"),A=n("v-toolbar"),D=n("v-text-field"),R=n("v-col"),$=n("v-row"),g=n("v-icon"),v=n("v-tab"),S=n("v-tabs"),f=n("v-tooltip"),P=n("v-data-table-server"),b=n("v-window-item"),I=n("v-window"),F=n("v-card"),B=n("v-container");return C(),z(L,null,[o(A,{color:"toolbar",title:e.$t("pages.support.titlebar_admin")},{default:s(()=>[o(V),e.selectedTickets.length>0?(C(),y(U,{key:0,modelValue:e.bulkState,"onUpdate:modelValue":t[0]||(t[0]=a=>e.bulkState=a),items:e.states,label:"تغییر وضعیت دسته‌جمعی","prepend-inner-icon":"mdi-list-status",class:"mx-2",style:{"max-width":"200px"}},null,8,["modelValue","items"])):T("",!0),e.selectedTickets.length>0?(C(),y(p,{key:1,color:"primary","prepend-icon":"mdi-content-save",onClick:e.bulkUpdateState,loading:e.loading},{default:s(()=>t[16]||(t[16]=[i(" اعمال ")])),_:1},8,["onClick","loading"])):T("",!0)]),_:1},8,["title"]),o(B,{class:"pa-0 ma-0"},{default:s(()=>[o(F,{loading:e.loading?"red":null,disabled:e.loading},{default:s(()=>[o($,{class:"pa-4"},{default:s(()=>[o(R,{cols:"12"},{default:s(()=>[o(D,{modelValue:e.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=a=>e.searchQuery=a),label:"جست‌وجو (شماره تیکت، نام کسب‌وکار، نام کاربر)","prepend-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o(S,{modelValue:e.activeTab,"onUpdate:modelValue":t[2]||(t[2]=a=>e.activeTab=a),color:"primary",grow:""},{default:s(()=>[o(v,{value:"pending",class:"flex-grow-1"},{default:s(()=>[o(g,{start:""},{default:s(()=>t[17]||(t[17]=[i("mdi-progress-clock")])),_:1}),i(" در حال پیگیری ("+c(e.totalPending)+") ",1)]),_:1}),o(v,{value:"responded",class:"flex-grow-1"},{default:s(()=>[o(g,{start:""},{default:s(()=>t[18]||(t[18]=[i("mdi-check-circle")])),_:1}),i(" پاسخ داده شده ("+c(e.totalResponded)+") ",1)]),_:1}),o(v,{value:"closed",class:"flex-grow-1"},{default:s(()=>[o(g,{start:""},{default:s(()=>t[19]||(t[19]=[i("mdi-lock")])),_:1}),i(" خاتمه یافته ("+c(e.totalClosed)+") ",1)]),_:1})]),_:1},8,["modelValue"]),o(I,{modelValue:e.activeTab,"onUpdate:modelValue":t[15]||(t[15]=a=>e.activeTab=a)},{default:s(()=>[o(b,{value:"pending"},{default:s(()=>[o(P,{"items-per-page":e.itemsPerPagePending,"onUpdate:itemsPerPage":t[4]||(t[4]=a=>e.itemsPerPagePending=a),page:e.pagePending,"onUpdate:page":t[5]||(t[5]=a=>e.pagePending=a),headers:e.headers,items:e.pendingItems,"items-length":e.totalPending,loading:e.loading,"no-data-text":e.$t("table.no_data"),class:"elevation-1","show-select":"",modelValue:e.selectedTickets,"onUpdate:modelValue":t[6]||(t[6]=a=>e.selectedTickets=a),"onUpdate:options":e.loadPendingData},{"item.operation":s(({item:a})=>[o(f,{text:e.$t("dialog.view"),location:"bottom"},{activator:s(({props:r})=>[o(p,h(r,{color:"primary",icon:"mdi-eye",size:"x-small",variant:"flat",to:"/profile/manager/support-view/"+a.id,onClick:t[3]||(t[3]=k=>e.loading=!0)}),null,16,["to"])]),_:2},1032,["text"])]),_:1},8,["items-per-page","page","headers","items","items-length","loading","no-data-text","modelValue","onUpdate:options"])]),_:1}),o(b,{value:"responded"},{default:s(()=>[o(P,{"items-per-page":e.itemsPerPageResponded,"onUpdate:itemsPerPage":t[8]||(t[8]=a=>e.itemsPerPageResponded=a),page:e.pageResponded,"onUpdate:page":t[9]||(t[9]=a=>e.pageResponded=a),headers:e.headers,items:e.respondedItems,"items-length":e.totalResponded,loading:e.loading,"no-data-text":e.$t("table.no_data"),class:"elevation-1","show-select":"",modelValue:e.selectedTickets,"onUpdate:modelValue":t[10]||(t[10]=a=>e.selectedTickets=a),"onUpdate:options":e.loadRespondedData},{"item.operation":s(({item:a})=>[o(f,{text:e.$t("dialog.view"),location:"bottom"},{activator:s(({props:r})=>[o(p,h(r,{color:"primary",icon:"mdi-eye",size:"x-small",variant:"flat",to:"/profile/manager/support-view/"+a.id,onClick:t[7]||(t[7]=k=>e.loading=!0)}),null,16,["to"])]),_:2},1032,["text"])]),_:1},8,["items-per-page","page","headers","items","items-length","loading","no-data-text","modelValue","onUpdate:options"])]),_:1}),o(b,{value:"closed"},{default:s(()=>[o(P,{"items-per-page":e.itemsPerPageClosed,"onUpdate:itemsPerPage":t[12]||(t[12]=a=>e.itemsPerPageClosed=a),page:e.pageClosed,"onUpdate:page":t[13]||(t[13]=a=>e.pageClosed=a),headers:e.headers,items:e.closedItems,"items-length":e.totalClosed,loading:e.loading,"no-data-text":e.$t("table.no_data"),class:"elevation-1","show-select":"",modelValue:e.selectedTickets,"onUpdate:modelValue":t[14]||(t[14]=a=>e.selectedTickets=a),"onUpdate:options":e.loadClosedData},{"item.operation":s(({item:a})=>[o(f,{text:e.$t("dialog.view"),location:"bottom"},{activator:s(({props:r})=>[o(p,h(r,{color:"primary",icon:"mdi-eye",size:"x-small",variant:"flat",to:"/profile/manager/support-view/"+a.id,onClick:t[11]||(t[11]=k=>e.loading=!0)}),null,16,["to"])]),_:2},1032,["text"])]),_:1},8,["items-per-page","page","headers","items","items-length","loading","no-data-text","modelValue","onUpdate:options"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["loading","disabled"])]),_:1})],64)}const M=E(j,[["render",q],["__scopeId","data-v-ab832cde"]]);export{M as default};
