import{L as g,S as p,a as r,_ as V}from"./main-9b36f05f.js";import"./vue-persian-datetime-picker.common-0e5ba5b7.js";import{h as x,a as k,o as d,s as m,e,d as f,u as i,ao as w,A as D,b as C,ab as u,au as A,F as T,C as U,w as h,t as E}from"./vendor-adef9cb4.js";const F=x({name:"sell",components:{Loading:g},data:()=>({loading:!1,plugins:[],doc:{},ticket:{type:"output",typeString:"حواله خروج",date:"",des:"",transfer:"",receiver:"",code:"",store:{},person:{},transferType:{},referral:"",sms:!1,senderTel:0},transferTypes:[],year:{},items:[],headers:[{text:"کد",value:"commodity.code"},{text:"کالا",value:"commodity.name",sortable:!0},{text:"واحد",value:"commodity.unit",sortable:!0},{text:"مورد نیاز",value:"docCount"},{text:"از قبل",value:"countBefore"},{text:"باقی‌مانده",value:"remain"},{text:"تعداد",value:"commdityCount",sortable:!0},{text:"ارجاع",value:"referal",sortable:!0},{text:"توضیحات",value:"des"}],currencyConfig:{masked:!1,prefix:"",suffix:"",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0}}),methods:{submit(){this.loading=!0;let s=[],t=0;if(this.items.forEach((l,a)=>{l.ticketCount===""?s.push("تعداد کالا در ردیف "+(a+1)+"وارد نشده است."):l.ticketCount===0&&t++}),t!=0&&s.push("تعداد تمام کالاها صفر است!"),s.length!=0){let l="<ul>";s.forEach(a=>{l+="<li>"+a+"</li>"}),l+="</ul>",p.fire({html:l,icon:"error",confirmButtonText:"قبول"}).then(a=>{this.loading=!1})}else r.post("/api/storeroom/ticket/insert",{doc:this.doc,ticket:this.ticket,items:this.items}).then(l=>{l.data.result==0?p.fire({text:"حواله انبار با موفقیت ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(a=>{this.$router.push("/acc/storeroom/tickets/list"),this.loading=!1}):l.data.result==2&&p.fire({text:"حواله انبار با موفقیت ثبت شد اما به دلیل کمبود اعتبار،پیامک به مشتری ارسال نشد.لطفا برای ارسال پیامک حساب خود را شارژ نمایید..",icon:"success",confirmButtonText:"قبول"}).then(a=>{this.$router.push("/acc/storeroom/tickets/list"),this.loading=!1})})},autofill(){this.items.forEach((s,t)=>{this.items[t].ticketCount=this.items[t].remain,this.items[t].des="تعداد "+this.items[t].remain+"مورد تحویل شد. ",this.items[t].type="output"})},isNumber(s){const t=["0","1","2","3","4","5","6","7","8","9"],l=s.key;t.includes(l)||s.preventDefault()},loadData(){r.post("/api/storeroom/doc/get/info/"+this.$route.params.doc).then(s=>{this.doc=s.data,this.ticket.person=s.data.person,this.ticket.des="حواله خروج از انبار برای فاکتور فروش شماره # "+this.doc.code,this.items=s.data.commodities,this.items.forEach((t,l)=>{this.items[l].ticketCount=0,this.items[l].docCount=t.commdityCount,this.items[l].des="",this.items[l].type="output"})}),r.post("/api/storeroom/info/"+this.$route.params.storeID).then(s=>{this.ticket.store=s.data,this.ticket.store.des=this.ticket.store.name+" انباردار : "+this.ticket.store.manager}),r.post("/api/year/get").then(s=>{this.year=s.data,this.ticket.date=s.data.now}),r.post("/api/storeroom/transfertype/list").then(s=>{this.transferTypes=s.data,this.ticket.transferType=s.data[0]}),r.post("/api/plugin/get/actives").then(s=>{this.plugins=s.data})},isPluginActive(s){return this.plugins[s]!==void 0}},mounted(){this.loadData()}}),$={class:"block block-content-full"},B={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},M={class:"block-title text-primary-dark"},N={class:"block-options"},Y={key:0,class:"form-check form-switch form-check-inline"},S=["disabled"],j=["disabled"],P={class:"block-content pt-1 pb-3"},L={class:"row"},O={class:"col-sm-12 col-md-4"},R={class:"col-sm-12 col-md-4"},z={class:"col-sm-12 col-md-4"},I={class:"row mt-1"},K={class:"col-sm-12 col-md-12"},W={class:"row mt-1"},Z={class:"col-sm-12 col-md-2"},q=["value"],G={class:"col-sm-12 col-md-3"},H={class:"col-sm-12 col-md-2"},J={class:"col-sm-12 col-md-3"},Q={class:"col-sm-12 col-md-2"},X={class:"row mt-2"},_={class:"col-sm-12 col-md-12"},tt=["onBlur","max","onUpdate:modelValue"],et=["onUpdate:modelValue"],st=["onUpdate:modelValue"];function ot(s,t,l,a,lt,it){const y=k("date-picker"),v=k("EasyDataTable");return d(),m("div",$,[e("div",B,[e("h3",M,[e("button",{onClick:t[0]||(t[0]=o=>s.$router.back()),type:"button",class:"float-start d-none d-sm-none d-md-block btn btn-sm btn-link text-warning"},t[14]||(t[14]=[e("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),t[15]||(t[15]=e("i",{class:"mx-2 fa fa-file-export"},null,-1)),t[16]||(t[16]=f(" حواله خروج از انبار "))]),e("div",N,[s.isPluginActive("accpro")?(d(),m("span",Y,[i(e("input",{disabled:this.ticket.person.mobile=="","onUpdate:modelValue":t[1]||(t[1]=o=>s.ticket.sms=o),class:"form-check-input",type:"checkbox"},null,8,S),[[w,s.ticket.sms]]),t[17]||(t[17]=e("label",{class:"form-check-label"}," پیامک",-1))])):D("",!0),e("button",{onClick:t[2]||(t[2]=o=>s.autofill()),class:"btn btn-sm btn-outline-primary"},t[18]||(t[18]=[e("i",{class:"fa fa-list-check me-2"},null,-1),f(" تکمیل خودکار ")])),e("button",{disabled:this.loading,onClick:t[3]||(t[3]=o=>s.submit()),type:"button",class:"mx-2 btn btn-sm btn-success"},t[19]||(t[19]=[e("i",{class:"fa fa-save me-2"},null,-1),f(" ثبت حواله خروج ")]),8,j)])]),e("div",P,[e("div",L,[e("div",O,[t[20]||(t[20]=e("label",{class:"form-label"},"تاریخ",-1)),C(y,{class:"",modelValue:this.ticket.date,"onUpdate:modelValue":t[4]||(t[4]=o=>this.ticket.date=o),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:s.year.start,max:s.year.end},null,8,["modelValue","min","max"])]),e("div",R,[t[21]||(t[21]=e("label",{class:"form-label"},"انبار",-1)),i(e("input",{disabled:"disabled",readonly:"readonly","onUpdate:modelValue":t[5]||(t[5]=o=>this.ticket.store.des=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.store.des]])]),e("div",z,[t[22]||(t[22]=e("label",{class:"form-label"},"خریدار",-1)),i(e("input",{disabled:"disabled",readonly:"readonly","onUpdate:modelValue":t[6]||(t[6]=o=>this.ticket.person.des=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.person.des]])])]),e("div",I,[e("div",K,[t[23]||(t[23]=e("label",{class:"form-label"},"شرح",-1)),i(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>this.ticket.des=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.des]])])]),e("div",W,[e("div",Z,[t[24]||(t[24]=e("label",{class:"form-label"},"روش تحویل",-1)),i(e("select",{class:"form-select","onUpdate:modelValue":t[8]||(t[8]=o=>s.ticket.transferType=o)},[(d(!0),m(T,null,U(s.transferTypes,o=>(d(),m("option",{value:o},E(o.name),9,q))),256))],512),[[A,s.ticket.transferType]])]),e("div",G,[t[25]||(t[25]=e("label",{class:"form-label"},"حمل‌و‌نقل/نام باربری",-1)),i(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>this.ticket.transfer=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.transfer]])]),e("div",H,[t[26]||(t[26]=e("label",{class:"form-label"},"تحویل گیرنده",-1)),i(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>this.ticket.receiver=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.receiver]])]),e("div",J,[t[27]||(t[27]=e("label",{class:"form-label"},"شماره پیگیری/قبض",-1)),i(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>this.ticket.referral=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.referral]])]),e("div",Q,[t[28]||(t[28]=e("label",{class:"form-label"},"تلفن تحویل دهنده",-1)),i(e("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>this.ticket.senderTel=o),type:"text",class:"form-control"},null,512),[[u,this.ticket.senderTel]])])]),e("div",X,[e("div",_,[C(v,{"table-class-name":"customize-table","multi-sort":"","show-index":"",alternating:"",headers:s.headers,items:s.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:this.loading},{"item-commdityCount":h(({index:o,commdityCount:c,ticketCount:b})=>[i(e("input",{onBlur:n=>{this.items[o-1].ticketCount===""&&(this.items[o-1].ticketCount=0)},onKeypress:t[13]||(t[13]=n=>s.isNumber(n)),class:"form-control form-control-sm",type:"number",min:"0",max:this.items[o-1].remain,"onUpdate:modelValue":n=>this.items[o-1].ticketCount=n},null,40,tt),[[u,this.items[o-1].ticketCount]])]),"item-des":h(({index:o,des:c})=>[i(e("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":b=>this.items[o-1].des=b},null,8,et),[[u,this.items[o-1].des]])]),"item-referal":h(({index:o})=>[i(e("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":c=>this.items[o-1].referral=c},null,8,st),[[u,this.items[o-1].referral]])]),_:1},8,["headers","items","loading"])])])])])}const nt=V(F,[["render",ot]]);export{nt as default};
