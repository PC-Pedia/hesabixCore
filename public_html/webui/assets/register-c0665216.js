import{a as n,_ as y}from"./main-9b36f05f.js";import{h as I,a as i,o as f,s as v,b as t,w as s,A as T,F as L,aa as R,d as M,t as U}from"./vendor-adef9cb4.js";n.defaults.withCredentials=!0;const D=I({name:"register",data(){const e=this;return{loading:!1,captchaLoading:!1,dialog:!1,dialogColor:"dangerLight",dialogIcon:"mdi-close-octagon",dialogTitle:"",dialogMessage:"",showCaptcha:!0,termsAccepted:!1,captchaImage:"",canRegister:!0,user:{name:"",email:"",mobile:"",password:"",captcha:""},rules:{name:[a=>e.validate(a,"fill")],email:[a=>e.validate(a,"email")],mobile:[a=>e.validate(a,"mobile")],password:[a=>e.validate(a,"password")],captcha:[a=>!!a||e.$t("captcha.required")]}}},mounted(){this.checkRegisterStatus(),this.loadData()},methods:{validate(e,a){if(a==="fill")return(e==null?void 0:e.length)>0?!0:this.$t("validator.required");if(a==="email")return/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g.test(e)?!0:this.$t("validator.email_not_valid");if(a==="password")return e?e.length>7?!0:this.$t("validator.password_len_lower"):!1;if(a==="mobile")return new RegExp("^09\\d{9}$").test(e)?!0:this.$t("validator.mobile_not_valid")},loadData(){this.loadCaptcha()},async loadCaptcha(){this.captchaLoading=!0;try{const e=new Date().getTime(),a=await n.get(`/api/captcha/image?t=${e}`,{responseType:"blob",withCredentials:!0});this.captchaImage=URL.createObjectURL(a.data)}catch{this.dialogMessage=this.$t("captcha.load_error"),this.dialogColor="dangerLight",this.dialogIcon="mdi-close-octagon",this.dialogTitle=this.$t("dialog.error"),this.dialog=!0}finally{this.captchaLoading=!1}},async checkRegisterStatus(){try{const e=await n.get("/api/user/check-register-status");e.data.result===1&&(this.canRegister=e.data.canRegister,this.canRegister||(this.dialogMessage="عضویت کاربران جدید توسط مدیر سیستم غیرفعال شده است.",this.dialogColor="warning",this.dialogIcon="mdi-alert",this.dialogTitle=this.$t("dialog.warning"),this.dialog=!0))}catch{this.dialogMessage="خطا در بررسی وضعیت عضویت. لطفاً دوباره تلاش کنید.",this.dialogColor="dangerLight",this.dialogIcon="mdi-close-octagon",this.dialogTitle=this.$t("dialog.error"),this.dialog=!0}},async submit(){if(!this.canRegister){this.dialogMessage="عضویت کاربران جدید غیرفعال است.",this.dialogColor="dangerLight",this.dialogIcon="mdi-close-octagon",this.dialogTitle=this.$t("dialog.error"),this.dialog=!0;return}const{valid:e}=await this.$refs.form.validate();if(e){this.loading=!0;const a=localStorage.getItem("inviteCode")||"0",u={name:this.user.name,email:this.user.email,mobile:this.user.mobile,password:this.user.password,captcha_answer:this.user.captcha.toString(),inviteCode:a};n.post("/api/user/register",u,{withCredentials:!0}).then(r=>{if(r.data.Success===!1)this.dialogMessage=r.data.message,this.dialogColor="dangerLight",this.dialogIcon="mdi-close-octagon",this.dialogTitle=this.$t("dialog.error"),this.dialog=!0,this.loadCaptcha();else{const o=r.data.data;this.dialogMessage=o.message,this.dialogColor="success",this.dialogIcon="mdi-check-circle",this.dialogTitle=this.$t("dialog.success"),this.dialog=!0,o.redirect?setTimeout(()=>{this.dialog=!1,this.$router.push(o.redirect)},2e3):setTimeout(()=>{this.dialog=!1,this.$router.push("/user/active-account/"+this.user.mobile)},3e3)}}).catch(r=>{var o,g;this.dialogMessage=((g=(o=r.response)==null?void 0:o.data)==null?void 0:g.message)||this.$t("dialog.error_unknown"),this.dialogColor="dangerLight",this.dialogIcon="mdi-close-octagon",this.dialogTitle=this.$t("dialog.error"),this.dialog=!0,this.loadCaptcha()}).finally(()=>{this.loading=!1})}},handleDialogClose(){this.dialog=!1,this.dialogColor==="warning"&&!this.canRegister&&this.$router.push("/user/login")}}});const S={key:0,class:"text-center"};function q(e,a,u,r,o,g){const d=i("v-text-field"),b=i("v-img"),c=i("v-col"),m=i("v-row"),$=i("v-checkbox"),h=i("v-btn"),w=i("v-form"),C=i("v-card-text"),p=i("v-card"),_=i("v-container"),V=i("v-spacer"),k=i("v-dialog");return f(),v(L,null,[t(_,null,{default:s(()=>[t(m,{class:"d-flex justify-center"},{default:s(()=>[t(c,{md:"5"},{default:s(()=>[t(p,{loading:e.loading?"blue":void 0,title:e.$t("app.name"),subtitle:e.$t("user.register_label"),disabled:!e.canRegister},{default:s(()=>[t(C,null,{default:s(()=>[t(w,{ref:"form",disabled:e.loading,"fast-fail":"",onSubmit:a[6]||(a[6]=R(l=>e.submit(),["prevent"]))},{default:s(()=>[t(d,{class:"mb-2",label:e.$t("user.name"),placeholder:e.$t("user.name_des"),"single-line":"",modelValue:e.user.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.user.name=l),type:"text",variant:"outlined","prepend-inner-icon":"mdi-account",rules:e.rules.name},null,8,["label","placeholder","modelValue","rules"]),t(d,{class:"mb-2",label:e.$t("user.email"),placeholder:e.$t("user.email_placeholder"),"single-line":"",modelValue:e.user.email,"onUpdate:modelValue":a[1]||(a[1]=l=>e.user.email=l),type:"email",variant:"outlined","prepend-inner-icon":"mdi-email",rules:e.rules.email},null,8,["label","placeholder","modelValue","rules"]),t(d,{class:"mb-2",label:e.$t("user.mobile"),placeholder:e.$t("user.mobile_placeholder"),"single-line":"",modelValue:e.user.mobile,"onUpdate:modelValue":a[2]||(a[2]=l=>e.user.mobile=l),type:"tel",variant:"outlined","prepend-inner-icon":"mdi-phone",rules:e.rules.mobile},null,8,["label","placeholder","modelValue","rules"]),t(d,{class:"mb-2",label:e.$t("user.password"),placeholder:e.$t("user.password_register_des"),"single-line":"",type:"password",variant:"outlined","prepend-inner-icon":"mdi-lock",rules:e.rules.password,modelValue:e.user.password,"onUpdate:modelValue":a[3]||(a[3]=l=>e.user.password=l)},null,8,["label","placeholder","rules","modelValue"]),t(m,{class:"mb-2",dense:""},{default:s(()=>[t(c,{cols:"12",sm:"6"},{default:s(()=>[t(b,{src:e.captchaImage,"max-height":"50","max-width":"150",class:"captcha-img",contain:""},null,8,["src"])]),_:1}),t(c,{cols:"12",sm:"6"},{default:s(()=>[t(d,{dense:"",label:e.$t("captcha.enter_code"),modelValue:e.user.captcha,"onUpdate:modelValue":a[4]||(a[4]=l=>e.user.captcha=l),modelModifiers:{number:!0},variant:"outlined",type:"number",rules:e.rules.captcha,required:"","hide-details":"","prepend-inner-icon":"mdi-refresh","onClick:prependInner":e.loadCaptcha,loading:e.captchaLoading},null,8,["label","modelValue","rules","onClick:prependInner","loading"])]),_:1})]),_:1}),t($,{modelValue:e.termsAccepted,"onUpdate:modelValue":a[5]||(a[5]=l=>e.termsAccepted=l),label:e.$t("user.register_terms_des"),rules:[l=>!!l||e.$t("validator.terms_required")],required:"",class:"mb-2"},null,8,["modelValue","label","rules"]),t(h,{loading:e.loading,block:"",class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat","prepend-icon":"mdi-account-plus",type:"submit"},{default:s(()=>[M(U(e.$t("user.register")),1)]),_:1},8,["loading"])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","title","subtitle","disabled"])]),_:1})]),_:1})]),_:1}),e.dialog?(f(),v("div",S,[t(k,{modelValue:e.dialog,"onUpdate:modelValue":a[7]||(a[7]=l=>e.dialog=l),"max-width":"500",persistent:""},{default:s(()=>[t(p,{color:e.dialogColor,"prepend-icon":e.dialogIcon,title:e.dialogTitle,text:e.dialogMessage},{actions:s(()=>[t(V),t(h,{color:"primary",text:e.$t("dialog.ok"),variant:"flat",onClick:e.handleDialogClose},null,8,["text","onClick"])]),_:1},8,["color","prepend-icon","title","text"])]),_:1},8,["modelValue"])])):T("",!0)],64)}const j=y(D,[["render",q],["__scopeId","data-v-e5cd9c49"]]);export{j as default};
