import{_ as q,c as H,a as y,S as v}from"./main-9b36f05f.js";import{l as J}from"./lodash-9e2b1319.js";import{r as b,O as V,n as K,j as W,a as u,o as X,s as Y,b as e,w as o,V as Z,F as ee,_ as h,d as I,t as S}from"./vendor-adef9cb4.js";const te={__name:"list",setup(oe){const U=H();y.defaults.baseURL=U;const p=b(!1),f=b([]),s=b(new Set),C=b(0),$=b(""),F=b([{title:"",key:"checkbox",sortable:!1,width:"50",align:"center"},{title:"ردیف",key:"index",align:"center",sortable:!1,width:"70"},{title:"عملیات",key:"operation",align:"center",sortable:!1,width:"100"},{title:"کد",key:"code",align:"center",sortable:!0},{title:"تاریخ",key:"date",align:"center",sortable:!0},{title:"شرح",key:"des",align:"center",sortable:!0},{title:"مبلغ",key:"amount",align:"center",sortable:!0}]),_=b({page:1,itemsPerPage:10,sortBy:[],sortDesc:[]}),T=V(()=>s.value.size>0),L=V(()=>s.value.size===f.value.length),k=async()=>{var t,l,r,a,d;try{p.value=!0;const c={};$.value.trim()&&(c.search={value:$.value.trim()});const i=((t=_.value.sortBy)==null?void 0:t[0])||"code",m=((l=_.value.sortDesc)==null?void 0:l[0])??!0,g={filters:c,pagination:{page:_.value.page,limit:_.value.itemsPerPage},sort:{sortBy:i,sortDesc:m}},x=await y.post("/api/cost/list/search",{type:"cost",...g});if((r=x.data)!=null&&r.items){const w=(_.value.page-1)*_.value.itemsPerPage;f.value=x.data.items.map((E,P)=>({...E,index:w+P+1})),C.value=x.data.total}else f.value=[],C.value=0}catch(c){console.error("Error fetching data:",c),v.fire({text:"خطا در بارگذاری داده‌ها: "+(((d=(a=c.response)==null?void 0:a.data)==null?void 0:d.detail)||c.message),icon:"error",confirmButtonText:"قبول"})}finally{p.value=!1}},R=J.debounce(()=>k(),500),O=async t=>{var r,a;if((await v.fire({text:"آیا از حذف این آیتم اطمینان دارید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"})).isConfirmed)try{p.value=!0,(await y.post("/api/accounting/remove",{code:t})).data.result===1&&(v.fire({text:"آیتم با موفقیت حذف شد",icon:"success",confirmButtonText:"قبول"}),k())}catch(d){console.error("Error deleting item:",d),v.fire({text:"خطا در حذف آیتم: "+(((a=(r=d.response)==null?void 0:r.data)==null?void 0:a.detail)||d.message),icon:"error",confirmButtonText:"قبول"})}finally{p.value=!1}},j=t=>{f.value.find(r=>r.code===t)&&(s.value.has(t)?s.value.delete(t):s.value.add(t))},N=()=>{s.value.size===f.value.length?s.value.clear():f.value.forEach(t=>{s.value.add(t.code)})},D=async(t=!1)=>{var l,r;try{if(p.value=!0,!t&&s.value.size===0){v.fire({text:"هیچ آیتمی برای خروجی انتخاب نشده است",icon:"warning",confirmButtonText:"قبول"});return}const a=t?f.value:f.value.filter(m=>s.value.has(m.code)),d=t?{all:!0}:{items:a},i=(await y.post("/api/costs/list/print",d)).data.id;window.open(`${U}/front/print/${i}`,"_blank")}catch(a){console.error("Error exporting PDF:",a),v.fire({text:"خطا در خروجی PDF: "+(((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.detail)||a.message),icon:"error",confirmButtonText:"قبول"})}finally{p.value=!1}},z=async(t=!1)=>{var l,r;try{if(p.value=!0,!t&&s.value.size===0){v.fire({text:"هیچ آیتمی برای خروجی انتخاب نشده است",icon:"warning",confirmButtonText:"قبول"});return}const a=t?f.value:f.value.filter(g=>s.value.has(g.code)),d=t?{all:!0}:{items:a},c=await y.post("/api/costs/list/excel",d,{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([c.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),m=document.createElement("a");m.href=i,m.setAttribute("download","costs.xlsx"),document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(i)}catch(a){console.error("Error exporting Excel:",a),v.fire({text:"خطا در خروجی Excel: "+(((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.detail)||a.message),icon:"error",confirmButtonText:"قبول"})}finally{p.value=!1}},G=async()=>{var l,r;if(s.value.size===0){v.fire({text:"هیچ آیتمی برای حذف انتخاب نشده است",icon:"warning",confirmButtonText:"قبول"});return}if((await v.fire({text:"آیا از حذف آیتم‌های انتخاب‌شده اطمینان دارید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"})).isConfirmed)try{p.value=!0;const d=Array.from(s.value).map(c=>y.post("/api/accounting/remove",{code:c}));await Promise.all(d),v.fire({text:"آیتم‌ها با موفقیت حذف شدند",icon:"success",confirmButtonText:"قبول"}),s.value.clear(),k()}catch(a){console.error("Error deleting group:",a),v.fire({text:"خطا در حذف گروهی: "+(((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.detail)||a.message),icon:"error",confirmButtonText:"قبول"})}finally{p.value=!1}};return K(()=>_.value.page,()=>{s.value.clear()}),W(()=>{k()}),(t,l)=>{const r=u("v-btn"),a=u("v-tooltip"),d=u("v-spacer"),c=u("v-slide-group-item"),i=u("v-icon"),m=u("v-list-subheader"),g=u("v-list-item"),x=u("v-list"),w=u("v-menu"),E=u("v-slide-group"),P=u("v-toolbar"),M=u("v-text-field"),A=u("v-checkbox"),Q=u("v-data-table-server");return X(),Y(ee,null,[e(P,{color:"toolbar",title:t.$t("drawer.costs")},{prepend:o(()=>[e(a,{text:t.$t("dialog.back"),location:"bottom"},{activator:o(({props:n})=>[e(r,h(n,{onClick:l[0]||(l[0]=B=>t.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1},8,["text"])]),default:o(()=>[e(d),e(E,{"show-arrows":""},{default:o(()=>[e(c,null,{default:o(()=>[e(a,{text:t.$t("dialog.add_new"),location:"bottom"},{activator:o(({props:n})=>[e(r,h(n,{icon:"mdi-plus",color:"primary",to:"/acc/costs/mod/"}),null,16)]),_:1},8,["text"])]),_:1}),e(c,null,{default:o(()=>[e(w,null,{activator:o(({props:n})=>[e(r,h(n,{icon:"",color:"red"}),{default:o(()=>[e(a,{activator:"parent",text:t.$t("dialog.export_pdf"),location:"bottom"},null,8,["text"]),e(i,{icon:"mdi-file-pdf-box"})]),_:2},1040)]),default:o(()=>[e(x,null,{default:o(()=>[e(m,{color:"primary"},{default:o(()=>[I(S(t.$t("dialog.export_pdf")),1)]),_:1}),e(g,{disabled:!T.value,class:"text-dark",title:t.$t("dialog.selected"),onClick:l[1]||(l[1]=n=>D(!1))},{prepend:o(()=>[e(i,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["disabled","title"]),e(g,{class:"text-dark",title:t.$t("dialog.all"),onClick:l[2]||(l[2]=n=>D(!0))},{prepend:o(()=>[e(i,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:o(()=>[e(w,null,{activator:o(({props:n})=>[e(r,h(n,{icon:"",color:"green"}),{default:o(()=>[e(a,{activator:"parent",text:t.$t("dialog.export_excel"),location:"bottom"},null,8,["text"]),e(i,{icon:"mdi-file-excel-box"})]),_:2},1040)]),default:o(()=>[e(x,null,{default:o(()=>[e(m,{color:"primary"},{default:o(()=>[I(S(t.$t("dialog.export_excel")),1)]),_:1}),e(g,{disabled:!T.value,class:"text-dark",title:t.$t("dialog.selected"),onClick:l[3]||(l[3]=n=>z(!1))},{prepend:o(()=>[e(i,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["disabled","title"]),e(g,{class:"text-dark",title:t.$t("dialog.all"),onClick:l[4]||(l[4]=n=>z(!0))},{prepend:o(()=>[e(i,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:o(()=>[e(a,{text:t.$t("dialog.delete"),location:"bottom"},{activator:o(({props:n})=>[e(r,h(n,{icon:"mdi-trash-can",color:"danger",onClick:G,disabled:!T.value}),null,16,["disabled"])]),_:1},8,["text"])]),_:1})]),_:1})]),_:1},8,["title"]),e(M,{loading:p.value,color:"green",class:"mb-0 pt-0 rounded-0","hide-details":"auto",density:"compact",placeholder:t.$t("dialog.search_txt"),modelValue:$.value,"onUpdate:modelValue":l[5]||(l[5]=n=>$.value=n),type:"text",onInput:Z(R)},{"prepend-inner":o(()=>[e(a,{location:"bottom",text:t.$t("dialog.search")},{activator:o(({props:n})=>[e(i,h(n,{color:"danger",icon:"mdi-magnify"}),null,16)]),_:1},8,["text"])]),_:1},8,["loading","placeholder","modelValue","onInput"]),e(Q,{headers:F.value,items:f.value,loading:p.value,"items-length":C.value,options:_.value,"onUpdate:options":[l[6]||(l[6]=n=>_.value=n),k],"item-value":"code",class:"elevation-1 data-table-wrapper","header-props":{class:"custom-header"}},{"header.checkbox":o(()=>[e(A,{"model-value":L.value,onChange:N,"hide-details":"",density:"compact"},null,8,["model-value"])]),"item.checkbox":o(({item:n})=>[e(A,{"model-value":s.value.has(n.code),onChange:B=>j(n.code),"hide-details":"",density:"compact"},null,8,["model-value","onChange"])]),"item.operation":o(({item:n})=>[e(w,null,{activator:o(({props:B})=>[e(r,h({variant:"text",size:"small",color:"error",icon:"mdi-menu"},B),null,16)]),default:o(()=>[e(x,null,{default:o(()=>[e(g,{class:"text-dark",title:t.$t("dialog.view"),to:"/acc/accounting/view/"+n.code},{prepend:o(()=>[e(i,{icon:"mdi-file",color:"primary"})]),_:2},1032,["title","to"]),e(g,{class:"text-dark",title:t.$t("dialog.edit"),to:"/acc/costs/mod/"+n.code},{prepend:o(()=>[e(i,{icon:"mdi-pencil"})]),_:2},1032,["title","to"]),e(g,{class:"text-dark",title:t.$t("dialog.delete"),onClick:B=>O(n.code)},{prepend:o(()=>[e(i,{color:"deep-orange-accent-4",icon:"mdi-trash-can"})]),_:2},1032,["title","onClick"])]),_:2},1024)]),_:2},1024)]),"item.amount":o(({item:n})=>[I(S(t.$filters.formatNumber(n.amount)),1)]),_:1},8,["headers","items","loading","items-length","options"])],64)}}},re=q(te,[["__scopeId","data-v-a34e9d25"]]);export{re as default};
