import{_ as $,a as v,S as h,c as q}from"./main-9b36f05f.js";import{a as n,o as f,s as w,b as l,w as i,F as k,_ as E,aa as O,d as c,t as d,c as y,A as F,C as M,e as P}from"./vendor-adef9cb4.js";const G={name:"show",data(){return{item:{id:"",state:"",body:"",dateSubmit:"",fileName:null},replays:[],replay:"",ticketState:null,states:["در حال پیگیری","پاسخ داده شده","خاتمه یافته"],attachedFile:null,sendSms:!0,loading:!1}},methods:{loadData(){this.loading=!0,v.post("/api/admin/support/view/"+this.$route.params.id).then(e=>{this.loading=!1,this.item=e.data.data.item,this.replays=e.data.data.replays,this.ticketState=this.item.state}).catch(e=>{this.loading=!1,h.fire({text:this.$t("pages.support.load_error")+e.message,icon:"error",confirmButtonText:this.$t("dialog.confirm")})})},validateFileType(e){if(!e||Array.isArray(e)&&e.length===0)return!0;const a=Array.isArray(e)&&e.length>0?e[0]:e instanceof File?e:null;return a?["image/png","image/jpeg","image/jpg","application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-rar-compressed"].includes(a.type)||this.$t("validator.invalid_file_type"):this.$t("validator.invalid_file_type")},validateFileSize(e){if(!e||Array.isArray(e)&&e.length===0)return!0;const a=Array.isArray(e)&&e.length>0?e[0]:e instanceof File?e:null;return a?a.size<5*1024*1024||this.$t("validator.file_size_limit"):this.$t("validator.invalid_file_type")},downloadFile(e,a){this.loading=!0,v.get(q()+"/api/support/download/file/"+e,{responseType:"blob"}).then(r=>{this.loading=!1;const s=window.URL.createObjectURL(new Blob([r.data])),t=document.createElement("a");t.href=s,t.setAttribute("download",a),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)}).catch(r=>{var s,t;this.loading=!1,h.fire({text:this.$t("pages.support.download_error")+(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message),icon:"error",confirmButtonText:this.$t("dialog.confirm")})})},async submit(){const{valid:e}=await this.$refs.form.validate();if(e){this.loading=!0;const a=new FormData;a.append("body",this.replay),a.append("sendSms",this.sendSms),a.append("state",this.ticketState);const r=Array.isArray(this.attachedFile)&&this.attachedFile.length>0?this.attachedFile[0]:this.attachedFile;r&&a.append("files[0]",r),v.post("/api/admin/support/mod/"+this.item.id,a,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{this.loading=!1,s.data.error===0&&h.fire({text:this.$t("pages.support.reply_submitted"),icon:"success",confirmButtonText:this.$t("dialog.confirm")}).then(()=>{this.loadData(),this.replay="",this.attachedFile=null})}).catch(s=>{this.loading=!1,h.fire({text:this.$t("pages.support.submit_error")+s.message,icon:"error",confirmButtonText:this.$t("dialog.confirm")})})}}},mounted(){this.loadData()}},H={class:"text-primary"};function I(e,a,r,s,t,m){const b=n("v-spacer"),_=n("v-btn"),S=n("v-tooltip"),x=n("v-toolbar"),V=n("v-card-text"),A=n("v-card-actions"),g=n("v-card"),p=n("v-col"),u=n("v-row"),C=n("v-chip"),T=n("v-alert"),z=n("v-timeline-item"),B=n("v-timeline"),N=n("v-switch"),U=n("v-textarea"),j=n("v-select"),D=n("v-file-input"),L=n("v-form"),R=n("v-container");return f(),w(k,null,[l(x,{color:"toolbar",title:e.$t("pages.support.view_ticket")},{default:i(()=>[l(b),l(S,{text:e.$t("pages.support.titlebar_admin"),location:"bottom"},{activator:i(({props:o})=>[l(_,E(o,{icon:"mdi-forum",color:"primary",to:"/profile/manager/support-list"}),null,16)]),_:1},8,["text"])]),_:1},8,["title"]),l(R,{class:"pa-0 ma-0"},{default:i(()=>[l(u,null,{default:i(()=>[l(p,null,{default:i(()=>[l(L,{"fast-fail":"",ref:"form",onSubmit:a[6]||(a[6]=O(()=>{},["prevent"]))},{default:i(()=>[l(g,{class:"pa-3",loading:t.loading?"red":null,disabled:t.loading,flat:""},{default:i(()=>[l(u,null,{default:i(()=>[l(p,{cols:"12",md:"12"},{default:i(()=>[l(g,{color:"primary",class:"mx-auto","prepend-icon":"mdi-account",subtitle:t.item.dateSubmit+" "+t.item.state,title:t.item.title},{default:i(()=>[l(V,null,{default:i(()=>[c(d(t.item.body),1)]),_:1}),l(A,null,{default:i(()=>[c(d(e.$t("pages.support.ticket_id"))+" "+d(t.item.id)+" ",1),l(b),t.item.fileName?(f(),y(_,{key:0,"prepend-icon":"mdi-paperclip",size:"small",variant:"outlined",onClick:a[0]||(a[0]=o=>m.downloadFile(t.item.id,t.item.fileName))},{default:i(()=>[c(d(e.$t("dialog.attach_download")),1)]),_:1})):F("",!0)]),_:1})]),_:1},8,["subtitle","title"])]),_:1})]),_:1}),l(B,{side:"end",class:"align-end"},{default:i(()=>[(f(!0),w(k,null,M(t.replays,o=>(f(),y(z,{key:o.id,"dot-color":o.owner?"primary":"warning",size:"small"},{default:i(()=>[l(T,{color:"",icon:"mdi-account",value:!0},{default:i(()=>[P("span",H,d(o.submitter.name)+" :",1),c(" "+d(o.body)+" ",1),l(u,null,{default:i(()=>[l(p,null,{default:i(()=>[l(C,{color:"primary","prepend-icon":"mdi-clock-outline",variant:"tonal"},{default:i(()=>[c(d(o.dateSubmit),1)]),_:2},1024)]),_:2},1024),l(p,null,{default:i(()=>[o.fileName?(f(),y(_,{key:0,"prepend-icon":"mdi-paperclip",size:"small",variant:"outlined",onClick:J=>m.downloadFile(o.id,o.fileName)},{default:i(()=>[c(d(e.$t("dialog.attach_download")),1)]),_:2},1032,["onClick"])):F("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1}),l(u,null,{default:i(()=>[l(p,null,{default:i(()=>[l(g,{class:"pa-3",loading:t.loading?"red":null,disabled:t.loading,flat:""},{default:i(()=>[l(u,null,{default:i(()=>[l(p,{cols:"12",sm:"12",md:"12"},{default:i(()=>[l(N,{modelValue:t.sendSms,"onUpdate:modelValue":a[1]||(a[1]=o=>t.sendSms=o),"hide-details":"auto",label:e.$t("pages.support.send_sms"),color:"primary",inset:""},null,8,["modelValue","label"]),l(U,{"auto-grow":"",label:e.$t("pages.support.replay"),modelValue:t.replay,"onUpdate:modelValue":a[2]||(a[2]=o=>t.replay=o),type:"text","prepend-inner-icon":"mdi-text",rules:[()=>t.replay.length>0||e.$t("validator.required")]},null,8,["label","modelValue","rules"])]),_:1}),l(p,{cols:"12",sm:"12",md:"6"},{default:i(()=>[l(j,{modelValue:t.ticketState,"onUpdate:modelValue":a[3]||(a[3]=o=>t.ticketState=o),items:t.states,label:"وضعیت تیکت","prepend-inner-icon":"mdi-list-status",rules:[()=>!!t.ticketState||e.$t("validator.required")]},null,8,["modelValue","items","rules"])]),_:1}),l(p,{cols:"12",sm:"12",md:"6"},{default:i(()=>[l(D,{modelValue:t.attachedFile,"onUpdate:modelValue":a[4]||(a[4]=o=>t.attachedFile=o),label:e.$t("dialog.attach_file"),"prepend-icon":"mdi-paperclip",accept:".png, .jpg, .jpeg, .pdf, .xls, .xlsx, .zip, .rar",rules:[m.validateFileType,m.validateFileSize],hint:e.$t("dialog.allowed_file_types_hint"),"persistent-hint":"",optional:""},null,8,["modelValue","label","rules","hint"])]),_:1})]),_:1}),l(_,{onClick:a[5]||(a[5]=o=>m.submit()),type:"submit",color:"primary",class:"mt-3","prepend-icon":"mdi-content-save",loading:t.loading},{default:i(()=>[c(d(e.$t("dialog.save")),1)]),_:1},8,["loading"])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["loading","disabled"])]),_:1},512)]),_:1})]),_:1})]),_:1})],64)}const W=$(G,[["render",I]]);export{W as default};
