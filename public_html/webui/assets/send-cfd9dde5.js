import{S as d,a as r,_ as w}from"./main-9b36f05f.js";import{h as q,a as y,o as C,s as k,e as t,b as m,u as a,ab as g,d as i,t as c,B as n,F as A,C as B,w as f,_ as D}from"./vendor-adef9cb4.js";import{_ as U,a as E,b as P,c as V}from"./recList-3e892c5b.js";const j=q({name:"rec",props:{totalAmount:Number,originalDoc:String,person:[String,Number],windowsState:Object},data:()=>({submitedDoc:{},des:"",items:[],date:"",year:{},listBanks:[],listSalarys:[],listCashdesks:[],listChequesForPay:[],totalPays:0,currencyConfig:{masked:!1,prefix:"",suffix:"ریال",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0}}),methods:{fillWithTotal(e){e.bs=this.$props.totalAmount},addItem(e){let s={},l=!0;e=="bank"?this.listBanks.length==0?(d.fire({text:"ابتدا یک حساب بانکی ایجاد کنید.در حال حاضر هیچ بانکی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1):s={id:"",type:"bank",bank:{},cashdesk:{},salary:{},cheque:{},chequeforpay:{},bs:0,bd:0,des:"",table:5,referral:""}:e=="cashdesk"?(this.listCashdesks.length==0&&(d.fire({text:"ابتدا یک صندوق ایجاد کنید.در حال حاضر هیچ صندوقی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1),s={id:"",type:"cashdesk",bank:{},cashdesk:{},salary:{},cheque:{},chequeforpay:{},bs:0,bd:0,des:"",table:121,referral:""}):e=="chequeForPay"?this.listChequesForPay.length==0?(d.fire({text:"هیچ چک قابل واگذاری یافت نشد.",icon:"error",confirmButtonText:"قبول"}),l=!1):s={id:"",type:"chequeforpay",bank:{},cashdesk:{},salary:{},cheque:{},chequeforpay:{},bs:0,bd:0,des:"",table:125,referral:""}:e=="salary"&&(this.listSalarys.length==0&&(d.fire({text:"ابتدا یک تخواه گردان ایجاد کنید.در حال حاضر هیچ تنخواه گردانی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1),s={id:"",type:"salary",bank:{},cashdesk:{},salary:{},cheque:{},chequeforpay:{},bs:0,bd:0,des:"",table:122,referral:""}),l&&this.items.push(s)},deleteItem(e){this.items.splice(e,1),this.calc()},loadData(){r.post("/api/bank/list").then(e=>{this.listBanks=e.data}),r.post("/api/salary/list").then(e=>{this.listSalarys=e.data}),r.post("/api/cashdesk/list").then(e=>{this.listCashdesks=e.data}),r.post("/api/cheque/list/forpay").then(e=>{this.listChequesForPay=e.data}),r.post("/api/year/get").then(e=>{this.year=e.data,this.date=e.data.now})},calc(){this.totalPays=0,this.items.forEach(e=>{this.totalPays+=parseInt(e.bs)})},async submit(){let e=[];if(this.$props.totalAmount<this.totalPays&&e.push("مبالغ وارد شده بیشتر از مبلغ فاکتور است."),this.items.forEach((s,l)=>{s.bs==0&&e.push("مبلغ صفر در ردیف "+(l+1)+" نا معتبر است."),s.type=="bank"?(s.bank==null||Object.keys(s.bank).length==0)&&e.push("بانک در ردیف  "+(l+1)+" انتخاب نشده است."):s.type=="salary"?(s.salary==null||Object.keys(s.salary).length==0)&&e.push("تنخواه گردان در ردیف  "+(l+1)+" انتخاب نشده است."):s.type=="cashdesk"&&(s.cashdesk==null||Object.keys(s.cashdesk).length==0)&&e.push("صندوق در ردیف  "+(l+1)+" انتخاب نشده است.")}),this.items.length==0)d.fire({text:"هیچ پرداختی ثبت نشده است.",icon:"error",confirmButtonText:"قبول"});else if(e.length!=0){let s='<ul class="justify-content-center">';e.forEach(l=>{s+='<div class="">'+l+"</div>"}),s+="</ul>",d.fire({html:s,icon:"error",confirmButtonText:"قبول"})}else{let s=[...this.items];s.forEach(l=>{l.type=="bank"?l.id=l.bank.id:l.type=="salary"?l.id=l.salary.id:l.type=="cashdesk"&&(l.id=l.cashdesk.id),l.des==""&&(l.des="پرداخت وجه فاکتور شماره "+this.$props.originalDoc)}),s.push({id:this.$props.person,type:"person",bd:this.totalPays,bs:0,table:3,des:"پرداخت وجه فاکتور شماره "+this.$filters.formatNumber(this.$props.originalDoc)}),this.des==""&&(this.des="پرداخت وجه فاکتور شماره "+this.$filters.formatNumber(this.originalDoc)),r.post("/api/accounting/insert",{date:this.date,des:this.des,type:"buy_send",update:null,rows:s,related:this.$props.originalDoc}).then(l=>{l.data.result=="1"?d.fire({text:"سند با موفقیت ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(_=>{this.submitedDoc=l.data.doc,this.$props.windowsState.submited=!0}):l.data.result=="4"&&d.fire({text:l.data.msg,icon:"error",confirmButtonText:"قبول"})})}}},mounted(){this.loadData()}}),N={class:"row mb-3"},I={class:"col-sm-12 col-md-5 mb-2"},S={class:"col-sm-12 col-md-7 mb-2"},T={class:"row"},x={class:"col-12 text-center"},Y={class:"input-group text-center justify-content-center"},M={class:"dropdown-menu"},O={class:"input-group-text"},R={class:"input-group-text"},W={class:"row"},H={class:"col"},L={class:"alert alert-info mx-3"},z={class:"col-12 ps-2"},G={class:"card my-1"},J={class:"card-body p-1"},K={class:"row"},Q={class:"col-2 text-center"},X={class:"mb-1 text-start"},Z={class:"badge bg-primary-light"},ss={src:U,class:"img-fluid"},ts={src:E,class:"img-fluid"},es={src:P,class:"img-fluid"},os={src:V,class:"img-fluid"},ls={src:V,class:"img-fluid"},us=["onClick"],as={class:"col-10 my-2 ps-0"},is={class:"row"},ns={class:"col-sm-12 col-md-6"},ds={class:""},rs={class:""},ms={class:""},cs={class:""},ps={class:"col-sm-12 col-md-6"},fs={class:"mb-1"},bs={class:"block-options"},hs=["onClick"],ys={class:"col-sm-12 col-md-6"},Cs={class:"mb-1"},ks=["onUpdate:modelValue"],gs={class:"col-sm-12 col-md-6"},vs={class:"mb-1"},As=["onUpdate:modelValue"];function Vs(e,s,l,_,_s,$s){const $=y("date-picker"),p=y("v-cob"),F=y("money3");return C(),k(A,null,[t("div",N,[t("div",I,[m($,{class:"form-control",modelValue:e.date,"onUpdate:modelValue":s[0]||(s[0]=o=>e.date=o),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:e.year.start,max:e.year.end},null,8,["modelValue","min","max"])]),t("div",S,[a(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=o=>e.des=o),placeholder:"شرح"},null,512),[[g,e.des]])])]),t("div",T,[t("div",x,[t("div",Y,[s[15]||(s[15]=t("button",{class:"btn btn-outline-success dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," افزودن پرداخت ",-1)),t("ul",M,[t("li",null,[t("button",{type:"button",onClick:s[2]||(s[2]=o=>e.addItem("bank")),class:"dropdown-item"},s[9]||(s[9]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" حساب بانکی")]))]),t("li",null,[t("button",{type:"button",onClick:s[3]||(s[3]=o=>e.addItem("cashdesk")),class:"dropdown-item"},s[10]||(s[10]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" صندوق")]))]),t("li",null,[t("button",{type:"button",onClick:s[4]||(s[4]=o=>e.addItem("salary")),class:"dropdown-item"},s[11]||(s[11]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" تنخواه گردان")]))]),t("li",null,[t("button",{disabled:"disabled",type:"button",onClick:s[5]||(s[5]=o=>e.addItem("cheque")),class:"dropdown-item"},s[12]||(s[12]=[t("i",{class:"fa fa-dot-circle"},null,-1),i("چک")]))]),t("li",null,[t("button",{disabled:"disabled",type:"button",onClick:s[6]||(s[6]=o=>e.addItem("chequeForPay")),class:"dropdown-item"},s[13]||(s[13]=[t("i",{class:"fa fa-dot-circle"},null,-1),i("خرج چک")]))])]),t("span",O," مجموع: "+c(e.$filters.formatNumber(parseInt(this.totalPays)))+" "+c(e.$filters.getActiveMoney().shortName),1),t("span",R," باقی مانده: "+c(e.$filters.formatNumber(parseInt(this.$props.totalAmount)-parseInt(this.totalPays)))+" "+c(e.$filters.getActiveMoney().shortName),1),t("button",{onClick:s[7]||(s[7]=o=>e.submit()),class:"btn btn-primary",type:"button"},s[14]||(s[14]=[t("i",{class:"fa fa-save me-2"},null,-1),i(" ثبت ")]))])]),t("div",W,[t("div",H,[s[17]||(s[17]=t("p",{class:"mb-1"},"پرداخت‌ها:",-1)),a(t("div",L,s[16]||(s[16]=[t("i",{class:"fa fa-info"},null,-1),i(" پرداختی افزوده نشده است! ")]),512),[[n,e.items.length===0]])])]),(C(!0),k(A,null,B(e.items,(o,v)=>(C(),k("div",z,[t("i",G,[t("div",J,[t("div",K,[t("div",Q,[t("h6",X,[t("span",Z,c(v+1),1)]),a(t("img",ss,null,512),[[n,o.type=="bank"]]),a(t("img",ts,null,512),[[n,o.type=="cashdesk"]]),a(t("img",es,null,512),[[n,o.type=="salary"]]),a(t("img",os,null,512),[[n,o.type=="cheque"]]),a(t("img",ls,null,512),[[n,o.type=="chequeforpay"]]),t("button",{onClick:u=>e.deleteItem(v),type:"button",class:"btn text-danger mt-2"},s[18]||(s[18]=[t("i",{class:"fa fa-trash"},null,-1)]),8,us)]),t("div",as,[t("div",is,[t("div",ns,[a(t("div",ds,[s[20]||(s[20]=t("label",{class:"form-label"},"بانک",-1)),m(p,{dir:"rtl",options:e.listBanks,label:"name",modelValue:o.bank,"onUpdate:modelValue":u=>o.bank=u},{"no-options":f(({search:u,searching:b,loading:h})=>s[19]||(s[19]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,o.type=="bank"]]),a(t("div",rs,[s[22]||(s[22]=t("label",{class:"form-label"},"چک‌های قابل واگذاری",-1)),m(p,{dir:"rtl",options:e.listChequesForPay,label:"label",modelValue:o.chequeforpay,"onUpdate:modelValue":u=>o.chequeforpay=u},{"no-options":f(({search:u,searching:b,loading:h})=>s[21]||(s[21]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,o.type=="chequeforpay"]]),a(t("div",ms,[s[24]||(s[24]=t("label",{class:"form-label"},"صندوق",-1)),m(p,{dir:"rtl",options:e.listCashdesks,label:"name",modelValue:o.cashdesk,"onUpdate:modelValue":u=>o.cashdesk=u},{"no-options":f(({search:u,searching:b,loading:h})=>s[23]||(s[23]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,o.type=="cashdesk"]]),a(t("div",cs,[s[26]||(s[26]=t("label",{class:"form-label"},"تنخواه گردان",-1)),m(p,{dir:"rtl",options:e.listSalarys,label:"name",modelValue:o.salary,"onUpdate:modelValue":u=>o.salary=u},{"no-options":f(({search:u,searching:b,loading:h})=>s[25]||(s[25]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,o.type=="salary"]])]),t("div",ps,[t("div",fs,[t("div",bs,[s[27]||(s[27]=t("label",{class:"form-label"},"مبلغ",-1)),t("button",{onClick:u=>e.fillWithTotal(o),class:"btn btn-sm btn-link block-options-item float-end me-2"},"کل فاکتور",8,hs)]),m(F,D({onChange:s[8]||(s[8]=u=>e.calc()),class:"form-control",modelValue:o.bs,"onUpdate:modelValue":u=>o.bs=u,ref_for:!0},e.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])]),t("div",ys,[t("div",Cs,[s[28]||(s[28]=t("label",{class:"form-label"},"ارجاع",-1)),a(t("input",{type:"text","onUpdate:modelValue":u=>o.referral=u,class:"form-control"},null,8,ks),[[g,o.referral]])])]),t("div",gs,[t("div",vs,[s[29]||(s[29]=t("label",{class:"form-label"},"شرح",-1)),a(t("input",{class:"form-control","onUpdate:modelValue":u=>o.des=u},null,8,As),[[g,o.des]])])])])])])])])]))),256))])],64)}const Bs=w(j,[["render",Vs]]);export{Bs as s};
