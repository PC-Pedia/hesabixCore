import{a as m,S as f,_ as L}from"./main-9b36f05f.js";import{a as H,q as K}from"./quickAddCommodity-50dce749.js";import{q as Q}from"./quickAdd-3f821e67.js";import{av as N,h as X,a as d,o as T,s as E,b as a,w as l,F as R,_ as I,d as u,t as r,e as o,C as Z,c as ee,u as _,ab as te,ao as V}from"./vendor-adef9cb4.js";import"./vue3-treeselect.common-f8cf97d9.js";/* empty css                        */typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const q=()=>{};function oe(e,t){function i(...n){return new Promise((p,b)=>{Promise.resolve(e(()=>t.apply(this,n),{fn:t,thisArg:this,args:n})).then(p).catch(b)})}return i}function se(e,t={}){let i,n,p=q;const b=v=>{clearTimeout(v),p(),p=q};let g;return v=>{const k=N(e),h=N(t.maxWait);return i&&b(i),k<=0||h!==void 0&&h<=0?(n&&(b(n),n=null),Promise.resolve(v())):new Promise((y,A)=>{p=t.rejectOnCancel?A:y,g=v,h&&!n&&(n=setTimeout(()=>{i&&b(i),n=null,y(g())},h)),i=setTimeout(()=>{n&&b(n),n=null,y(v())},k)})}}function ae(e,t=200,i={}){return oe(se(t,i),e)}const ie=X({name:"fastMod",components:{quickAddCommodity:H,quickView:K,quickAdd:Q},data(){const e=this;return{barcodeSearch:"",onInput:ae(()=>{e.barcodeSearch!=""&&(e.loading=!0,m.post("/api/commodity/list/search/barcode",{barcode:e.barcodeSearch}).then(t=>{e.loading=!1,t.data.Success==!0?e.addFastItem(t.data.data):f.fire({text:e.$t("dialog.commodity_not_found"),icon:"error",confirmButtonText:"قبول"}),e.barcodeSearch=""}))},500),tabs:0,canSubmitRecpDoc:!0,canPdf:!0,canPrint:!0,canPrintCashdeskRecp:!1,update:0,commodity:[],selectedCommodity:null,tempID:"",year:{},data:{des:"",date:"",items:[]},itemsSelected:[],unitConfig:{masked:!1,prefix:"",suffix:"",thousands:",",decimal:".",precision:0,disableNegative:!0,disabled:!1,allowBlank:!1,shouldRound:!1,focusOnRight:!0},units:[],persons:[],person:{nikename:""},cashdesks:[],cashdesk:null,commoditySpeedAccess:[],loading:!0,sumSelected:0,sumTotal:0,headers:[{text:"کالا",value:"commodity.name"},{text:"تعداد",value:"count",width:"100"},{text:"واحد",value:"commodity.unit"},{text:"مبلغ واحد(ریال)",value:"commodity.priceSell"},{text:"مبلغ کل(ریال)",value:"bs"},{text:"عملیات",value:"operation"}]}},methods:{searchPerson(e,t){t(!0),m.post("/api/person/list/search",{search:e}).then(i=>{this.persons=i.data,t(!1)})},searchCommodity(e,t){t(!0),m.post("/api/commodity/list/search",{search:e}).then(i=>{this.commodity=i.data,t(!1),document.querySelector(".cobcom div div input")!=null&&document.querySelector(".cobcom div div input").focus()})},calcInvoice(){this.sumTotal=0,this.data.items.forEach(e=>{this.sumTotal+=parseFloat(e.bs),e.bs=e.count*e.commodity.priceSell})},newPage(e=!0){e==!0?this.data.items.length!=0&&f.fire({text:"آیا فاکتور کنونی را نادیده می گیرید؟",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"}).then(t=>{t.isConfirmed&&(this.loadData(),this.data.items=[])}):(this.loadData(),this.data.items=[])},getCount(e){let t=0;return this.data.items.forEach(i=>{i.commodity.code===e.code&&(t=i.count)}),t},addFastItem(e){let t=!0;if(this.data.items.forEach(n=>{n.commodity.code==e.code&&(n.count++,n.bs+=e.priceSell,t=!1)}),t){var i={commodity:e,id:0,bs:parseInt(e.priceSell),bd:0,count:1,price:parseInt(e.priceSell),type:"commodity",des:"",table:53,unitFormat:JSON.parse(JSON.stringify(this.unitConfig)),arrayIndex:this.data.items.length};i.unitFormat.precision=e.unitData.floatNumber,this.data.items.push(i)}},loadData(){m.post("/api/year/get").then(e=>{this.year=e.data,this.data.date=e.data.now}),m.post("/api/person/list/limit",{speedAccess:!0}).then(e=>{this.persons=e.data,e.data.length!=0&&(this.person=e.data[0])}),m.post("/api/cashdesk/list",{speedAccess:!0}).then(e=>{this.cashdesks=e.data,e.data.length!=0&&(this.cashdesk=e.data[0])}),m.post("/api/commodity/list",{speedAccess:!0}).then(e=>{this.commoditySpeedAccess=e.data,this.commodity=e.data}),m.post("/api/commodity/units").then(e=>{this.units=e.data}),m.post("/api/printers/options/info").then(e=>{this.loading=!1,this.canPdf=e.data.fastsell.pdf,this.canPrintCashdeskRecp=e.data.fastsell.cashdeskTicket,this.canPrint=e.data.fastsell.invoice})},save(){if(this.data.items.length===0)f.fire({text:"فاکتور فاقد کالا می‌باشد.",icon:"error",confirmButtonText:"بازگشت"});else if(this.person==null||this.person==null)f.fire({text:"مشتری انتخاب نشده است.",icon:"error",confirmButtonText:"بازگشت"});else if(this.cashdesk==null||this.cashdesk==null)f.fire({text:"صندوق انتخاب نشده است.",icon:"error",confirmButtonText:"بازگشت"});else{let e=!0;if(this.data.items.forEach(t=>{t.bs==0&&(e=!1)}),e){this.loading=!0;let t=[...this.data.items],i=0;this.data.items.forEach(n=>{i=i+parseInt(n.bs)}),t.push({bs:0,bd:i,type:"person",id:this.person.id,des:"فروش کالا به مشتری",table:3}),m.post("/api/accounting/insert",{type:"sell",date:this.data.date,des:this.data.des,rows:t,update:""}).then(n=>{this.loading=!1,n.data.result=="1"?(this.update=n.data.doc.code,(this.canPrint||this.canPrintCashdeskRecp)&&m.post("/api/sell/posprinter/invoice",{code:this.update,pdf:this.canPdf,posPrint:this.canPrint,posPrintRecp:this.canPrintCashdeskRecp}).then(p=>{this.canPdf&&(this.printID=p.data.id,window.open(this.$API_URL+"/front/print/"+this.printID,"_blank","noreferrer"))}),this.canSubmitRecpDoc&&(t=[],t.push({bs:i,bd:0,type:"person",id:this.person.id,des:"دریافت وجه فاکتور",table:3}),t.push({bs:0,bd:i,type:"cashdesk",id:this.cashdesk.id,des:"دریافت وجه فاکتور",table:121}),this.tempID=n.data.doc.code,m.post("/api/accounting/insert",{type:"sell_receive",date:this.data.date,des:"دریافت وجه فاکتور",rows:t,update:"",related:n.data.doc.code}).then(p=>{p.data.result=="4"&&f.fire({text:p.data.msg,icon:"error",confirmButtonText:"قبول"})})),f.fire({text:"فاکتور ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(()=>{this.newPage(!1)})):n.data.result=="4"&&f.fire({text:n.data.msg,icon:"error",confirmButtonText:"قبول"})})}else f.fire({text:"قیمت یکی از اقلام صفر است",icon:"error",confirmButtonText:"قبول"})}},deleteItem(e){if(this.data.items.length==1)this.data.items=[];else{let t=0;for(let i=0;i<this.data.items.length;i++)t++,this.data.items[i].commodity.code==e&&this.data.items.splice(t-1,1);for(let i=0;i<this.data.items.length;i++)this.data.items[i].arrayIndex=i}}},mounted(){this.loadData()},watch:{itemsSelected:{handler:function(e,t){this.sumSelected=0,this.itemsSelected.forEach(i=>{this.sumSelected+=parseFloat(i.bs)})},deep:!0},"data.items":{handler:function(e,t){this.calcInvoice()},deep:!0},selectedCommodity:{handler:function(e,t){if(e!=null){let i=!0;this.commoditySpeedAccess.forEach(n=>{n.id==e.id&&(i=!1)}),i&&this.commoditySpeedAccess.push(e),this.addFastItem(e),this.selectedCommodity=null}},deep:!0}}}),le={class:"card"},ne={class:"card-header"},de={class:"block-options float-end"},ue={class:"card-body p-0"},re={class:"badge text-bg-primary rounded-pill"},ce={class:"card mt-2"},me={class:"card-header"},pe={class:"block-options float-end"},fe={class:"card-body p-1"},he={class:"card mt-2"},be={class:"card-body p-1"},ve=["onClick"],ge={class:"container-fluid p-0 mx-0 mt-2"},ke={class:"block block-rounded block-link-shadow border-start border-success border-3",href:"javascript:void(0)"},Ce={class:"block-content block-content-full block-content-sm bg-body-light"},ye={class:"row"},_e={class:"col-sm-12 col-md-6"},Se={class:"text-primary"},we={class:"col-sm-12 col-md-6"},Ve={class:"text-primary"},Ae={class:"row"},Pe={class:"col-sm-12 col-md-6 mb-2"},$e={class:""},Fe={class:"col-sm-12 col-md-6 mb-2"},De={class:""},Te={class:"col-sm-12 col-md-6 mb-2"},Ie={class:"form-check form-switch form-check-inline"},Ue=["disabled"],Be={class:"row"},Ne={class:"col-sm-12 col-md-4"},Ee={class:"form-check form-switch form-check-inline"},Re=["disabled"],qe={class:"col-sm-12 col-md-4"},Me={class:"form-check form-switch form-check-inline"},je=["disabled"],Ye={class:"col-sm-12 col-md-4"},Oe={class:"form-check form-switch form-check-inline"},We=["disabled"];function xe(e,t,i,n,p,b){const g=d("v-btn"),S=d("v-tooltip"),v=d("v-spacer"),k=d("v-icon"),h=d("v-tab"),y=d("v-tabs"),A=d("v-toolbar"),M=d("quickAddCommodity"),j=d("v-text-field"),w=d("v-col"),U=d("v-row"),P=d("v-cob"),Y=d("v-list-item"),O=d("v-list"),W=d("quickView"),x=d("quickAdd"),B=d("money3"),z=d("EasyDataTable"),$=d("v-card-text"),F=d("v-card"),D=d("v-tabs-window-item"),G=d("date-picker"),J=d("v-tabs-window");return T(),E(R,null,[a(A,{color:"toolbar",title:e.$t("drawer.fast_sell")},{prepend:l(()=>[a(S,{text:e.$t("dialog.back"),location:"bottom"},{activator:l(({props:s})=>[a(g,I(s,{onClick:t[0]||(t[0]=c=>e.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1},8,["text"])]),extension:l(()=>[a(y,{color:"primary",class:"bg-light",grow:"",modelValue:e.tabs,"onUpdate:modelValue":t[3]||(t[3]=s=>e.tabs=s)},{default:l(()=>[a(h,{value:"0"},{default:l(()=>[u(r(e.$t("dialog.faktor_info")),1)]),_:1}),a(h,{value:"1"},{default:l(()=>[u(r(e.$t("dialog.details_faktor")),1)]),_:1}),a(h,{value:"2"},{default:l(()=>[u(r(e.$t("dialog.print_settings")),1)]),_:1})]),_:1},8,["modelValue"])]),default:l(()=>[a(v),a(g,{loading:e.loading,onClick:t[1]||(t[1]=s=>e.newPage()),icon:"",color:"danger"},{default:l(()=>[a(S,{activator:"parent",text:e.$t("dialog.new"),location:"bottom"},null,8,["text"]),a(k,{icon:"mdi-invoice-text-plus-outline"})]),_:1},8,["loading"]),a(g,{loading:e.loading,onClick:t[2]||(t[2]=s=>e.save()),icon:"",color:"green"},{default:l(()=>[a(S,{activator:"parent",text:e.$t("dialog.save"),location:"bottom"},null,8,["text"]),a(k,{icon:"mdi-content-save"})]),_:1},8,["loading"])]),_:1},8,["title"]),a(J,{modelValue:e.tabs,"onUpdate:modelValue":t[15]||(t[15]=s=>e.tabs=s)},{default:l(()=>[a(D,{value:"0"},{default:l(()=>[a(F,null,{default:l(()=>[a($,null,{default:l(()=>[a(U,null,{default:l(()=>[a(w,{cols:"12",sm:"12",md:"3",class:"pe-0 ps-0"},{default:l(()=>[o("div",le,[o("div",ne,[t[16]||(t[16]=o("i",{class:"fa fa-boxes me-2"},null,-1)),t[17]||(t[17]=u(" کالا ها و خدمات ")),o("div",de,[a(M)])]),o("div",ue,[a(j,{loading:e.loading,modelValue:e.barcodeSearch,"onUpdate:modelValue":t[4]||(t[4]=s=>e.barcodeSearch=s),onInput:e.onInput,clearable:"",label:e.$t("dialog.barcode"),color:"primary",class:"pa-2",density:"comfortable",variant:"outlined"},{"append-inner":l(({props:s})=>[a(k,{color:"danger",icon:"mdi-barcode-scan"})]),_:1},8,["loading","modelValue","onInput","label"]),a(P,{dir:"rtl",onSearch:e.searchCommodity,filterable:!1,options:e.commodity,label:"name",modelValue:e.selectedCommodity,"onUpdate:modelValue":t[5]||(t[5]=s=>e.selectedCommodity=s),class:"rounded-0 m-1 cobcom",placeholder:e.$t("dialog.search")},{"no-options":l(({search:s,searching:c,loading:C})=>t[18]||(t[18]=[u(" نتیجه‌ای یافت نشد! ")])),option:l(s=>[a(U,{class:"my-0 py-0"},{default:l(()=>[a(w,{class:"ma-0 py-0",cols:"12"},{default:l(()=>[u(r(s.name),1)]),_:2},1024),a(w,{class:"ma-0 py-0",cols:"12"},{default:l(()=>[u(r(e.$t("dialog.each"))+" "+r(s.unit)+":"+r(e.$filters.formatNumber(s.priceSell)),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["onSearch","options","modelValue","placeholder"]),a(O,{lines:"one"},{default:l(()=>[(T(!0),E(R,null,Z(e.commoditySpeedAccess,s=>(T(),ee(Y,{onClick:c=>e.addFastItem(s),title:s.name,subtitle:e.$t("dialog.each")+s.unit+":"+e.$filters.formatNumber(s.priceSell)},{append:l(c=>[o("span",re,r(e.getCount(s)+" "+s.unit),1)]),_:2},1032,["onClick","title","subtitle"]))),256))]),_:1})])]),o("div",ce,[o("div",me,[t[19]||(t[19]=o("i",{class:"fa fa-user me-2"},null,-1)),t[20]||(t[20]=u(" مشتری ")),o("div",pe,[a(W,{code:this.person.code},null,8,["code"]),a(x,{code:this.person.code},null,8,["code"])])]),o("div",fe,[a(P,{filterable:!1,dir:"rtl",onSearch:e.searchPerson,options:e.persons,label:"nikename",modelValue:e.person,"onUpdate:modelValue":t[6]||(t[6]=s=>e.person=s)},{"no-options":l(({search:s,searching:c,loading:C})=>t[21]||(t[21]=[u(" نتیجه‌ای یافت نشد! ")])),_:1},8,["onSearch","options","modelValue"])])]),o("div",he,[t[23]||(t[23]=o("div",{class:"card-header"},[o("i",{class:"fa fa-shopping-cart me-2"}),u(" صندوق ")],-1)),o("div",be,[a(P,{dir:"rtl",options:e.cashdesks,label:"name",modelValue:e.cashdesk,"onUpdate:modelValue":t[7]||(t[7]=s=>e.cashdesk=s)},{"no-options":l(({search:s,searching:c,loading:C})=>t[22]||(t[22]=[u(" نتیجه‌ای یافت نشد! ")])),_:1},8,["options","modelValue"])])])]),_:1}),a(w,{cols:"12",sm:"12",md:"9"},{default:l(()=>[a(z,{"table-class-name":"customize-table","show-index":"",headers:e.headers,"items-selected":e.itemsSelected,"onUpdate:itemsSelected":t[8]||(t[8]=s=>e.itemsSelected=s),items:e.data.items,"theme-color":"#1d90ff","header-text-direction":"center","border-cell":"","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:e.loading},{"item-commodity.priceSell":l(({commodity:s,arrayIndex:c})=>[a(B,I({modelValue:e.data.items[c].commodity.priceSell,"onUpdate:modelValue":C=>e.data.items[c].commodity.priceSell=C},e.unitConfig,{class:"form-control form-control-sm border-0 text-center"}),null,16,["modelValue","onUpdate:modelValue"])]),"item-commodity.name":l(({commodity:s})=>[o("span",null,r(e.$filters.formatNumber(s.code)+" - "+s.name),1)]),"item-bs":l(({bs:s})=>[o("span",null,r(e.$filters.formatNumber(s)),1)]),"item-count":l(({unitFormat:s,arrayIndex:c})=>[a(B,I({modelValue:e.data.items[c].count,"onUpdate:modelValue":C=>e.data.items[c].count=C},s,{class:"form-control form-control-sm border-0 text-center"}),null,16,["modelValue","onUpdate:modelValue"])]),"item-operation":l(({commodity:s})=>[o("span",{class:"text-danger px-1",onClick:c=>e.deleteItem(s.code)},t[24]||(t[24]=[o("i",{class:"fa fa-trash"},null,-1)]),8,ve)]),_:1},8,["headers","items-selected","items","loading"]),o("div",ge,[o("a",ke,[o("div",Ce,[o("div",ye,[o("div",_e,[t[25]||(t[25]=o("span",{class:"text-dark"},[o("i",{class:"fa fa-list-check"}),u(" جمع مبلغ موارد انتخابی: ")],-1)),o("span",Se,r(e.$filters.formatNumber(this.sumSelected))+" "+r(e.$filters.getActiveMoney().shortName),1)]),o("div",we,[t[26]||(t[26]=o("span",{class:"text-dark"},[o("i",{class:"fa fa-list-dots"}),u(" جمع کل: ")],-1)),o("span",Ve,r(e.$filters.formatNumber(this.sumTotal))+" "+r(e.$filters.getActiveMoney().shortName),1)])])])])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{value:"1"},{default:l(()=>[a(F,null,{default:l(()=>[a($,null,{default:l(()=>[o("div",Ae,[o("div",Pe,[o("div",$e,[t[27]||(t[27]=o("label",{class:"form-label"},"تاریخ:",-1)),a(G,{class:"",modelValue:e.data.date,"onUpdate:modelValue":t[9]||(t[9]=s=>e.data.date=s),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:e.year.start,max:e.year.end},null,8,["modelValue","min","max"])])]),o("div",Fe,[o("div",De,[t[28]||(t[28]=o("label",{class:"form-label"},"شرح:",-1)),_(o("input",{class:"form-control form-control-sm","onUpdate:modelValue":t[10]||(t[10]=s=>e.data.des=s),type:"text"},null,512),[[te,e.data.des]])])]),o("div",Te,[o("span",Ie,[_(o("input",{disabled:this.loading,"onUpdate:modelValue":t[11]||(t[11]=s=>e.canSubmitRecpDoc=s),class:"form-check-input",type:"checkbox"},null,8,Ue),[[V,e.canSubmitRecpDoc]]),t[29]||(t[29]=o("label",{class:"form-check-label"}," ثبت خودکار سند دریافت وجه فاکتور ",-1))])])])]),_:1})]),_:1})]),_:1}),a(D,{value:"2"},{default:l(()=>[a(F,null,{default:l(()=>[a($,null,{default:l(()=>[o("div",Be,[o("div",Ne,[o("span",Ee,[_(o("input",{disabled:this.loading,"onUpdate:modelValue":t[12]||(t[12]=s=>e.canPrint=s),class:"form-check-input",type:"checkbox"},null,8,Re),[[V,e.canPrint]]),t[30]||(t[30]=o("label",{class:"form-check-label"},[o("i",{class:"fa-solid fa-cloud me-1"}),u(" صورت حساب ")],-1))])]),o("div",qe,[o("span",Me,[_(o("input",{disabled:this.loading,"onUpdate:modelValue":t[13]||(t[13]=s=>e.canPrintCashdeskRecp=s),class:"form-check-input",type:"checkbox"},null,8,je),[[V,e.canPrintCashdeskRecp]]),t[31]||(t[31]=o("label",{class:"form-check-label"},[o("i",{class:"fa-solid fa-cloud me-1"}),u(" قبض صندوق ")],-1))])]),o("div",Ye,[o("span",Oe,[_(o("input",{disabled:this.loading,"onUpdate:modelValue":t[14]||(t[14]=s=>e.canPdf=s),class:"form-check-input",type:"checkbox"},null,8,We),[[V,e.canPdf]]),t[32]||(t[32]=o("label",{class:"form-check-label"},[o("i",{class:"fa-regular fa-file-pdf me-1"}),u(" خروجی PDF ")],-1))])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Qe=L(ie,[["render",xe]]);export{Qe as default};
