import{_ as T,a as f}from"./main-9b36f05f.js";import{a as n,o as u,c as _,w as a,b as r,d as c,A as v,t as d}from"./vendor-adef9cb4.js";const V={name:"PackageList",data(){return{packages:[],isLoading:!1,canShowForm:!1,showFreePackageDialog:!1,initialLoading:!0,headers:[{title:"تاریخ شروع",key:"dateSubmit",align:"center"},{title:"تاریخ انقضا",key:"dateExpire",align:"center"},{title:"مدت (ماه)",key:"month",align:"center"},{title:"مبلغ",key:"price",align:"center"},{title:"روزهای باقی‌مانده",key:"daysRemaining",align:"center"},{title:"وضعیت",key:"status",align:"center"},{title:"توضیحات",key:"des",align:"center"}]}},async mounted(){await this.checkFreeAccounting(),this.canShowForm&&this.fetchPackages()},methods:{async checkFreeAccounting(){try{this.initialLoading=!0;const t=await f.post("/api/settings/get/can-free-accounting"),{value:e}=t.data;e===1||e==="1"?this.showFreePackageDialog=!0:(e===0||e==="0")&&(this.canShowForm=!0)}catch(t){console.error("خطا در بررسی بسته رایگان:",t),this.$vuetify.notify({text:"خطا در بررسی دسترسی",type:"error"})}finally{this.initialLoading=!1}},redirectToDashboard(){this.showFreePackageDialog=!1,this.$router.push("/acc/dashboard")},async fetchPackages(){try{this.isLoading=!0;const e=(await f.post("/api/packagemanager/packages/orders/list")).data;e.result?this.packages=e.orders:this.$vuetify.notify({text:e.message||"خطا در دریافت اطلاعات",type:"error"})}catch(t){console.error("خطا در دریافت بسته‌ها:",t),this.$vuetify.notify({text:"خطا در ارتباط با سرور",type:"error"})}finally{this.isLoading=!1}},formatDate(t){const e=new Date(parseInt(t)*1e3);return new Intl.DateTimeFormat("fa-IR").format(e)},formatPrice(t){return new Intl.NumberFormat("fa-IR").format(t)+" تومان"},getStatusColor(t,e){const s=Math.floor(Date.now()/1e3);return t===100&&parseInt(e)>s?"green":t===100&&parseInt(e)<=s?"red":"grey"},getStatusText(t,e){const s=Math.floor(Date.now()/1e3);return t===100&&parseInt(e)>s?"فعال":t===100&&parseInt(e)<=s?"منقضی شده":"در انتظار پرداخت"},calculateDaysRemaining(t,e){const s=Math.floor(Date.now()/1e3);if(e!==100||parseInt(t)<=s)return 0;const g=parseInt(t)-s,i=Math.floor(g/(24*60*60));return i>=0?i:0},getDaysRemainingColor(t,e){const s=this.calculateDaysRemaining(t,e);return s===0?"grey":s<=10?"red":"green"}}};function E(t,e,s,g,i,l){const y=n("v-icon"),m=n("v-btn"),h=n("v-toolbar-title"),k=n("v-toolbar"),w=n("v-progress-circular"),x=n("v-row"),p=n("v-chip"),D=n("v-data-table"),b=n("v-card-title"),F=n("v-card-text"),I=n("v-spacer"),S=n("v-card-actions"),C=n("v-card"),L=n("v-dialog"),P=n("v-container"),R=n("v-app");return u(),_(R,null,{default:a(()=>[r(k,null,{default:a(()=>[r(m,{icon:"",onClick:e[0]||(e[0]=o=>t.$router.go(-1))},{default:a(()=>[r(y,null,{default:a(()=>e[2]||(e[2]=[c("mdi-arrow-right")])),_:1})]),_:1}),r(h,null,{default:a(()=>e[3]||(e[3]=[c("سفارشات بسته‌های حسابداری نامحدود")])),_:1})]),_:1}),r(P,null,{default:a(()=>[i.initialLoading?(u(),_(x,{key:0,justify:"center",class:"mt-5"},{default:a(()=>[r(w,{indeterminate:"",color:"primary",size:50})]),_:1})):v("",!0),i.canShowForm&&!i.initialLoading?(u(),_(D,{key:1,headers:i.headers,items:i.packages,"items-per-page":10,loading:i.isLoading,"loading-text":"در حال بارگذاری اطلاعات...",class:"elevation-1"},{"item.dateSubmit":a(({item:o})=>[c(d(l.formatDate(o.dateSubmit)),1)]),"item.dateExpire":a(({item:o})=>[c(d(l.formatDate(o.dateExpire)),1)]),"item.price":a(({item:o})=>[c(d(l.formatPrice(o.price)),1)]),"item.status":a(({item:o})=>[r(p,{color:l.getStatusColor(o.status,o.dateExpire)},{default:a(()=>[c(d(l.getStatusText(o.status,o.dateExpire)),1)]),_:2},1032,["color"])]),"item.daysRemaining":a(({item:o})=>[r(p,{color:l.getDaysRemainingColor(o.dateExpire,o.status)},{default:a(()=>[c(d(l.calculateDaysRemaining(o.dateExpire,o.status)),1)]),_:2},1032,["color"])]),_:1},8,["headers","items","loading"])):v("",!0),r(L,{modelValue:i.showFreePackageDialog,"onUpdate:modelValue":e[1]||(e[1]=o=>i.showFreePackageDialog=o),"max-width":"400"},{default:a(()=>[r(C,null,{default:a(()=>[r(b,{class:"text-h6 green lighten-2"},{default:a(()=>e[4]||(e[4]=[c("بسته رایگان فعال است")])),_:1}),r(F,{class:"mt-2"},{default:a(()=>e[5]||(e[5]=[c(" شما در حال حاضر از بسته حسابداری رایگان استفاده می‌کنید. به داشبورد منتقل خواهید شد. ")])),_:1}),r(S,null,{default:a(()=>[r(I),r(m,{color:"primary",text:"",onClick:l.redirectToDashboard},{default:a(()=>e[6]||(e[6]=[c("تأیید")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const A=T(V,[["render",E],["__scopeId","data-v-7a97c43d"]]);export{A as default};
