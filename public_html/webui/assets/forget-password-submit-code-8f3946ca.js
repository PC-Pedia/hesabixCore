import{a as B,_ as F}from"./main-9b36f05f.js";import{h as T,p as R,r as b,a as n,o as d,s as u,b as s,w as i,A as E,F as P,aa as U,c as j,d as $,t as c}from"./vendor-adef9cb4.js";/*! vue-countdown v2.1.3 | (c) 2018-present Chen Fengyuan | MIT */const h=1e3,m=60*h,f=60*m,w=24*f,C="abort",V="end",k="progress",I="start",N="visibilitychange";var G=T({name:"VueCountdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:t=>t>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"span"},time:{type:Number,default:0,validator:t=>t>=0},transform:{type:Function,default:t=>t}},emits:[C,V,k,I],data(){return{counting:!1,endTime:0,totalMilliseconds:0,requestId:0,autoPauseOnHide:!1}},computed:{days(){return Math.floor(this.totalMilliseconds/w)},hours(){return Math.floor(this.totalMilliseconds%w/f)},minutes(){return Math.floor(this.totalMilliseconds%f/m)},seconds(){return Math.floor(this.totalMilliseconds%m/h)},milliseconds(){return Math.floor(this.totalMilliseconds%h)},totalDays(){return this.days},totalHours(){return Math.floor(this.totalMilliseconds/f)},totalMinutes(){return Math.floor(this.totalMilliseconds/m)},totalSeconds(){return Math.floor(this.totalMilliseconds/h)}},watch:{$props:{deep:!0,immediate:!0,handler(){this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.autoStart&&this.start()}}},mounted(){document.addEventListener(N,this.handleVisibilityChange)},beforeUnmount(){document.removeEventListener(N,this.handleVisibilityChange),this.pause()},methods:{start(){this.counting||(this.counting=!0,this.autoStart||(this.totalMilliseconds=this.time,this.endTime=this.now()+this.time),this.emitEvents&&this.$emit(I),document.visibilityState==="visible"&&this.continue())},continue(){if(!this.counting)return;const t=Math.min(this.totalMilliseconds,this.interval);if(t>0){let e,l;const p=a=>{e||(e=a),l||(l=a);const g=a-e;g>=t||g+(a-l)/2>=t?this.progress():this.requestId=requestAnimationFrame(p),l=a};this.requestId=requestAnimationFrame(p)}else this.end()},pause(){cancelAnimationFrame(this.requestId),this.requestId=0},progress(){this.counting&&(this.update(),this.emitEvents&&this.totalMilliseconds>0&&this.$emit(k,{days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}),this.continue())},abort(){this.counting&&(this.pause(),this.counting=!1,this.emitEvents&&this.$emit(C))},end(){this.counting&&(this.pause(),this.totalMilliseconds=0,this.counting=!1,this.emitEvents&&this.$emit(V))},update(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},restart(){this.pause(),this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.counting=!1,this.start()},handleVisibilityChange(){switch(document.visibilityState){case"visible":this.requestId===0&&this.autoPauseOnHide&&(this.update(),this.continue()),this.autoPauseOnHide=!1;break;case"hidden":this.requestId>0&&(this.autoPauseOnHide=!0,this.pause());break}}},render(){return R(this.tag,this.$slots.default?[this.$slots.default(this.transform({days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}))]:void 0)}});const Y=T({name:"reset-password",components:{"vue-countdown":G},data(){return{dialog:!1,dialogSuccess:!1,loading:!1,counting:!0,disableSend:b(!0),code:"",response:{code:"",message:"",Success:!1,data:{id:""}},responseSuccess:{code:"",message:"",Success:!1,data:{id:""}}}},watch:{code(t,e){Object.keys(t).length==6?this.disableSend=b(!1):this.disableSend=b(!0)}},methods:{onCountdownEnd(){this.counting=!1},onResendCodeClick(){this.$router.push({name:"user_forget_password"})},async submit(){const{valid:t}=await this.$refs.form.validate();t&&(this.loading=!0,B.post("/api/user/reset/password/send-to-sms",{id:this.$route.params.id,code:this.code}).then(e=>{e.data.Success!=!0?(this.response=e.data,this.dialog=!0):(this.responseSuccess=e.data,this.dialogSuccess=!0),this.loading=!1}))}}}),z={key:1},J={key:0,class:"text-center"},K={key:1,class:"text-center"};function Q(t,e,l,p,a,g){const D=n("v-otp-input"),L=n("vue-countdown"),r=n("v-btn"),S=n("v-col"),M=n("v-row"),O=n("v-form"),H=n("v-card-text"),v=n("v-card"),q=n("v-container"),y=n("v-spacer"),_=n("v-dialog");return d(),u(P,null,[s(q,null,{default:i(()=>[s(M,{class:"d-flex justify-center"},{default:i(()=>[s(S,{md:"5"},{default:i(()=>[s(v,{loading:t.loading?"blue":null,title:t.$t("app.name"),subtitle:t.$t("user.forget_password")},{default:i(()=>[s(H,null,{default:i(()=>[s(O,{ref:"form",disabled:t.loading,"fast-fail":"",onSubmit:e[2]||(e[2]=U(o=>t.submit(),["prevent"]))},{default:i(()=>[s(D,{"focus-all":"",modelValue:t.code,"onUpdate:modelValue":e[0]||(e[0]=o=>t.code=o),disabled:t.loading,style:{direction:"ltr"}},null,8,["modelValue","disabled"]),s(M,null,{default:i(()=>[s(S,{class:"my-2 mx-4"},{default:i(()=>[s(r,{class:"float-end",color:"indigo",disabled:t.counting,onClick:e[1]||(e[1]=o=>t.onResendCodeClick())},{default:i(()=>[t.counting?(d(),j(L,{key:0,time:12e4,onEnd:t.onCountdownEnd},{default:i(({minutes:o,seconds:A})=>[$(c(t.$t("user.resendCodeLabel"))+" "+c(o+":"+A),1)]),_:1},8,["onEnd"])):(d(),u("span",z,c(t.$t("user.send_again")),1))]),_:1},8,["disabled"])]),_:1})]),_:1}),s(r,{disabled:t.disableSend,block:"",class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat","prepend-icon":"mdi-send",type:"submit"},{default:i(()=>[$(c(t.$t("user.send_new_password")),1)]),_:1},8,["disabled"])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","title","subtitle"])]),_:1})]),_:1})]),_:1}),t.dialog?(d(),u("div",J,[s(_,{modelValue:t.dialog,"onUpdate:modelValue":e[4]||(e[4]=o=>t.dialog=o),"max-width":"500",persistent:""},{default:i(()=>[s(v,{color:"dangerLight","prepend-icon":"mdi-close-octagon ",title:t.$t("dialog.error"),text:t.response.message},{actions:i(()=>[s(y),s(r,{color:"primary",text:t.$t("dialog.ok"),variant:"flat",onClick:e[3]||(e[3]=o=>{t.dialog=!1,t.loading=!1,t.code=""})},null,8,["text"])]),_:1},8,["title","text"])]),_:1},8,["modelValue"])])):E("",!0),t.dialogSuccess?(d(),u("div",K,[s(_,{modelValue:t.dialogSuccess,"onUpdate:modelValue":e[6]||(e[6]=o=>t.dialogSuccess=o),"max-width":"500",persistent:""},{default:i(()=>[s(v,{color:"successLight","prepend-icon":"mdi-check-bold ",title:t.$t("dialog.title"),text:t.responseSuccess.message},{actions:i(()=>[s(y),s(r,{color:"primary",text:t.$t("dialog.ok"),variant:"flat",onClick:e[5]||(e[5]=o=>{t.dialogSuccess=!1,t.loading=!1,t.$router.push({name:"user_login"})})},null,8,["text"])]),_:1},8,["title","text"])]),_:1},8,["modelValue"])])):E("",!0)],64)}const Z=F(Y,[["render",Q]]);export{Z as default};
