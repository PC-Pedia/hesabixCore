import{L as g,S as b,a as r,_ as x}from"./main-9b36f05f.js";import"./vue-persian-datetime-picker.common-0e5ba5b7.js";import{h as V,a as k,o as m,s as c,e,d as p,b as y,u as l,ab as a,au as w,F as D,C as U,w as f,t as F}from"./vendor-adef9cb4.js";const T=V({name:"rfsell",components:{Loading:g},data:()=>({loading:!1,doc:{},ticket:{type:"input",typeString:"حواله ورود",date:"",des:"",transfer:"",receiver:"",code:"",store:{},person:{},transferType:{},referral:""},transferTypes:[],year:{},items:[],headers:[{text:"کد",value:"commodity.code"},{text:"کالا",value:"commodity.name",sortable:!0},{text:"واحد",value:"commodity.unit",sortable:!0},{text:"مورد نیاز",value:"docCount"},{text:"از قبل",value:"countBefore"},{text:"باقی‌مانده",value:"remain"},{text:"تعداد",value:"commdityCount",sortable:!0},{text:"ارجاع",value:"referal",sortable:!0},{text:"توضیحات",value:"des"}],currencyConfig:{masked:!1,prefix:"",suffix:"",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0}}),methods:{submit(){this.loading=!0;let o=[],t=0;if(this.items.forEach((i,u)=>{i.ticketCount===""?o.push("تعداد کالا در ردیف "+(u+1)+"وارد نشده است."):i.ticketCount===0&&i.remain!=0&&t++}),t!=0&&o.push("تعداد تمام کالاها صفر است!"),o.length!=0){let i="<ul>";o.forEach(u=>{i+="<li>"+u+"</li>"}),i+="</ul>",b.fire({html:i,icon:"error",confirmButtonText:"قبول"}).then(u=>{this.loading=!1})}else r.post("/api/storeroom/ticket/insert",{doc:this.doc,ticket:this.ticket,items:this.items}).then(i=>{b.fire({text:"حواله انبار با موفقیت ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(u=>{this.$router.push("/acc/storeroom/tickets/list"),this.loading=!1})})},autofill(){this.items.forEach((o,t)=>{this.items[t].ticketCount=this.items[t].docCount,this.items[t].des="تعداد "+this.items[t].ticketCount+"مورد تحویل شد. "})},isNumber(o){const t=["0","1","2","3","4","5","6","7","8","9"],i=o.key;t.includes(i)||o.preventDefault()},loadData(){r.post("/api/storeroom/doc/get/info/"+this.$route.params.doc).then(o=>{this.doc=o.data,this.ticket.person=o.data.person,this.ticket.des="حواله ورود انبار برای فاکتور برگشت از فروش شماره # "+this.doc.code,this.items=o.data.commodities,this.items.forEach((t,i)=>{this.items[i].ticketCount=0,this.items[i].docCount=t.commdityCount,this.items[i].des="",this.items[i].type="input"})}),r.post("/api/storeroom/info/"+this.$route.params.storeID).then(o=>{this.ticket.store=o.data,this.ticket.store.des=this.ticket.store.name+" انباردار : "+this.ticket.store.manager}),r.post("/api/year/get").then(o=>{this.year=o.data,this.ticket.date=o.data.now}),r.post("/api/storeroom/transfertype/list").then(o=>{this.transferTypes=o.data,this.ticket.transferType=o.data[0]})}},mounted(){this.loadData()}}),A={class:"block block-content-full"},E={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},$={class:"block-title text-primary-dark"},B={class:"block-options"},M=["disabled"],Y={class:"block-content pt-1 pb-3"},N={class:"row"},S={class:"col-sm-12 col-md-4"},j={class:"col-sm-12 col-md-4"},P={class:"col-sm-12 col-md-4"},L={class:"row mt-1"},O={class:"col-sm-12 col-md-12"},R={class:"row mt-1"},z={class:"col-sm-12 col-md-3"},I={class:"col-sm-12 col-md-3"},K={class:"col-sm-12 col-md-3"},W=["value"],Z={class:"col-sm-12 col-md-3"},q={class:"row mt-2"},G={class:"col-sm-12 col-md-12"},H=["onBlur","max","onUpdate:modelValue"],J=["onUpdate:modelValue"],Q=["onUpdate:modelValue"];function X(o,t,i,u,_,tt){const C=k("date-picker"),v=k("EasyDataTable");return m(),c("div",A,[e("div",E,[e("h3",$,[e("button",{onClick:t[0]||(t[0]=s=>o.$router.back()),type:"button",class:"float-start d-none d-sm-none d-md-block btn btn-sm btn-link text-warning"},t[12]||(t[12]=[e("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),t[13]||(t[13]=e("i",{class:"mx-2 fa fa-file-import"},null,-1)),t[14]||(t[14]=p(" حواله ورود به انبار "))]),e("div",B,[e("button",{onClick:t[1]||(t[1]=s=>o.autofill()),class:"btn btn-sm btn-outline-primary"},t[15]||(t[15]=[e("i",{class:"fa fa-list-check me-2"},null,-1),p(" تکمیل خودکار ")])),e("button",{disabled:this.loading,onClick:t[2]||(t[2]=s=>o.submit()),type:"button",class:"mx-2 btn btn-sm btn-success"},t[16]||(t[16]=[e("i",{class:"fa fa-save me-2"},null,-1),p(" ثبت حواله ورود ")]),8,M)])]),e("div",Y,[e("div",N,[e("div",S,[t[17]||(t[17]=e("label",{class:"form-label"},"تاریخ",-1)),y(C,{class:"",modelValue:this.ticket.date,"onUpdate:modelValue":t[3]||(t[3]=s=>this.ticket.date=s),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:o.year.start,max:o.year.end},null,8,["modelValue","min","max"])]),e("div",j,[t[18]||(t[18]=e("label",{class:"form-label"},"انبار",-1)),l(e("input",{disabled:"disabled",readonly:"readonly","onUpdate:modelValue":t[4]||(t[4]=s=>this.ticket.store.des=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.store.des]])]),e("div",P,[t[19]||(t[19]=e("label",{class:"form-label"},"خریدار",-1)),l(e("input",{disabled:"disabled",readonly:"readonly","onUpdate:modelValue":t[5]||(t[5]=s=>this.ticket.person.des=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.person.des]])])]),e("div",L,[e("div",O,[t[20]||(t[20]=e("label",{class:"form-label"},"شرح",-1)),l(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>this.ticket.des=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.des]])])]),e("div",R,[e("div",z,[t[21]||(t[21]=e("label",{class:"form-label"},"حمل و نقل",-1)),l(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>this.ticket.transfer=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.transfer]])]),e("div",I,[t[22]||(t[22]=e("label",{class:"form-label"},"تحویل",-1)),l(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>this.ticket.receiver=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.receiver]])]),e("div",K,[t[23]||(t[23]=e("label",{class:"form-label"},"روش تحویل",-1)),l(e("select",{class:"form-select","onUpdate:modelValue":t[9]||(t[9]=s=>o.ticket.transferType=s)},[(m(!0),c(D,null,U(o.transferTypes,s=>(m(),c("option",{value:s},F(s.name),9,W))),256))],512),[[w,o.ticket.transferType]])]),e("div",Z,[t[24]||(t[24]=e("label",{class:"form-label"},"شماره پیگیری",-1)),l(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>this.ticket.referral=s),type:"text",class:"form-control"},null,512),[[a,this.ticket.referral]])])]),e("div",q,[e("div",G,[y(v,{"table-class-name":"customize-table","multi-sort":"","show-index":"",alternating:"",headers:o.headers,items:o.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:this.loading},{"item-commdityCount":f(({index:s,commdityCount:d,ticketCount:h})=>[l(e("input",{onBlur:n=>{this.items[s-1].ticketCount===""&&(this.items[s-1].ticketCount=0)},onKeypress:t[11]||(t[11]=n=>o.isNumber(n)),class:"form-control form-control-sm",type:"number",min:"0",max:this.items[s-1].remain,"onUpdate:modelValue":n=>this.items[s-1].ticketCount=n},null,40,H),[[a,this.items[s-1].ticketCount]])]),"item-des":f(({index:s,des:d})=>[l(e("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":h=>this.items[s-1].des=h},null,8,J),[[a,this.items[s-1].des]])]),"item-referal":f(({index:s})=>[l(e("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":d=>this.items[s-1].referral=d},null,8,Q),[[a,this.items[s-1].referral]])]),_:1},8,["headers","items","loading"])])])])])}const it=x(T,[["render",X]]);export{it as default};
