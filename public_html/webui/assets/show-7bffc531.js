import{_ as j,a as v,S as f,c as A}from"./main-9b36f05f.js";import{a as i,o as m,s as w,b as e,w as l,F as x,_ as L,aa as E,d as c,t as r,c as y,A as k,C as O,e as q}from"./vendor-adef9cb4.js";const M={name:"show",data(){return{item:{state:"",body:"",dateSubmit:"",fileName:null},replays:[],replay:"",attachedFiles:[],loading:!1,fileRules:[t=>!t||t.length===0?!0:t.every(a=>["image/png","image/jpeg","application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-rar-compressed"].includes(a.type)||this.$t("validator.invalid_file_type")),t=>!t||t.length===0?!0:t.every(a=>a.size<5*1024*1024)||this.$t("validator.file_size_limit")]}},methods:{loadData(){this.loading=!0,v.post("/api/support/view/"+this.$route.params.id).then(t=>{this.loading=!1,this.item=t.data.item,this.replays=t.data.replays}).catch(t=>{this.loading=!1,f.fire({text:this.$t("pages.support.load_error")+t.message,icon:"error",confirmButtonText:this.$t("dialog.confirm")})})},getAttachSrc(t){return A()+"/api/support/download/file/"+t},downloadFile(t,a){this.loading=!0,v.get(this.getAttachSrc(t),{responseType:"blob"}).then(s=>{this.loading=!1;const d=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=d,o.setAttribute("download",a),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(d)}).catch(s=>{var d,o;this.loading=!1,f.fire({text:this.$t("pages.support.download_error")+(((o=(d=s.response)==null?void 0:d.data)==null?void 0:o.message)||s.message),icon:"error",confirmButtonText:this.$t("dialog.confirm")})})},async submit(){const{valid:t}=await this.$refs.form.validate();if(t){this.loading=!0;const a=new FormData;a.append("body",this.replay),this.attachedFiles&&this.attachedFiles.length>0&&this.attachedFiles.forEach((s,d)=>{a.append(`files[${d}]`,s)}),v.post("/api/support/mod/"+this.item.id,a,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{this.loading=!1,s.data.error===0&&f.fire({text:this.$t("pages.support.reply_submitted"),icon:"success",confirmButtonText:this.$t("dialog.confirm")}).then(()=>{this.loadData(),this.replay="",this.attachedFiles=[]})}).catch(s=>{this.loading=!1,f.fire({text:this.$t("pages.support.submit_error")+s.message,icon:"error",confirmButtonText:this.$t("dialog.confirm")})})}}},mounted(){this.loadData()}},P={class:"text-primary"};function G(t,a,s,d,o,h){const b=i("v-spacer"),_=i("v-btn"),F=i("v-tooltip"),C=i("v-toolbar"),V=i("v-card-text"),B=i("v-card-actions"),g=i("v-card"),p=i("v-col"),u=i("v-row"),N=i("v-chip"),S=i("v-alert"),T=i("v-timeline-item"),z=i("v-timeline"),U=i("v-textarea"),$=i("v-file-input"),D=i("v-form"),R=i("v-container");return m(),w(x,null,[e(C,{color:"toolbar",title:t.$t("pages.support.view_ticket")},{default:l(()=>[e(b),e(F,{text:t.$t("pages.support.new_ticket"),location:"bottom"},{activator:l(({props:n})=>[e(_,L(n,{icon:"mdi-chat-plus",color:"primary",to:"/profile/support-new"}),null,16)]),_:1},8,["text"])]),_:1},8,["title"]),e(R,{class:"pa-0 ma-0"},{default:l(()=>[e(u,null,{default:l(()=>[e(p,{class:""},{default:l(()=>[e(D,{"fast-fail":"",ref:"form",onSubmit:a[4]||(a[4]=E(()=>{},["prevent"]))},{default:l(()=>[e(g,{class:"pa-3",loading:o.loading?"red":null,disabled:o.loading,flat:""},{default:l(()=>[e(u,null,{default:l(()=>[e(p,{cols:"12",md:"12"},{default:l(()=>[e(g,{color:"primary",class:"mx-auto","prepend-icon":"mdi-account",subtitle:o.item.dateSubmit+" "+o.item.state,title:o.item.title},{default:l(()=>[e(V,null,{default:l(()=>[c(r(o.item.body),1)]),_:1}),e(B,null,{default:l(()=>[c(r(t.$t("pages.support.ticket_id"))+" "+r(o.item.id)+" ",1),e(b),o.item.fileName?(m(),y(_,{key:0,"prepend-icon":"mdi-paperclip",size:"small",variant:"outlined",onClick:a[0]||(a[0]=n=>h.downloadFile(o.item.id,o.item.fileName))},{default:l(()=>[c(r(t.$t("dialog.attach_download")),1)]),_:1})):k("",!0)]),_:1})]),_:1},8,["subtitle","title"])]),_:1})]),_:1}),e(z,{side:"end",class:"align-end"},{default:l(()=>[(m(!0),w(x,null,O(o.replays,n=>(m(),y(T,{key:n.id,"dot-color":n.owner?"primary":"warning",size:"small"},{default:l(()=>[e(S,{color:"",icon:"mdi-account",value:!0},{default:l(()=>[q("span",P,r(n.submitter.name)+" :",1),c(" "+r(n.body)+" ",1),e(u,null,{default:l(()=>[e(p,null,{default:l(()=>[e(N,{color:"primary","prepend-icon":"mdi-clock-outline",variant:"tonal"},{default:l(()=>[c(r(n.dateSubmit),1)]),_:2},1024)]),_:2},1024),e(p,null,{default:l(()=>[n.fileName?(m(),y(_,{key:0,"prepend-icon":"mdi-paperclip",size:"small",variant:"outlined",onClick:H=>h.downloadFile(n.id,n.fileName)},{default:l(()=>[c(r(t.$t("dialog.attach_download")),1)]),_:2},1032,["onClick"])):k("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1}),e(u,null,{default:l(()=>[e(p,{class:""},{default:l(()=>[e(g,{class:"pa-3",loading:o.loading?"red":null,disabled:o.loading,flat:""},{default:l(()=>[e(u,null,{default:l(()=>[e(p,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e(U,{"auto-grow":"",label:t.$t("pages.support.replay"),modelValue:o.replay,"onUpdate:modelValue":a[1]||(a[1]=n=>o.replay=n),type:"text","prepend-inner-icon":"mdi-text",rules:[()=>o.replay.length>0||t.$t("validator.required")]},null,8,["label","modelValue","rules"])]),_:1}),e(p,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e($,{modelValue:o.attachedFiles,"onUpdate:modelValue":a[2]||(a[2]=n=>o.attachedFiles=n),label:t.$t("dialog.attach_file"),"prepend-icon":"mdi-paperclip",accept:".png, .jpg, .jpeg, .pdf, .xls, .xlsx, .zip, .rar",rules:o.fileRules,hint:t.$t("dialog.allowed_file_types_hint"),"persistent-hint":""},null,8,["modelValue","label","rules","hint"])]),_:1})]),_:1}),e(_,{onClick:a[3]||(a[3]=n=>h.submit()),type:"submit",color:"primary",class:"mt-3","prepend-icon":"mdi-content-save",loading:o.loading},{default:l(()=>[c(r(t.$t("dialog.save")),1)]),_:1},8,["loading"])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["loading","disabled"])]),_:1},512)]),_:1})]),_:1})]),_:1})],64)}const K=j(M,[["render",G]]);export{K as default};
