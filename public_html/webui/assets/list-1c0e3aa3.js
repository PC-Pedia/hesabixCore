import{_ as R,S as c,a as v}from"./main-9b36f05f.js";import{h as j,a as n,o as d,s as p,b as l,w as a,F as S,r as q,_ as b,d as V,t as r,C as B,c as U,e as k,u as G,ao as H,A as w}from"./vendor-adef9cb4.js";const J=j({name:"list",data(){let e=this;return{paperSizes:[{title:e.$t("dialog.a4p"),value:"A4"},{title:e.$t("dialog.a4l"),value:"A4-L"},{title:e.$t("dialog.a5p"),value:"A5"},{title:e.$t("dialog.a5l"),value:"A5-L"}],modal:!1,printOptions:{pays:!0,note:!0,bidInfo:!0,taxInfo:!0,discountInfo:!0,selectedPrintCode:0,paper:"A4-L"},sumSelected:0,sumTotal:0,itemsSelected:[],searchValue:"",types:[],loading:q(!0),items:[],orgItems:[],headers:[{text:"عملیات",value:"operation"},{text:"فاکتور",value:"code",sortable:!0},{text:"تاریخ",value:"date",sortable:!0},{text:"خریدار",value:"person",sortable:!0},{text:"تخفیف",value:"discountAll",sortable:!0},{text:"حمل و نقل",value:"transferCost",sortable:!0},{text:"مبلغ",value:"amount",sortable:!0},{text:"سود فاکتور",value:"profit",sortable:!0},{text:"پرداختی",value:"relatedDocsCount",sortable:!0},{text:"برچسب",value:"label",width:100},{text:"شرح",value:"des",sortable:!0}]}},methods:{changeLabel(e){this.itemsSelected.length==0?c.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):(this.loading=!0,v.post("/api/presell/label/change",{items:this.itemsSelected,label:e}).then(o=>{this.loading==!1,o.data.code==0?(c.fire({text:"فاکتور‌ها با موفقیت ویرایش شد.",icon:"success",confirmButtonText:"قبول"}),this.itemsSelected=[]):o.data.result==2&&c.fire({text:o.data.message,icon:"warning",confirmButtonText:"قبول"}),this.loadData()}))},filterTable(){this.loading=!0;let e=[],o=!0,s=[];this.types.forEach(i=>{i.checked==!0&&(o=!1,s.push(i))}),o?this.items=this.orgItems:(this.orgItems.forEach(i=>{s.forEach($=>{if(i.label&&$.code==i.label.code){let C=!1;e.forEach(m=>{i.label.code==m.code&&(C=!0)}),C==!1&&e.push(i)}})}),this.items=e),this.loading=!1},loadData(){v.post("/api/printers/options/info").then(e=>{this.printOptions=e.data.sell}),v.post("/api/invoice/types",{type:"sell"}).then(e=>{this.types=e.data}),v.post("/api/presell/docs/search").then(e=>{this.items=e.data,this.orgItems=e.data,this.items.forEach(o=>{this.sumTotal+=parseInt(o.amount)}),this.loading=!1})},deleteItems(){this.itemsSelected.length==0?c.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):c.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(e=>{e.isConfirmed&&(this.loading=!0,v.post("/api/accounting/remove/group",{items:this.itemsSelected}).then(o=>{this.loading=!1,o.data.result==1?(this.loadData(),c.fire({text:"فاکتور ها با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})):o.data.result==2&&c.fire({text:o.data.message,icon:"warning",confirmButtonText:"قبول"})}))})},printInvoice(e=!0,o=!0){this.loading=!0,v.post("/api/presell/print/invoice",{code:this.printOptions.selectedPrintCode,pdf:e,printers:o,printOptions:this.printOptions}).then(s=>{this.loading=!1,window.open(this.$API_URL+"/front/print/"+s.data.id,"_blank","noreferrer")})},deleteItem(e){c.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(o=>{o.isConfirmed&&v.post("/api/accounting/remove",{code:e}).then(s=>{if(s.data.result==1){let i=0;for(let $=0;$<this.items.length;$++)i++,this.items[$].code==e&&this.items.splice(i-1,1);c.fire({text:"فاکتور فروش با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})}else s.data.result==2&&c.fire({text:s.data.message,icon:"warning",confirmButtonText:"قبول"})})})}},beforeMount(){this.loadData()},watch:{itemsSelected:{handler:function(e,o){this.sumSelected=0,this.itemsSelected.forEach(s=>{typeof s.amount.valueOf()=="string"?this.sumSelected+=parseInt(s.amount.replaceAll(",","")):this.sumSelected+=s.amount})},deep:!0},searchValue:{handler:function(e,o){if(this.searchValue=="")this.items=this.orgItems;else{let s=[];this.orgItems.forEach(i=>{(i.person.nikename.includes(this.searchValue)||i.date.includes(this.searchValue)||i.amount.toString().includes(this.searchValue)||i.des.includes(this.searchValue)||i.code.includes(this.searchValue)||i.label&&i.label.label.includes(this.searchValue))&&s.push(i)}),this.items=s}},deep:!1}}}),K={class:"form-check form-check-inline mx-1"},Q=["onUpdate:modelValue"],W={class:"form-check-label"},X={key:0},Y={key:0,class:"text-success"},Z={key:1,class:"text-danger"},ee={key:2,class:"text-info"},te={key:0,class:"text-success"},le={class:"text-dark"},oe={key:0,class:"text-dark"},ae={key:1,class:"text-danger"},ie={class:"text-dark"},se={class:"text-dark"};function ne(e,o,s,i,$,C){const m=n("v-btn"),y=n("v-tooltip"),A=n("v-spacer"),u=n("v-icon"),O=n("v-list-subheader"),h=n("v-list-item"),I=n("v-list"),x=n("v-menu"),E=n("v-toolbar"),D=n("v-text-field"),T=n("router-link"),N=n("EasyDataTable"),z=n("v-col"),L=n("v-row"),P=n("v-select"),_=n("v-switch"),M=n("v-card"),F=n("v-dialog");return d(),p(S,null,[l(E,{color:"toolbar",title:e.$t("drawer.presells")},{prepend:a(()=>[l(y,{text:e.$t("dialog.back"),location:"bottom"},{activator:a(({props:t})=>[l(m,b(t,{onClick:o[0]||(o[0]=f=>e.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1},8,["text"])]),default:a(()=>[l(A),l(y,{text:e.$t("dialog.add_new"),location:"bottom"},{activator:a(({props:t})=>[l(m,b(t,{icon:"mdi-plus",color:"primary",to:"/acc/presell/mod/"}),null,16)]),_:1},8,["text"]),l(y,{text:e.$t("dialog.delete"),location:"bottom"},{activator:a(({props:t})=>[l(m,b(t,{icon:"mdi-delete",color:"danger",onClick:o[1]||(o[1]=f=>e.deleteItems())}),null,16)]),_:1},8,["text"]),l(x,null,{activator:a(({props:t})=>[l(m,b(t,{icon:"",color:"green"}),{default:a(()=>[l(y,{activator:"parent",text:e.$t("dialog.change_labels"),location:"bottom"},null,8,["text"]),l(u,{icon:"mdi-dots-horizontal-circle"})]),_:2},1040)]),default:a(()=>[l(I,null,{default:a(()=>[l(O,{color:"primary"},{default:a(()=>[V(r(e.$t("dialog.change_labels")),1)]),_:1}),(d(!0),p(S,null,B(e.types,t=>(d(),U(h,{class:"text-dark",title:e.$t("dialog.change_to")+" "+t.label,onClick:f=>e.changeLabel(t)},{prepend:a(()=>[l(u,{color:"green-darken-4",icon:"mdi-label"})]),_:2},1032,["title","onClick"]))),256)),l(h,{class:"text-dark",title:e.$t("dialog.delete_labels"),onClick:o[2]||(o[2]=t=>e.changeLabel("clear"))},{prepend:a(()=>[l(u,{color:"red",icon:"mdi-undo"})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1},8,["title"]),l(L,{class:"pa-1"},{default:a(()=>[l(z,null,{default:a(()=>[l(D,{loading:e.loading,color:"green",class:"mb-0 pt-0 rounded-0","hide-details":"auto",density:"compact",placeholder:e.$t("dialog.search_txt"),modelValue:e.searchValue,"onUpdate:modelValue":o[4]||(o[4]=t=>e.searchValue=t),type:"text",clearable:""},{"prepend-inner":a(()=>[l(y,{location:"bottom",text:e.$t("dialog.search")},{activator:a(({props:t})=>[l(u,b(t,{color:"danger",icon:"mdi-magnify"}),null,16)]),_:1},8,["text"])]),"append-inner":a(()=>[l(x,{"close-on-content-click":!1},{activator:a(({props:t})=>[l(u,b({size:"sm"},t,{icon:"",color:"primary"}),{default:a(()=>[l(y,{activator:"parent",variant:"plain",text:e.$t("dialog.filters"),location:"bottom"},null,8,["text"]),l(u,{icon:"mdi-filter"})]),_:2},1040)]),default:a(()=>[l(I,null,{default:a(()=>[l(O,{color:"primary"},{default:a(()=>[l(u,{icon:"mdi-filter"}),V(" "+r(e.$t("dialog.filters")),1)]),_:1}),(d(!0),p(S,null,B(e.types,(t,f)=>(d(),U(h,{class:"text-dark"},{title:a(()=>[k("div",K,[G(k("input",{onChange:o[3]||(o[3]=g=>e.filterTable()),"onUpdate:modelValue":g=>e.types[f].checked=g,checked:"",class:"form-check-input",type:"checkbox"},null,40,Q),[[H,e.types[f].checked]]),k("label",W,r(t.label),1)])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["loading","placeholder","modelValue"]),l(N,{"table-class-name":"customize-table","items-selected":e.itemsSelected,"onUpdate:itemsSelected":o[5]||(o[5]=t=>e.itemsSelected=t),"multi-sort":"","show-index":"",alternating:"","search-value":e.searchValue,headers:e.headers,items:e.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:e.loading},{"item-operation":a(({code:t,type:f})=>[l(x,null,{activator:a(({props:g})=>[l(m,b({variant:"text",size:"small",color:"error",icon:"mdi-menu"},g),null,16)]),default:a(()=>[l(I,null,{default:a(()=>[l(h,{class:"text-dark",title:e.$t("dialog.view"),to:"/acc/presell/view/"+t},{prepend:a(()=>[l(u,{color:"green-darken-4",icon:"mdi-eye"})]),_:2},1032,["title","to"]),l(h,{class:"text-dark",title:e.$t("dialog.export_pdf"),onClick:g=>{e.printOptions.selectedPrintCode=t,e.modal=!0}},{prepend:a(()=>[l(u,{icon:"mdi-file-pdf-box"})]),_:2},1032,["title","onClick"]),l(h,{class:"text-dark",title:e.$t("dialog.edit"),onClick:g=>e.canEditItem(t)},{prepend:a(()=>[l(u,{icon:"mdi-file-edit"})]),_:2},1032,["title","onClick"]),l(h,{class:"text-dark",title:e.$t("dialog.delete"),onClick:g=>e.deleteItem(t)},{prepend:a(()=>[l(u,{color:"deep-orange-accent-4",icon:"mdi-trash-can"})]),_:2},1032,["title","onClick"])]),_:2},1024)]),_:2},1024)]),"item-label":a(({label:t})=>[t?(d(),p("span",X,[t.code=="payed"?(d(),p("span",Y,r(t.label),1)):w("",!0),t.code=="returned"?(d(),p("span",Z,r(t.label),1)):w("",!0),t.code=="accepted"?(d(),p("span",ee,r(t.label),1)):w("",!0)])):w("",!0)]),"item-des":a(({des:t})=>[V(r(t.replace("فاکتور فروش:","")),1)]),"item-relatedDocsCount":a(({relatedDocsCount:t,relatedDocsPays:f})=>[t!="0"?(d(),p("span",te,[o[15]||(o[15]=k("i",{class:"fa fa-money"},null,-1)),V(" "+r(e.$filters.formatNumber(f)),1)])):w("",!0)]),"item-amount":a(({amount:t})=>[k("span",le,r(e.$filters.formatNumber(t)),1)]),"item-profit":a(({profit:t})=>[t>=0?(d(),p("span",oe,r(e.$filters.formatNumber(t)),1)):(d(),p("span",ae,r(e.$filters.formatNumber(Math.abs(t)))+" (زیان) ",1))]),"item-transferCost":a(({transferCost:t})=>[k("span",ie,r(e.$filters.formatNumber(t)),1)]),"item-discountAll":a(({discountAll:t})=>[k("span",se,r(e.$filters.formatNumber(t)),1)]),"item-person":a(({person:t})=>[l(T,{to:"/acc/persons/card/view/"+t.code},{default:a(()=>[V(r(t.nikename),1)]),_:2},1032,["to"])]),"item-code":a(({code:t})=>[l(T,{to:"/acc/presell/view/"+t},{default:a(()=>[V(r(t),1)]),_:2},1032,["to"])]),_:1},8,["table-class-name","items-selected","search-value","headers","items","loading"])]),_:1})]),_:1}),l(F,{modelValue:e.modal,"onUpdate:modelValue":o[14]||(o[14]=t=>e.modal=t),width:"auto"},{default:a(()=>[l(M,{subtitle:e.$t("dialog.print_info_des"),"prepend-icon":"mdi-file-pdf-box",title:e.$t("dialog.export_pdf")},{text:a(()=>[l(P,{class:"mb-2",modelValue:e.printOptions.paper,"onUpdate:modelValue":o[6]||(o[6]=t=>e.printOptions.paper=t),items:e.paperSizes,label:e.$t("dialog.paper_size")},null,8,["modelValue","items","label"]),l(_,{inset:"",modelValue:e.printOptions.bidInfo,"onUpdate:modelValue":o[7]||(o[7]=t=>e.printOptions.bidInfo=t),color:"primary",label:e.$t("dialog.bid_info_label"),"hide-details":""},null,8,["modelValue","label"]),l(_,{inset:"",modelValue:e.printOptions.pays,"onUpdate:modelValue":o[8]||(o[8]=t=>e.printOptions.pays=t),color:"primary",label:e.$t("dialog.invoice_pays"),"hide-details":""},null,8,["modelValue","label"]),l(_,{inset:"",modelValue:e.printOptions.note,"onUpdate:modelValue":o[9]||(o[9]=t=>e.printOptions.note=t),color:"primary",label:e.$t("dialog.invoice_footer_note"),"hide-details":""},null,8,["modelValue","label"]),l(_,{inset:"",modelValue:e.printOptions.taxInfo,"onUpdate:modelValue":o[10]||(o[10]=t=>e.printOptions.taxInfo=t),color:"primary",label:e.$t("dialog.tax_dexpo"),"hide-details":""},null,8,["modelValue","label"]),l(_,{inset:"",modelValue:e.printOptions.discountInfo,"onUpdate:modelValue":o[11]||(o[11]=t=>e.printOptions.discountInfo=t),color:"primary",label:e.$t("dialog.discount_dexpo"),"hide-details":""},null,8,["modelValue","label"])]),actions:a(()=>[l(m,{variant:"tonal",class:"","prepend-icon":"mdi-printer",color:"primary",text:e.$t("dialog.print"),onClick:o[12]||(o[12]=t=>{e.modal=!1,e.printInvoice()})},null,8,["text"]),l(m,{variant:"tonal",class:"","prepend-icon":"mdi-undo",color:"secondary",text:e.$t("dialog.cancel"),onClick:o[13]||(o[13]=t=>e.modal=!1)},null,8,["text"])]),_:1},8,["subtitle","title"])]),_:1},8,["modelValue"])],64)}const ue=R(J,[["render",ne]]);export{ue as default};
