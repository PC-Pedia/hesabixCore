import{at as fe,r as v,O as M,n as W,j as ge,a as i,o as u,s as d,b as l,w as o,F as E,_,d as m,t as k,C as O,c as x,A as y}from"./vendor-adef9cb4.js";import{a as h,S as w,c as q}from"./main-9b36f05f.js";import{I as _e}from"./person-import-excel-aa69847d.js";const ke={key:0},xe={key:1},ye={key:0},he={key:0,class:"text-success"},we={key:1,class:"text-danger"},$e={key:2,class:"text-info"},Ce={key:0},Ve={key:0},Ue={key:0},Ae={__name:"list",setup(Be){fe();const B=v(!0),T=v(""),C=v([]),R=v(0),P=v(!1),b=v({page:1,rowsPerPage:10,sortBy:[]}),D=v([]),j=v([{label:"بدهکاران",value:"debtors",checked:!1},{label:"بستانکاران",value:"creditors",checked:!1}]),G=v({submited:!1}),f=v([]),V=v(!1),S=v([{title:"",value:"checkbox",sortable:!1,align:"center"},{title:"عملیات",value:"operation",sortable:!1,align:"center"},{title:"کد",value:"code",sortable:!0,visible:!0,align:"center"},{title:"نام مستعار",value:"nikename",sortable:!0,align:"center"},{title:"نام و نام خانوادگی",value:"name",sortable:!0,visible:!0,align:"center"},{title:"تراز",value:"balance",sortable:!0,visible:!0,align:"center"},{title:"وضعیت",value:"status",sortable:!0,visible:!0,align:"center"},{title:"بستانکار",value:"bs",sortable:!0,visible:!0,align:"center"},{title:"بدهکار",value:"bd",sortable:!0,visible:!0,align:"center"},{title:"دسترسی سریع",value:"speedAccess",sortable:!0,visible:!0,align:"center"},{title:"تاریخ تولد/ثبت",value:"birthday",sortable:!0,visible:!0,align:"center"},{title:"شرکت",value:"company",sortable:!0,visible:!0,align:"center"},{title:"شناسه ملی",value:"shenasemeli",sortable:!0,visible:!0,align:"center"},{title:"کد اقتصادی",value:"codeeghtesadi",sortable:!0,visible:!0,align:"center"},{title:"شماره ثبت",value:"sabt",sortable:!0,visible:!0,align:"center"},{title:"کشور",value:"keshvar",sortable:!0,visible:!0,align:"center"},{title:"استان",value:"ostan",sortable:!0,visible:!0,align:"center"},{title:"شهر",value:"shahr",sortable:!0,visible:!0,align:"center"},{title:"کد پستی",value:"postalcode",sortable:!0,visible:!0,align:"center"},{title:"تلفن",value:"tel",sortable:!0,visible:!0,align:"center"},{title:"موبایل",value:"mobile",sortable:!0,visible:!0,align:"center"},{title:"موبایل دوم",value:"mobile2",sortable:!0,visible:!0,align:"center"},{title:"ایمیل",value:"email",sortable:!0,visible:!0,align:"center"},{title:"وب سایت",value:"website",sortable:!0,visible:!0,align:"center"},{title:"فکس",value:"fax",sortable:!0,visible:!0,align:"center"}]),F=a=>a?Number(a).toLocaleString("fa-IR"):"0",K=()=>{const a=localStorage.getItem("personTableColumns");if(a){const t=JSON.parse(a);S.value.forEach(n=>{n.value!=="checkbox"&&n.value!=="operation"&&n.value!=="nikename"&&(n.visible=t[n.value]!==!1)})}},Q=()=>{const a={};S.value.forEach(t=>{a[t.value]=t.visible}),localStorage.setItem("personTableColumns",JSON.stringify(a))},X=async()=>{try{const a=await h.post("/api/person/types/get");D.value=a.data.map(t=>({...t,checked:!1}))}catch(a){console.error("Error fetching person types:",a)}};let H;const $=async()=>{clearTimeout(H),H=setTimeout(async()=>{B.value=!0;try{const a=D.value.filter(s=>s.checked).map(s=>s.code),t=j.value.filter(s=>s.checked).map(s=>s.value),n=b.value.sortBy.map(s=>({key:s.key,order:s.order==="asc"?"ASC":"DESC"})),r=await h.post("/api/person/list",{page:b.value.page,itemsPerPage:b.value.rowsPerPage,search:T.value,types:a.length>0?a:null,transactionFilters:t.length>0?t:null,sortBy:n.length>0?n:null});C.value=r.data.items||[],R.value=r.data.total||0,te()}catch(a){console.error("Error fetching data:",a),C.value=[],R.value=0}finally{B.value=!1}},1e3)},Y=a=>{w.fire({text:"آیا برای حذف شخص مطمئن هستید؟",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"}).then(t=>{t.isConfirmed&&h.post(`/api/person/delete/${a}`).then(n=>{n.data.result===1?($(),w.fire({text:"شخص با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})):n.data.result===2&&w.fire({text:"شخص به دلیل داشتن تراکنش مرتبط قابل حذف نیست.",icon:"warning",confirmButtonText:"قبول"})})})},Z=()=>{V.value?f.value=[...C.value]:f.value=[]},ee=()=>{V.value=f.value.length===C.value.length},te=()=>{f.value=[],V.value=!1},z=(a=!0)=>{if(a)h({method:"get",url:"/api/person/list/excel",responseType:"arraybuffer"}).then(t=>{const n=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=n,r.setAttribute("download","persons-list.xlsx"),document.body.appendChild(r),r.click(),r.remove()});else{if(f.value.length===0){w.fire({text:"هیچ آیتمی انتخاب نشده است.",icon:"info",confirmButtonText:"قبول"});return}const t=f.value.map(n=>({id:n.id,code:n.code}));h({method:"post",url:"/api/person/list/excel",data:{items:t},responseType:"arraybuffer"}).then(n=>{const r=window.URL.createObjectURL(new Blob([n.data])),s=document.createElement("a");s.href=r,s.setAttribute("download","persons-list.xlsx"),document.body.appendChild(s),s.click(),s.remove()}).catch(n=>{console.error("خطا در خروجی اکسل:",n),w.fire({text:"خطا در خروجی اکسل.",icon:"error",confirmButtonText:"قبول"})})}},J=(a=!0)=>{if(a)h.post("/api/person/list/print",{}).then(t=>{const n=t.data.id,r=q();window.open(`${r}/front/print/${n}`,"_blank","noreferrer")});else{if(f.value.length===0){w.fire({text:"هیچ آیتمی انتخاب نشده است.",icon:"info",confirmButtonText:"قبول"});return}const t=f.value.map(n=>({id:n.id,code:n.code}));h.post("/api/person/list/print",{items:t}).then(n=>{const r=n.data.id,s=q();window.open(`${s}/front/print/${r}`,"_blank","noreferrer")}).catch(n=>{console.error("خطا در خروجی PDF:",n),w.fire({text:"خطا در خروجی PDF.",icon:"error",confirmButtonText:"قبول"})})}},le=M(()=>S.value.filter(a=>a.value==="checkbox"||a.value==="operation"||a.value==="nikename"||a.visible)),oe=M(()=>S.value.filter(a=>a.value!=="checkbox"&&a.value!=="operation"&&a.value!=="nikename"));return W(T,()=>$()),W(b,()=>$(),{deep:!0}),ge(()=>{K(),X(),$()}),(a,t)=>{const n=i("v-btn"),r=i("v-tooltip"),s=i("v-spacer"),c=i("v-icon"),A=i("v-list-subheader"),g=i("v-list-item"),I=i("v-list"),L=i("v-menu"),ae=i("v-toolbar"),U=i("v-checkbox"),ne=i("v-divider"),re=i("v-text-field"),se=i("router-link"),ie=i("v-data-table-server"),ue=i("v-card-title"),ce=i("v-col"),de=i("v-row"),pe=i("v-card-text"),ve=i("v-card-actions"),me=i("v-card"),be=i("v-dialog");return u(),d(E,null,[l(ae,{color:"toolbar",title:a.$t("drawer.persons")},{prepend:o(()=>[l(r,{text:a.$t("dialog.back"),location:"bottom"},{activator:o(({props:e})=>[l(n,_(e,{onClick:t[0]||(t[0]=p=>a.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1},8,["text"])]),default:o(()=>[l(s),l(r,{text:a.$t("dialog.add_new"),location:"bottom"},{activator:o(({props:e})=>[l(n,_(e,{icon:"mdi-account-plus",color:"primary",to:"/acc/persons/mod/"}),null,16)]),_:1},8,["text"]),l(_e,{"windows-state":G.value},null,8,["windows-state"]),l(L,null,{activator:o(({props:e})=>[l(n,_(e,{icon:"",color:"red"}),{default:o(()=>[l(c,null,{default:o(()=>t[14]||(t[14]=[m("mdi-file-pdf-box")])),_:1}),l(r,{activator:"parent",text:a.$t("dialog.export_pdf"),location:"bottom"},null,8,["text"])]),_:2},1040)]),default:o(()=>[l(I,null,{default:o(()=>[l(A,{color:"primary"},{default:o(()=>[m(k(a.$t("dialog.export_pdf")),1)]),_:1}),l(g,{class:"text-dark",title:a.$t("dialog.selected"),onClick:t[1]||(t[1]=e=>J(!1))},{prepend:o(()=>[l(c,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["title"]),l(g,{class:"text-dark",title:a.$t("dialog.selected_all"),onClick:t[2]||(t[2]=e=>J(!0))},{prepend:o(()=>[l(c,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1}),l(L,null,{activator:o(({props:e})=>[l(n,_(e,{icon:"",color:"green"}),{default:o(()=>[l(c,null,{default:o(()=>t[15]||(t[15]=[m("mdi-file-excel-box")])),_:1}),l(r,{activator:"parent",text:a.$t("dialog.export_excel"),location:"bottom"},null,8,["text"])]),_:2},1040)]),default:o(()=>[l(I,null,{default:o(()=>[l(A,{color:"primary"},{default:o(()=>[m(k(a.$t("dialog.export_excel")),1)]),_:1}),l(g,{class:"text-dark",title:a.$t("dialog.selected"),onClick:t[3]||(t[3]=e=>z(!1))},{prepend:o(()=>[l(c,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["title"]),l(g,{class:"text-dark",title:a.$t("dialog.selected_all"),onClick:t[4]||(t[4]=e=>z(!0))},{prepend:o(()=>[l(c,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1}),l(r,{text:a.$t("dialog.column_settings"),location:"bottom"},{activator:o(({props:e})=>[l(n,_(e,{icon:"mdi-table-cog",color:"primary",onClick:t[5]||(t[5]=p=>P.value=!0)}),null,16)]),_:1},8,["text"])]),_:1},8,["title"]),l(re,{loading:B.value,color:"green",class:"mb-0 pt-0 rounded-0","hide-details":"auto",density:"compact",placeholder:a.$t("dialog.search_txt"),modelValue:T.value,"onUpdate:modelValue":t[6]||(t[6]=e=>T.value=e),type:"text",clearable:""},{"prepend-inner":o(()=>[l(r,{location:"bottom",text:a.$t("dialog.search")},{activator:o(({props:e})=>[l(c,_(e,{color:"danger",icon:"mdi-magnify"}),null,16)]),_:1},8,["text"])]),"append-inner":o(()=>[l(L,{"close-on-content-click":!1},{activator:o(({props:e})=>[l(c,_(e,{size:"sm",color:"primary"}),{default:o(()=>[l(c,null,{default:o(()=>t[16]||(t[16]=[m("mdi-filter")])),_:1}),l(r,{activator:"parent",text:a.$t("dialog.filters"),location:"bottom"},null,8,["text"])]),_:2},1040)]),default:o(()=>[l(I,null,{default:o(()=>[l(A,{color:"primary"},{default:o(()=>[l(c,null,{default:o(()=>t[17]||(t[17]=[m("mdi-filter")])),_:1}),m(" "+k(a.$t("dialog.filters")),1)]),_:1}),(u(!0),d(E,null,O(D.value,(e,p)=>(u(),x(g,{key:p,class:"text-dark"},{title:o(()=>[l(U,{modelValue:e.checked,"onUpdate:modelValue":N=>e.checked=N,label:e.label,onChange:$,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128)),l(ne),l(A,{color:"primary"},{default:o(()=>t[18]||(t[18]=[m("وضعیت تراکنش")])),_:1}),(u(!0),d(E,null,O(j.value,(e,p)=>(u(),x(g,{key:"filter-"+p,class:"text-dark"},{title:o(()=>[l(U,{modelValue:e.checked,"onUpdate:modelValue":N=>e.checked=N,label:e.label,onChange:$,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["loading","placeholder","modelValue"]),l(ie,{"items-per-page":b.value.rowsPerPage,"onUpdate:itemsPerPage":t[9]||(t[9]=e=>b.value.rowsPerPage=e),page:b.value.page,"onUpdate:page":t[10]||(t[10]=e=>b.value.page=e),"sort-by":b.value.sortBy,"onUpdate:sortBy":t[11]||(t[11]=e=>b.value.sortBy=e),headers:le.value,items:C.value,"items-length":R.value,loading:B.value,"multi-sort":"",class:"elevation-1","items-per-page-options":[5,10,20,50],"item-value":"code","items-per-page-text":"تعداد سطر","no-data-text":"اطلاعاتی برای نمایش وجود ندارد","header-props":{class:"custom-header"}},{"header.checkbox":o(()=>[l(U,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=e=>V.value=e),onChange:Z,"hide-details":"",density:"compact"},null,8,["modelValue"])]),"item.checkbox":o(({item:e})=>[l(U,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=p=>f.value=p),value:e,"hide-details":"",density:"compact",onChange:ee},null,8,["modelValue","value"])]),"item.operation":o(({item:e})=>[e?(u(),x(L,{key:0},{activator:o(({props:p})=>[l(n,_({variant:"text",size:"small",color:"error",icon:"mdi-menu"},p),null,16)]),default:o(()=>[l(I,null,{default:o(()=>[l(g,{title:a.$t("dialog.view"),to:"/acc/persons/card/view/"+e.code},{prepend:o(()=>[l(c,{color:"green-darken-4",icon:"mdi-eye"})]),_:2},1032,["title","to"]),l(g,{title:a.$t("dialog.edit"),to:"/acc/persons/mod/"+e.code},{prepend:o(()=>[l(c,{icon:"mdi-file-edit"})]),_:2},1032,["title","to"]),l(g,{title:a.$t("dialog.delete"),onClick:p=>Y(e.code)},{prepend:o(()=>[l(c,{color:"deep-orange-accent-4",icon:"mdi-trash-can"})]),_:2},1032,["title","onClick"])]),_:2},1024)]),_:2},1024)):y("",!0)]),"item.nikename":o(({item:e})=>[e?(u(),x(se,{key:0,to:"/acc/persons/card/view/"+e.code},{default:o(()=>[e.prelabel?(u(),d("span",ke,k(e.prelabel+" "+e.nikename),1)):(u(),d("span",xe,k(e.nikename),1))]),_:2},1032,["to"])):y("",!0)]),"item.speedAccess":o(({item:e})=>[e&&e.speedAccess?(u(),x(c,{key:0,color:"success"},{default:o(()=>t[19]||(t[19]=[m("mdi-check")])),_:1})):e?(u(),x(c,{key:1,color:"error"},{default:o(()=>t[20]||(t[20]=[m("mdi-close")])),_:1})):y("",!0)]),"item.status":o(({item:e})=>[e?(u(),d("span",ye,[e.bs>e.bd?(u(),d("span",he,"بستانکار")):e.bs<e.bd?(u(),d("span",we,"بدهکار")):(u(),d("span",$e,"تراز"))])):y("",!0)]),"item.bs":o(({item:e})=>[e?(u(),d("span",Ce,k(F(e.bs)),1)):y("",!0)]),"item.bd":o(({item:e})=>[e?(u(),d("span",Ve,k(F(e.bd)),1)):y("",!0)]),"item.balance":o(({item:e})=>[e?(u(),d("span",Ue,k(F(e.balance)),1)):y("",!0)]),_:1},8,["items-per-page","page","sort-by","headers","items","items-length","loading"]),l(be,{modelValue:P.value,"onUpdate:modelValue":t[13]||(t[13]=e=>P.value=e),"max-width":"600px"},{default:o(()=>[l(me,null,{default:o(()=>[l(ue,{class:"text-h6"},{default:o(()=>t[21]||(t[21]=[m("انتخاب ستون‌ها")])),_:1}),l(pe,null,{default:o(()=>[l(de,null,{default:o(()=>[(u(!0),d(E,null,O(oe.value,e=>(u(),x(ce,{key:e.value,cols:"12",sm:"4"},{default:o(()=>[l(U,{modelValue:e.visible,"onUpdate:modelValue":p=>e.visible=p,label:e.title,onChange:Q,"hide-details":"",class:"mb-2"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1}),l(ve,null,{default:o(()=>[l(s),l(n,{color:"primary",text:"",onClick:t[12]||(t[12]=e=>P.value=!1)},{default:o(()=>t[22]||(t[22]=[m("بستن")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ae as default};
