import{a as o,S as u,_ as b}from"./main-9b36f05f.js";import{h,a as C,o as n,s as r,e,t as d,aa as m,b as v,u as g,ab as y,d as k,F as p,C as A}from"./vendor-adef9cb4.js";const F=h({name:"archiveUpload",props:{doctype:String,docid:[String,Number],cat:String},data(){return{fileStack:[],des:"",media:{saved:[],added:[],removed:[]}}},mounted(){this.getFilesList()},methods:{changeMedia(s){this.media=s},addMedia(s,t){this.media.added=t},removeMedia(s,t){this.media.removed=t},getFilesList(){o.post("api/archive/files/list",{id:this.$props.docid,type:this.$props.doctype}).then(s=>{this.media.added=[],this.fileStack=s.data,this.fileStack.forEach(t=>{o.post(this.$filters.getApiUrl()+"/api/archive/file/get/"+t.id,{responseType:"arraybuffer"}).then(l=>{const i=btoa(String.fromCharCode(...new Uint8Array(l.data)));t.fileBin="data:"+l.headers["content-type"]+";base64,"+i})})})},deleteItem(s){u.fire({text:"آیا برای حذف فایل مطمئن هستید؟",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"}).then(t=>{t.isConfirmed&&o.post("api/archive/file/remove/"+s.id).then(l=>{l.data.result==1&&(this.getFilesList(),u.fire({text:"فایل با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"}))})})},downloadFile(s){o.post(this.$filters.getApiUrl()+"/api/archive/file/get/"+s.id,{responseType:"arraybuffer"}).then(t=>{const l=new Blob([t.data],{type:s.fileType}),i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=s.filename,i.click(),URL.revokeObjectURL(i.href)})},submitArchive(){let s=new FormData(document.getElementById("archive-file-upload"));o.post("api/archive/file/save",s,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{t.data.result==="nem"?u.fire({text:"فضای کافی وجود ندارد لطفا حساب کاربری خود را شارژ نمایید.",icon:"success",confirmButtonText:"قبول"}):(u.fire({text:"فایل‌های انتخابی ذخیره شدند.",icon:"success",confirmButtonText:"قبول"}),this.getFilesList())})}}}),w={type:"button",class:"btn btn-sm btn-outline-success mx-2","data-bs-toggle":"modal","data-bs-target":"#archiveModal"},x={class:"badge text-bg-dark me-2"},$={class:"modal modal-lg fade","data-bs-backdrop":"static","data-bs-keyboard":"false",id:"archiveModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},S={class:"modal-dialog"},B={class:"modal-content"},U={class:"modal-body"},M=["value"],L=["value"],T=["value"],E={class:"container-fluid mt-2"},D={class:"row"},R={class:"col-9"},_={class:"table table-striped table-hover table-borderless table-vcenter fs-sm text-center"},I=["src"],N={class:"fw-semibold"},V={class:"text-center text-nowrap fw-medium"},j=["onClick"],z=["onClick"];function O(s,t,l,i,q,G){const c=C("Uploader");return n(),r(p,null,[e("button",w,[e("span",x,d(s.fileStack.length),1),t[2]||(t[2]=e("i",{class:"fa fa-file me-1"},null,-1)),t[3]||(t[3]=e("span",{class:"d-none d-sm-inline-block"},"آرشیو",-1))]),e("div",$,[e("div",S,[e("div",B,[t[11]||(t[11]=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"آرشیو فایل"),e("div",{class:"block-options"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})])],-1)),e("div",U,[t[8]||(t[8]=e("h5",{class:"text-primary-dark mt-3 my-0 py-0"},"افزودن فایل جدید",-1)),e("div",null,[e("form",{id:"archive-file-upload",onSubmit:t[1]||(t[1]=m(a=>s.submitArchive(),["prevent"]))},[e("input",{type:"hidden",name:"doctype",value:s.$props.doctype},null,8,M),e("input",{type:"hidden",name:"docid",value:s.$props.docid},null,8,L),e("input",{type:"hidden",name:"cat",value:s.$props.cat},null,8,T),v(c,{server:s.$filters.getApiUrl()+"/api/archive/file/upload",media:s.media.saved,path:"/storage/media",onAdd:s.addMedia,onRemove:s.removeMedia,onChange:s.changeMedia,maxFilesize:5},null,8,["server","media","onAdd","onRemove","onChange"]),e("div",E,[e("div",D,[e("div",R,[g(e("input",{class:"form-control",type:"text",name:"des","onUpdate:modelValue":t[0]||(t[0]=a=>s.des=a),placeholder:"توضیحات","aria-label":"توضیحات"},null,512),[[y,s.des]])]),t[4]||(t[4]=e("div",{class:"col-3"},[e("button",{type:"submit",class:"btn btn-success d-flex"},[e("i",{class:"fa fa-save me-2"}),k(" بارگذاری فایل‌ها ")])],-1))])])],32)]),t[9]||(t[9]=e("hr",null,null,-1)),t[10]||(t[10]=e("h5",{class:"text-primary-dark mt-3 mb-0 pb-0"},"آرشیو فایل‌ها",-1)),e("table",_,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"text-uppercase"},[e("th",null,"پیش نمایش"),e("th",null,"نام فایل"),e("th",{class:""},"سایز فایل(مگابایت)"),e("th",{class:""},"تاریخ"),e("th",null,"عملیات")])],-1)),e("tbody",null,[(n(!0),r(p,null,A(s.fileStack,a=>(n(),r("tr",null,[e("td",null,[e("img",{class:"img-fluid",src:a.fileBin,alt:"پیش نمایش"},null,8,I)]),e("td",null,[e("span",N,d(a.filename),1)]),e("td",null,[e("span",null,d(a.filesize),1)]),e("td",null,[e("span",null,d(a.dateSubmit),1)]),e("td",V,[e("a",{class:"btn btn-sm btn-link",href:"/",onClick:m(f=>s.downloadFile(a),["prevent"])},t[5]||(t[5]=[e("i",{class:"fa fa-download"},null,-1)]),8,j),e("button",{onClick:f=>s.deleteItem(a),class:"btn btn-sm ms-2 btn-link text-danger"},t[6]||(t[6]=[e("i",{class:"fa fa-trash"},null,-1)]),8,z)])]))),256))])])]),t[12]||(t[12]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"بازگشت")],-1))])])])],64)}const K=b(F,[["render",O]]);export{K as A};
