import{S as n,a as o,_ as P}from"./main-9b36f05f.js";import{h as w,r as V,a as m,o as f,s as b,e as s,d as u,u as r,B as h,b as i,w as l,A as C,_ as F,ab as v,t as d,aa as B}from"./vendor-adef9cb4.js";const $=w({name:"pays",created(){this.loadData()},mounted(){},data:()=>({currencyConfig:{masked:!1,prefix:"",suffix:"ریال",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!1},year:{},date:"",transfer:{content:"cashdesk",bank:void 0,cashdesk:void 0,salary:void 0,amount:0,reference:"",table:5,id:"",des:"پرداخت بابت منسوجات نقره"},banks:[],cashdesks:[],salarys:[],order:{doc:[]},orderPays:0,customer:[],searchValue:"",loading:V(!0),items:[],headers:[{text:"تاریخ",value:"date",sortable:!0},{text:"مبلغ(ریال)",value:"amount",sortable:!0},{text:"نوع پرداخت",value:"type",sortable:!0},{text:"مرجع پرداخت",value:"ref",sortable:!0},{text:"توضیحات",value:"des",sortable:!0},{text:"عملیات",value:"operation"}]}),watch:{"transfer.bank":function(){this.transfer.id=this.transfer.bank.id},"transfer.salary":function(){this.transfer.id=this.transfer.salary.id},"transfer.cashdesk":function(){this.transfer.id=this.transfer.cashdesk.id}},methods:{removePay(e){n.fire({text:"آیا برای حذف این سوابق پرداخت مطمئن هستید؟",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(t=>{t.isConfirmed&&o.post("/api/plugin/noghre/order/pays/remove/"+e).then(c=>{c.data.result==1&&(this.loadPays(),n.fire({text:"پرداخت با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"}))})})},changeDes(e){this.transfer.content=e,e==" bank"?this.transfer.table=5:e==" salary"?this.transfer.table=122:e==" cashdesk"&&(this.transfer.table=121)},loadData(){o.post("/api/plugin/noghre/order/info/"+this.$route.params.id).then(e=>{this.order=e.data,this.customer=e.data.customer,this.loading=!1}),o.post("/api/bank/list").then(e=>{this.banks=e.data}),o.post("/api/cashdesk/list").then(e=>{this.cashdesks=e.data}),o.post("/api/salary/list").then(e=>{this.salarys=e.data}),o.post("/api/year/get").then(e=>{this.year=e.data,this.date=e.data.now}),this.loadPays()},loadPays(){this.loading=!0,o.post("/api/plugin/noghre/order/pays/list/"+this.$route.params.id).then(e=>{this.items=e.data,this.orderPays=0,this.items.forEach(t=>{this.orderPays+=parseInt(t.amount)}),this.loading=!1})},balace(){this.transfer.amount=this.order.doc.amount-this.orderPays},insertPay(){if(this.transfer.amount==0)n.fire({text:"مبلغ وارد نشده است.",icon:"error",confirmButtonText:"قبول"});else if(this.transfer.content=="bank"&&this.transfer.bank==null||this.transfer.content=="salary"&&this.transfer.salary==null||this.transfer.content=="cashdesk"&&this.transfer.cashdesk==null)n.fire({text:"حساب دریافت کننده انتخاب نشده است.",icon:"error",confirmButtonText:"قبول"});else{let e={date:this.date,des:this.transfer.des,type:"plugNoghrePay",refData:this.order.id,plugin:"plugNoghrePay",update:"",rows:[{bs:0,bd:this.transfer.amount,type:this.transfer.content,bank:this.transfer.bank,salary:this.transfer.salary,cashdesk:this.transfer.cashdesk,table:this.transfer.table,id:this.transfer.id,des:this.transfer.des,referral:this.transfer.reference,plugin:"plugNoghrePay",refData:this.order.doc.code},{bd:0,bs:this.transfer.amount,type:"person",table:3,id:this.customer.id,des:this.transfer.des,referral:this.transfer.reference}]};o.post("/api/accounting/insert",e).then(t=>{t.data.result=="1"?n.fire({text:" پرداخت با موفقیت ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(c=>{document.getElementById("modalCloseBtn").click(),this.loadPays()}):t.data.result=="4"&&n.fire({text:t.data.msg,icon:"error",confirmButtonText:"قبول"})})}}}}),E={class:"block block-content-full"},D={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},N={class:"block-title text-primary-dark"},T={class:"block-options"},M={type:"button",class:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#theModal"},_={class:"modal fade","data-bs-backdrop":"static","data-bs-keyboard":"false",id:"theModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},U={class:"modal-dialog"},S={class:"modal-content"},O={class:"modal-body"},I={class:"container"},L={class:"row"},R={class:"col-sm-12 col-md-12"},z={class:"btn-group d-flex",role:"group","aria-label":"Basic radio toggle button group"},j={class:"row mt-2"},q={class:"col-12"},G={key:0,class:""},H={class:"form-floating mb-2"},J={key:1,class:""},K={class:"form-floating mb-2"},Q={key:2,class:""},W={class:"form-floating mb-2"},X={class:"form-floating mb-2"},Y={class:"form-floating mb-2"},Z={class:"form-floating mb-2"},tt={class:"modal-footer"},st={class:"block-content pt-1 pb-3"},et={class:"row"},at={class:"row mx-0 my-1 py-2 border border-secondary rounded-2 bg-success-light"},ot={class:"col-sm-12 col-md-3"},ut={class:"col-sm-12 col-md-3"},rt={class:"col-sm-12 col-md-3"},nt={class:"col-sm-12 col-md-3"},it={class:"text-warning"},lt={class:"col-sm-12 col-md-12 m-0 p-0"},dt={class:"mb-1"},mt={class:"input-group input-group-sm"},ft=["onClick"];function bt(e,t,c,ht,ct,pt){const p=m("v-cob"),k=m("money3"),x=m("router-link"),A=m("EasyDataTable");return f(),b("div",E,[s("div",D,[s("h3",N,[s("button",{onClick:t[0]||(t[0]=a=>e.$router.back()),type:"button",class:"float-start d-none d-sm-none d-md-block btn btn-sm btn-link text-warning"},t[13]||(t[13]=[s("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),t[14]||(t[14]=s("i",{class:"mx-2 fa fa-money-bill-wave"},null,-1)),t[15]||(t[15]=u(" پرداخت‌های سفارش "))]),s("div",T,[r(s("button",M," افزودن پرداخت ",512),[[h,this.orderPays!=this.order.doc.amount&&this.loading===!1]]),s("div",_,[s("div",U,[s("div",S,[t[30]||(t[30]=s("div",{class:"modal-header"},[s("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"افزودن پرداخت"),s("div",{class:"block-options"},[s("button",{type:"button",id:"modalCloseBtn",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})])],-1)),s("div",O,[s("div",I,[s("div",L,[s("div",R,[t[28]||(t[28]=s("h3",null,"واریز به:",-1)),s("div",z,[s("input",{onChange:t[1]||(t[1]=a=>this.changeDes("cashdesk")),type:"radio",class:"btn-check",name:"btnradio1",id:"btnradio5",autocomplete:"off",checked:""},null,32),t[16]||(t[16]=s("label",{class:"btn btn-outline-primary",for:"btnradio5"},"صندوق",-1)),s("input",{onChange:t[2]||(t[2]=a=>this.changeDes("bank")),type:"radio",class:"btn-check",name:"btnradio1",id:"btnradio4",autocomplete:"off"},null,32),t[17]||(t[17]=s("label",{class:"btn btn-outline-primary",for:"btnradio4"},"بانک",-1)),s("input",{onChange:t[3]||(t[3]=a=>this.changeDes("salary")),type:"radio",class:"btn-check",name:"btnradio1",id:"btnradio6",autocomplete:"off"},null,32),t[18]||(t[18]=s("label",{class:"btn btn-outline-primary",for:"btnradio6"},"تنخواه",-1))]),s("div",j,[s("div",q,[this.transfer.content=="bank"?(f(),b("div",G,[t[20]||(t[20]=s("label",{class:"form-label"},"بانک",-1)),s("div",H,[i(p,{dir:"rtl",options:e.banks,label:"name",modelValue:this.transfer.bank,"onUpdate:modelValue":t[4]||(t[4]=a=>this.transfer.bank=a)},{"no-options":l(({search:a,searching:y,loading:g})=>t[19]||(t[19]=[u(" نتیجه‌ای یافت نشد! ")])),_:1},8,["options","modelValue"])])])):C("",!0),this.transfer.content=="cashdesk"?(f(),b("div",J,[t[22]||(t[22]=s("label",{class:"form-label"},"صندوق",-1)),s("div",K,[i(p,{dir:"rtl",options:e.cashdesks,label:"name",modelValue:this.transfer.cashdesk,"onUpdate:modelValue":t[5]||(t[5]=a=>this.transfer.cashdesk=a)},{"no-options":l(({search:a,searching:y,loading:g})=>t[21]||(t[21]=[u(" نتیجه‌ای یافت نشد! ")])),_:1},8,["options","modelValue"])])])):C("",!0),this.transfer.content=="salary"?(f(),b("div",Q,[t[24]||(t[24]=s("label",{class:"form-label"},"تنخواه گردان",-1)),s("div",W,[i(p,{dir:"rtl",options:e.salarys,label:"name",modelValue:this.transfer.salary,"onUpdate:modelValue":t[6]||(t[6]=a=>this.transfer.salary=a)},{"no-options":l(({search:a,searching:y,loading:g})=>t[23]||(t[23]=[u(" نتیجه‌ای یافت نشد! ")])),_:1},8,["options","modelValue"])])])):C("",!0),s("div",X,[i(k,F(e.currencyConfig,{min:"0",class:"form-control",modelValue:this.transfer.amount,"onUpdate:modelValue":t[7]||(t[7]=a=>this.transfer.amount=a)}),null,16,["modelValue"]),t[25]||(t[25]=s("label",{class:"form-label"},"مبلغ",-1)),s("button",{onClick:t[8]||(t[8]=a=>e.balace()),class:"btn btn-primary mt-1"},"تسویه کامل")]),s("div",Y,[r(s("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>this.transfer.reference=a),class:"form-control",type:"text"},null,512),[[v,this.transfer.reference]]),t[26]||(t[26]=s("label",{class:"form-label"},"ارجاع",-1))]),s("div",Z,[r(s("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>this.transfer.des=a),class:"form-control",type:"text"},null,512),[[v,this.transfer.des]]),t[27]||(t[27]=s("label",{class:"form-label"},"توضیحات",-1))])])])])])])]),s("div",tt,[t[29]||(t[29]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"انصراف",-1)),s("button",{onClick:t[11]||(t[11]=a=>e.insertPay()),type:"button",class:"btn btn-primary"},"ثبت")])])])])])]),s("div",st,[s("div",et,[s("div",at,[s("div",ot,[s("p",null,"مشتری:"+d(this.customer.nikename),1)]),s("div",ut,[s("p",null,"مبلغ سفارش:"+d(e.$filters.formatNumber(this.order.doc.amount))+"ریال",1)]),s("div",rt,[s("p",null,"مبلغ پرداختی:"+d(e.$filters.formatNumber(this.orderPays))+"ریال",1)]),s("div",nt,[r(s("p",null,t[31]||(t[31]=[u("وضعیت: "),s("span",{class:"text-success"},"تسویه شده",-1)]),512),[[h,this.orderPays==this.order.doc.amount]]),r(s("p",null,t[32]||(t[32]=[u("وضعیت: "),s("span",{class:"text-danger"},"بدون پرداختی",-1)]),512),[[h,this.orderPays==0]]),r(s("p",null,[s("span",it,d(e.$filters.formatNumber(this.order.doc.amount-this.orderPays))+" ریال بدهکار ",1)],512),[[h,this.orderPays!=0&&this.orderPays!=this.order.doc.amount]])])]),s("div",lt,[s("div",dt,[s("div",mt,[t[33]||(t[33]=s("span",{class:"input-group-text"},[s("i",{class:"fa fa-search"})],-1)),r(s("input",{"onUpdate:modelValue":t[12]||(t[12]=a=>e.searchValue=a),class:"form-control",type:"text",placeholder:"جست و جو ..."},null,512),[[v,e.searchValue]])])]),i(A,{"table-class-name":"customize-table","multi-sort":"","show-index":"",alternating:"","search-value":e.searchValue,headers:e.headers,items:e.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:e.loading},{"item-operation":l(({code:a,id:y})=>[i(x,{to:"/acc/accounting/view/"+a},{default:l(()=>t[34]||(t[34]=[s("i",{class:"fa fa-book px-2"},null,-1)])),_:2},1032,["to"]),s("a",{onClick:B(g=>e.removePay(a),["prevent"])},t[35]||(t[35]=[s("i",{class:"fa fa-trash px-2 text-danger"},null,-1)]),8,ft)]),"item-amount":l(({amount:a})=>[u(d(e.$filters.formatNumber(a)),1)]),_:1},8,["search-value","headers","items","loading"])])])])])}const Ct=P($,[["render",bt]]);export{Ct as default};
