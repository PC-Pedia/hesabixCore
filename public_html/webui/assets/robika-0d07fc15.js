import{S as d,a as b,_ as w}from"./main-9b36f05f.js";import{h as $,a as h,o as r,s as c,e as t,ar as q,b as m,u,ab as p,B as n,d as i,F as D,C as B,t as F,w as k,A as g,_ as U}from"./vendor-adef9cb4.js";import{_ as j,a as x,b as N,c as S}from"./recList-3e892c5b.js";const Y=$({name:"rec",props:{totalAmount:Number,originalDoc:String,person:[String,Number],windowsState:Object},data:()=>({submitedDoc:{},des:"",items:[],date:"",year:{},listBanks:[],listSalarys:[],listCashdesks:[],totalPays:0,currencyConfig:{masked:!1,prefix:"",suffix:"ریال",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0}}),methods:{fillWithTotal(o){o.bd=this.$props.totalAmount-this.totalPays},addItem(o){let s={},l=!0;o=="bank"?this.listBanks.length==0?(d.fire({text:"ابتدا یک حساب بانکی ایجاد کنید.در حال حاضر هیچ بانکی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1):s={id:"",type:"bank",bank:{},cashdesk:{},salary:{},bs:0,bd:0,des:"",table:5,referral:""}:o=="cashdesk"?(this.listCashdesks.length==0&&(d.fire({text:"ابتدا یک صندوق ایجاد کنید.در حال حاضر هیچ صندوقی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1),s={id:"",type:"cashdesk",bank:{},cashdesk:{},salary:{},bs:0,bd:0,des:"",table:121,referral:""}):o=="salary"?(this.listSalarys.length==0&&(d.fire({text:"ابتدا یک تخواه گردان ایجاد کنید.در حال حاضر هیچ تنخواه گردانی تعریف نشده است.",icon:"error",confirmButtonText:"قبول"}),l=!1),s={id:"",type:"salary",bank:{},cashdesk:{},salary:{},bs:0,bd:0,des:"",table:122,referral:""}):o=="cheque"&&(s={id:"",type:"cheque",bank:{},cashdesk:{},salary:{},bs:0,bd:0,des:"",table:125,referral:"",chequeBank:"",chequeDate:"",chequeSayadNum:"",chequeNum:"",chequeType:"input",chequeOwner:this.$props.person}),l&&this.items.push(s)},deleteItem(o){this.items.splice(o,1),this.calc()},loadData(){b.post("/api/bank/list").then(o=>{this.listBanks=o.data}),b.post("/api/salary/list").then(o=>{this.listSalarys=o.data}),b.post("/api/cashdesk/list").then(o=>{this.listCashdesks=o.data}),b.post("/api/year/get").then(o=>{this.year=o.data,this.date=o.data.now})},calc(){this.totalPays=0,this.items.forEach(o=>{this.totalPays+=parseInt(o.bd)})},async submit(){let o=[];if(this.$props.totalAmount<this.totalPays&&o.push("مبالغ وارد شده بیشتر از مبلغ فاکتور است."),this.items.forEach((s,l)=>{s.bd==0&&o.push("مبلغ صفر در ردیف "+(l+1)+" نا معتبر است."),s.type=="cheque"&&(s.chequeBank==""||s.chequeNum==""||s.chequeDate=="")&&(s.bank==null||Object.keys(s.bank).length==0)&&o.push("موارد الزامی ثبت چک در ردیف  "+(l+1)+" وارد نشده است."),s.type=="bank"?(s.bank==null||Object.keys(s.bank).length==0)&&o.push("بانک در ردیف  "+(l+1)+" انتخاب نشده است."):s.type=="salary"?(s.salary==null||Object.keys(s.salary).length==0)&&o.push("تنخواه گردان در ردیف  "+(l+1)+" انتخاب نشده است."):s.type=="cashdesk"&&(s.cashdesk==null||Object.keys(s.cashdesk).length==0)&&o.push("صندوق در ردیف  "+(l+1)+" انتخاب نشده است.")}),this.items.length==0)d.fire({text:"هیچ دریافتی ثبت نشده است.",icon:"error",confirmButtonText:"قبول"});else if(o.length!=0){let s='<ul class="justify-content-center">';o.forEach(l=>{s+='<div class="">'+l+"</div>"}),s+="</ul>",d.fire({html:s,icon:"error",confirmButtonText:"قبول"})}else{let s=[...this.items];s.forEach(l=>{l.type=="bank"?l.id=l.bank.id:l.type=="salary"?l.id=l.salary.id:l.type=="cashdesk"&&(l.id=l.cashdesk.id),l.des==""&&(l.des="دریافت وجه فاکتور شماره "+this.$props.originalDoc)}),s.push({id:this.$props.person,type:"person",bd:0,bs:this.totalPays,table:3,des:"دریافت وجه فاکتور شماره "+this.$filters.formatNumber(this.$props.originalDoc)}),this.des==""&&(this.des="دریافت وجه فاکتور شماره "+this.$filters.formatNumber(this.originalDoc)),b.post("/api/accounting/insert",{date:this.date,des:this.des,type:"sell_receive",update:null,rows:s,related:this.$props.originalDoc}).then(l=>{l.data.result=="1"?d.fire({text:"سند با موفقیت ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(V=>{this.submitedDoc=l.data.doc,this.$props.windowsState.submited=!0}):l.data.result=="4"&&d.fire({text:l.data.msg,icon:"error",confirmButtonText:"قبول"})})}}},mounted(){this.loadData()}}),T={class:"modal-dialog modal-lg","data-bs-backdrop":"static","data-bs-keyboard":"false"},I={class:"modal-content"},M={class:"modal-body"},P={class:"row mb-3"},E={class:"col-sm-12 col-md-5 mb-2"},O={class:"col-sm-12 col-md-7 mb-2"},L={class:"row"},R={class:"col-sm-12 col-md-6 mb-2"},W={class:"input-group input-group-sm"},H=["value"],z={class:"col-sm-12 col-md-6 mb-2"},G={class:"input-group input-group-sm"},J=["value"],K={class:"row"},Q={class:"col"},X={class:"alert alert-warning"},Z={class:"row"},ss={class:"col-12 ps-2"},ts={class:"card my-1"},os={class:"card-body p-1"},es={class:"row"},ls={class:"col-2 text-center"},as={class:"mb-1 text-start"},us={class:"badge bg-primary-light"},is={src:j,class:"img-fluid"},ns={src:x,class:"img-fluid"},ds={src:N,class:"img-fluid"},rs={src:S,class:"img-fluid"},cs=["onClick"],ms={class:"col-10 my-2 ps-0"},ps={class:"row"},bs={class:"col-sm-12 col-md-6"},fs={class:""},hs={class:""},ks={class:""},gs=["onUpdate:modelValue"],_s={class:""},vs={key:0,class:"col-sm-12 col-md-6"},ys={class:"mb-1"},Cs=["onUpdate:modelValue"],Vs={key:1,class:"col-sm-12 col-md-6"},As={class:"mb-1"},ws=["onUpdate:modelValue"],$s={key:2,class:"col-sm-12 col-md-6"},qs={class:"mb-1"},Ds={class:"form-control"},Bs={class:"col-sm-12 col-md-6"},Fs={class:"mb-1"},Us={class:"block-options px-0"},js=["onClick"],xs={class:"col-sm-12 col-md-6"},Ns={class:"mb-1"},Ss=["onUpdate:modelValue"],Ys={class:"col-sm-12 col-md-6"},Ts={class:"mb-1"},Is=["onUpdate:modelValue"],Ms={class:"modal-footer"},Ps={class:"btn-group dropup"},Es={class:"dropdown-menu"};function Os(o,s,l,V,Ls,Rs){const _=h("date-picker"),f=h("v-cob"),A=h("money3");return r(),c("div",T,[t("div",I,[s[32]||(s[32]=q('<div class="modal-header"><h1 class="modal-title fs-5" id="exampleModalLabel1"><i class="fas fa-money-bill-1 ms-2"></i> ثبت دریافت </h1><div class="block-options"><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div></div>',1)),t("div",M,[t("div",P,[t("div",E,[m(_,{class:"form-control",modelValue:o.date,"onUpdate:modelValue":s[0]||(s[0]=e=>o.date=e),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:o.year.start,max:o.year.end},null,8,["modelValue","min","max"])]),t("div",O,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>o.des=e),placeholder:"شرح"},null,512),[[p,o.des]])])]),t("div",L,[t("div",R,[t("div",W,[s[8]||(s[8]=t("span",{class:"input-group-text"}," مجموع ",-1)),t("input",{type:"text",readonly:"readonly",class:"form-control",value:this.$filters.formatNumber(parseInt(this.totalPays))},null,8,H)])]),t("div",z,[t("div",G,[s[9]||(s[9]=t("span",{class:"input-group-text"}," باقی مانده ",-1)),t("input",{type:"text",readonly:"readonly",class:"form-control",value:this.$filters.formatNumber(parseInt(this.$props.totalAmount)-parseInt(this.totalPays))},null,8,J)])])]),t("div",K,[t("div",Q,[s[11]||(s[11]=t("p",{class:"mb-1"},"دریافت‌ها:",-1)),u(t("div",X,s[10]||(s[10]=[t("i",{class:"fa fa-info pe-3"},null,-1),i(" تاکنون سند دریافتی ثبت نشده است. ")]),512),[[n,o.items.length===0]])])]),t("div",Z,[(r(!0),c(D,null,B(o.items,(e,v)=>(r(),c("div",ss,[t("i",ts,[t("div",os,[t("div",es,[t("div",ls,[t("h6",as,[t("span",us,F(v+1),1)]),u(t("img",is,null,512),[[n,e.type=="bank"]]),u(t("img",ns,null,512),[[n,e.type=="cashdesk"]]),u(t("img",ds,null,512),[[n,e.type=="salary"]]),u(t("img",rs,null,512),[[n,e.type=="cheque"]]),t("button",{onClick:a=>o.deleteItem(v),type:"button",class:"btn text-danger mt-2"},s[12]||(s[12]=[t("i",{class:"fa fa-trash"},null,-1)]),8,cs)]),t("div",ms,[t("div",ps,[t("div",bs,[u(t("div",fs,[s[14]||(s[14]=t("label",{class:"form-label"},"بانک",-1)),m(f,{dir:"rtl",options:o.listBanks,label:"name",modelValue:e.bank,"onUpdate:modelValue":a=>e.bank=a},{"no-options":k(({search:a,searching:y,loading:C})=>s[13]||(s[13]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,e.type=="bank"]]),u(t("div",hs,[s[16]||(s[16]=t("label",{class:"form-label"},"صندوق",-1)),m(f,{dir:"rtl",options:o.listCashdesks,label:"name",modelValue:e.cashdesk,"onUpdate:modelValue":a=>e.cashdesk=a},{"no-options":k(({search:a,searching:y,loading:C})=>s[15]||(s[15]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,e.type=="cashdesk"]]),u(t("div",ks,[s[17]||(s[17]=t("label",{class:"form-label"},[t("small",{class:"text-danger"},"*"),i(" شماره چک")],-1)),u(t("input",{class:"form-control","onUpdate:modelValue":a=>e.chequeNum=a},null,8,gs),[[p,e.chequeNum]])],512),[[n,e.type=="cheque"]]),u(t("div",_s,[s[19]||(s[19]=t("label",{class:"form-label"},"تنخواه گردان",-1)),m(f,{dir:"rtl",options:o.listSalarys,label:"name",modelValue:e.salary,"onUpdate:modelValue":a=>e.salary=a},{"no-options":k(({search:a,searching:y,loading:C})=>s[18]||(s[18]=[i(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])],512),[[n,e.type=="salary"]])]),e.type=="cheque"?(r(),c("div",vs,[t("div",ys,[s[20]||(s[20]=t("label",{class:"form-label"},[t("small",{class:"text-danger"},"*"),i(" شماره صیاد ")],-1)),u(t("input",{type:"text","onUpdate:modelValue":a=>e.chequeSayadNum=a,class:"form-control"},null,8,Cs),[[p,e.chequeSayadNum]])])])):g("",!0),e.type=="cheque"?(r(),c("div",Vs,[t("div",As,[s[21]||(s[21]=t("label",{class:"form-label"},[t("small",{class:"text-danger"},"*"),i(" بانک صادر‌ کننده ")],-1)),u(t("input",{type:"text","onUpdate:modelValue":a=>e.chequeBank=a,class:"form-control"},null,8,ws),[[p,e.chequeBank]])])])):g("",!0),e.type=="cheque"?(r(),c("div",$s,[t("div",qs,[t("div",Ds,[s[22]||(s[22]=t("label",{class:"form-label"},[t("small",{class:"text-danger"},"*"),i(" تاریخ ")],-1)),m(_,{class:"",modelValue:e.chequeDate,"onUpdate:modelValue":a=>e.chequeDate=a,format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD"},null,8,["modelValue","onUpdate:modelValue"])])])])):g("",!0),t("div",Bs,[t("div",Fs,[t("div",Us,[s[23]||(s[23]=t("label",{class:"form-label"},[t("small",{class:"text-danger"},"*"),i(" مبلغ ")],-1)),t("button",{onClick:a=>o.fillWithTotal(e),class:"btn btn-sm btn-link block-options-item float-end me-2"},"کل فاکتور",8,js)]),m(A,U({onChange:s[2]||(s[2]=a=>o.calc()),class:"form-control",modelValue:e.bd,"onUpdate:modelValue":a=>e.bd=a,ref_for:!0},o.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])]),t("div",xs,[t("div",Ns,[s[24]||(s[24]=t("label",{class:"form-label"},"ارجاع",-1)),u(t("input",{type:"text","onUpdate:modelValue":a=>e.referral=a,class:"form-control"},null,8,Ss),[[p,e.referral]])])]),t("div",Ys,[t("div",Ts,[s[25]||(s[25]=t("label",{class:"form-label"},"شرح",-1)),u(t("input",{class:"form-control","onUpdate:modelValue":a=>e.des=a},null,8,Is),[[p,e.des]])])])])])])])])]))),256))])]),t("div",Ms,[t("div",Ps,[s[30]||(s[30]=t("button",{class:"btn btn-sm me-1 btn-success dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa fa-plus"}),i(" افزودن دریافت ")],-1)),t("ul",Es,[t("li",null,[t("button",{type:"button",onClick:s[3]||(s[3]=e=>o.addItem("bank")),class:"dropdown-item"},s[26]||(s[26]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" حساب بانکی")]))]),t("li",null,[t("button",{type:"button",onClick:s[4]||(s[4]=e=>o.addItem("cashdesk")),class:"dropdown-item"},s[27]||(s[27]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" صندوق")]))]),t("li",null,[t("button",{type:"button",onClick:s[5]||(s[5]=e=>o.addItem("salary")),class:"dropdown-item"},s[28]||(s[28]=[t("i",{class:"fa fa-dot-circle"},null,-1),i(" تنخواه گردان")]))]),t("li",null,[t("button",{type:"button",onClick:s[6]||(s[6]=e=>o.addItem("cheque")),class:"dropdown-item"},s[29]||(s[29]=[t("i",{class:"fa fa-dot-circle"},null,-1),i("چک")]))])])]),t("button",{onClick:s[7]||(s[7]=e=>o.submit()),class:"btn btn-sm btn-primary",type:"button"},s[31]||(s[31]=[t("i",{class:"fa fa-save me-2"},null,-1),i(" ثبت ")]))])])])}const Gs=w(Y,[["render",Os]]),Js="/webui/img/icons/telegram.png",Ks="/webui/img/icons/eitaa.jpeg",Qs="/webui/img/icons/bale-logo.png",Xs="/webui/img/icons/robika.png";export{Js as _,Ks as a,Qs as b,Xs as c,Gs as r};
