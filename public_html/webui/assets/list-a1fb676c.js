import{_ as j,S as p,a as g}from"./main-9b36f05f.js";import{r as q,a as n,o as f,s as y,b as l,w as a,_,d as m,F as $,C as M,c as D,e as h,u as G,ao as H,t as r,A as w}from"./vendor-adef9cb4.js";const J={name:"list",data:()=>({printModal:!1,printOptions:{pays:!0,note:!0,bidInfo:!0,taxInfo:!0,discountInfo:!0,selectedPrintCode:0,paper:"A4-L"},paperSizes:[{title:"A4 عمودی",value:"A4"},{title:"A4 افقی",value:"A4-L"},{title:"A5 عمودی",value:"A5"},{title:"A5 افقی",value:"A5-L"}],sumSelected:0,sumTotal:0,itemsSelected:[],searchValue:"",types:[],loading:q(!0),items:[],orgItems:[],headers:[{text:"عملیات",value:"operation"},{text:"فاکتور",value:"code",sortable:!0},{text:"تاریخ",value:"date",sortable:!0},{text:"خریدار",value:"person",sortable:!0},{text:"تخفیف",value:"discountAll",sortable:!0},{text:"حمل و نقل",value:"transferCost",sortable:!0},{text:"مبلغ",value:"amount",sortable:!0},{text:"پرداختی",value:"relatedDocsCount",sortable:!0},{text:"برچسب",value:"label",width:100},{text:"شرح",value:"des",sortable:!0}]}),methods:{openPrintModal(t){this.printOptions.selectedPrintCode=t,this.printModal=!0},changeLabel(t){this.itemsSelected.length==0?p.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):(this.loading=!0,g.post("/api/buy/label/change",{items:this.itemsSelected,label:t}).then(e=>{this.loading=!1,e.data.code==0?(p.fire({text:"فاکتور‌ها با موفقیت ویرایش شد.",icon:"success",confirmButtonText:"قبول"}),this.itemsSelected=[]):e.data.result==2&&p.fire({text:e.data.message,icon:"warning",confirmButtonText:"قبول"}),this.loadData()}))},filterTable(){this.loading=!0;let t=[],e=!0,i=[];this.types.forEach(u=>{u.checked==!0&&(e=!1,i.push(u))}),e?this.items=this.orgItems:(this.orgItems.forEach(u=>{i.forEach(k=>{if(u.label&&k.code==u.label.code){let d=!1;t.forEach(v=>{u.label.code==v.code&&(d=!0)}),d==!1&&t.push(u)}})}),this.items=t),this.loading=!1},loadData(){g.post("/api/printers/options/info").then(t=>{this.printOptions=t.data.buy}),g.post("/api/invoice/types",{type:"buy"}).then(t=>{this.types=t.data}),g.post("/api/buy/docs/search",{type:"buy"}).then(t=>{this.items=t.data,this.orgItems=t.data,this.items.forEach(e=>{this.sumTotal+=parseInt(e.amount)}),this.loading=!1})},canEditItem(t){this.loading=!0,g.post("/api/buy/edit/can/"+t).then(e=>{this.loading=!1,e.data.result==!1?p.fire({text:"این فاکتور به دلیل وجود اسناد پرداخت یا حواله‌های انبار مرتبط با آن قابل ویرایش نیست",confirmButtonText:"قبول",icon:"error"}):this.$router.push("/acc/buy/mod/"+t)})},deleteItems(){this.itemsSelected.length==0?p.fire({text:"هیچ موردی انتخاب نشده است.",icon:"warning",confirmButtonText:"قبول"}):p.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله‌های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(t=>{t.isConfirmed&&(this.loading=!0,g.post("/api/accounting/remove/group",{items:this.itemsSelected}).then(e=>{this.loading=!1,e.data.result==1?(this.loadData(),p.fire({text:"فاکتورها با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})):e.data.result==2&&p.fire({text:e.data.message,icon:"warning",confirmButtonText:"قبول"})}))})},printInvoice(t=!0,e=!0){this.loading=!0,g.post("/api/buy/print/invoice",{code:this.printOptions.selectedPrintCode,pdf:t,printers:e,printOptions:this.printOptions}).then(i=>{this.loading=!1,window.open(this.$API_URL+"/front/print/"+i.data.id,"_blank","noreferrer")})},deleteItem(t){p.fire({text:"آیا برای حذف این مورد مطمئن هستید؟ تمامی اسناد پرداخت و حواله‌های انبار همراه فاکتور نیز حذف خواهند شد.",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر",icon:"warning"}).then(e=>{e.isConfirmed&&g.post("/api/accounting/remove",{code:t}).then(i=>{if(i.data.result==1){let u=0;for(let k=0;k<this.items.length;k++)u++,this.items[k].code==t&&this.items.splice(u-1,1);p.fire({text:"فاکتور خرید با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"})}else i.data.result==2&&p.fire({text:i.data.message,icon:"warning",confirmButtonText:"قبول"})})})}},beforeMount(){this.loadData()},watch:{itemsSelected:{handler:function(t){this.sumSelected=0,this.itemsSelected.forEach(e=>{typeof e.amount.valueOf()=="string"?this.sumSelected+=parseInt(e.amount.replaceAll(",","")):this.sumSelected+=e.amount})},deep:!0},searchValue:{handler:function(t){if(this.searchValue=="")this.items=this.orgItems;else{let e=[];this.orgItems.forEach(i=>{(i.person.nikename.includes(this.searchValue)||i.date.includes(this.searchValue)||i.amount.toString().includes(this.searchValue)||i.des.includes(this.searchValue)||i.code.includes(this.searchValue)||i.label&&i.label.label.includes(this.searchValue))&&e.push(i)}),this.items=e}},deep:!1}}},K={class:"sticky-container"},Q={class:"form-check form-check-inline mx-1"},W=["onUpdate:modelValue"],X={class:"form-check-label"},Y={key:0},Z={key:0,class:"text-success"},ee={key:1,class:"text-danger"},te={key:2,class:"text-info"},oe={key:0,class:"text-success"},le={class:"text-dark"},ae={class:"text-dark"},ie={class:"text-dark"},ne={class:"text-dark"},se={class:"text-primary"},re={class:"text-dark"},de={class:"text-primary"};function ce(t,e,i,u,k,d){const v=n("v-btn"),x=n("v-tooltip"),E=n("v-spacer"),s=n("v-icon"),T=n("v-list-subheader"),b=n("v-list-item"),C=n("v-list"),I=n("v-menu"),N=n("v-toolbar"),P=n("v-text-field"),B=n("router-link"),U=n("EasyDataTable"),L=n("v-select"),V=n("v-switch"),O=n("v-card"),z=n("v-dialog"),A=n("v-col"),F=n("v-row"),R=n("v-card-text");return f(),y("div",K,[l(N,{color:"toolbar",title:t.$t("فاکتورهای خرید")},{prepend:a(()=>[l(x,{text:"بازگشت",location:"bottom"},{activator:a(({props:o})=>[l(v,_(o,{onClick:e[0]||(e[0]=c=>t.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1})]),default:a(()=>[l(E),l(x,{text:"اضافه کردن جدید",location:"bottom"},{activator:a(({props:o})=>[l(v,_(o,{icon:"mdi-plus",color:"primary",to:"/acc/buy/mod/"}),null,16)]),_:1}),l(x,{text:"حذف",location:"bottom"},{activator:a(({props:o})=>[l(v,_(o,{icon:"mdi-delete",color:"danger",onClick:e[1]||(e[1]=c=>d.deleteItems())}),null,16)]),_:1}),l(I,null,{activator:a(({props:o})=>[l(v,_(o,{icon:"",color:"green"}),{default:a(()=>[l(x,{activator:"parent",text:"تغییر برچسب‌ها",location:"bottom"}),l(s,{icon:"mdi-dots-horizontal-circle"})]),_:2},1040)]),default:a(()=>[l(C,null,{default:a(()=>[l(T,{color:"primary"},{default:a(()=>e[15]||(e[15]=[m("تغییر برچسب‌ها")])),_:1}),(f(!0),y($,null,M(t.types,o=>(f(),D(b,{class:"text-dark",title:"تغییر به "+o.label,onClick:c=>d.changeLabel(o)},{prepend:a(()=>[l(s,{color:"green-darken-4",icon:"mdi-label"})]),_:2},1032,["title","onClick"]))),256)),l(b,{class:"text-dark",title:"حذف برچسب‌ها",onClick:e[2]||(e[2]=o=>d.changeLabel("clear"))},{prepend:a(()=>[l(s,{color:"red",icon:"mdi-undo"})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),l(P,{"hide-details":"",color:"green",class:"pt-0 rounded-0 mb-0",density:"compact",placeholder:"جستجو ...",modelValue:t.searchValue,"onUpdate:modelValue":e[4]||(e[4]=o=>t.searchValue=o),type:"text",clearable:""},{"prepend-inner":a(()=>[l(x,{location:"bottom",text:"جستجو"},{activator:a(({props:o})=>[l(s,_(o,{color:"danger",icon:"mdi-magnify"}),null,16)]),_:1})]),"append-inner":a(()=>[l(I,{"close-on-content-click":!1},{activator:a(({props:o})=>[l(s,_({size:"sm"},o,{icon:"",color:"primary"}),{default:a(()=>[l(x,{activator:"parent",variant:"plain",text:"فیلترها",location:"bottom"}),l(s,{icon:"mdi-filter"})]),_:2},1040)]),default:a(()=>[l(C,null,{default:a(()=>[l(T,{color:"primary"},{default:a(()=>[l(s,{icon:"mdi-filter"}),e[16]||(e[16]=m(" فیلترها "))]),_:1}),(f(!0),y($,null,M(t.types,(o,c)=>(f(),D(b,{class:"text-dark"},{title:a(()=>[h("div",Q,[G(h("input",{onChange:e[3]||(e[3]=(...S)=>d.filterTable&&d.filterTable(...S)),"onUpdate:modelValue":S=>t.types[c].checked=S,class:"form-check-input",type:"checkbox"},null,40,W),[[H,t.types[c].checked]]),h("label",X,r(o.label),1)])]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(U,{"items-selected":t.itemsSelected,"onUpdate:itemsSelected":e[5]||(e[5]=o=>t.itemsSelected=o),"table-class-name":"customize-table","show-index":"",alternating:"",headers:t.headers,items:t.items,"theme-color":"#1d90ff","header-text-direction":"center","body-text-direction":"center",rowsPerPageMessage:"تعداد سطر",emptyMessage:"اطلاعاتی برای نمایش وجود ندارد",rowsOfPageSeparatorMessage:"از",loading:t.loading},{"item-operation":a(({code:o})=>[l(I,null,{activator:a(({props:c})=>[l(v,_({variant:"text",size:"small",color:"error",icon:"mdi-menu"},c),null,16)]),default:a(()=>[l(C,null,{default:a(()=>[l(b,{to:"/acc/accounting/view/"+o,class:"text-dark",title:"سند حسابداری"},{prepend:a(()=>[l(s,{color:"green-darken-4",icon:"mdi-file"})]),_:2},1032,["to"]),l(b,{to:"/acc/buy/view/"+o,class:"text-dark",title:"مشاهده"},{prepend:a(()=>[l(s,{color:"green-darken-4",icon:"mdi-eye"})]),_:2},1032,["to"]),l(b,{onClick:c=>d.openPrintModal(o),class:"text-dark",title:"خروجی PDF"},{prepend:a(()=>[l(s,{icon:"mdi-file-pdf-box"})]),_:2},1032,["onClick"]),l(b,{onClick:c=>d.canEditItem(o),class:"text-dark",title:"ویرایش"},{prepend:a(()=>[l(s,{icon:"mdi-file-edit"})]),_:2},1032,["onClick"]),l(b,{onClick:c=>d.deleteItem(o),class:"text-dark",title:"حذف"},{prepend:a(()=>[l(s,{color:"deep-orange-accent-4",icon:"mdi-trash-can"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),"item-label":a(({label:o})=>[o?(f(),y("span",Y,[o.code=="payed"?(f(),y("span",Z,r(o.label),1)):w("",!0),o.code=="returned"?(f(),y("span",ee,r(o.label),1)):w("",!0),o.code=="accepted"?(f(),y("span",te,r(o.label),1)):w("",!0)])):w("",!0)]),"item-des":a(({des:o})=>[m(r(o.replace("فاکتور خرید:","")),1)]),"item-relatedDocsCount":a(({relatedDocsCount:o,relatedDocsPays:c})=>[o!="0"?(f(),y("span",oe,[l(s,{small:""},{default:a(()=>e[17]||(e[17]=[m("mdi-currency-usd")])),_:1}),m(" "+r(t.$filters.formatNumber(c)),1)])):w("",!0)]),"item-amount":a(({amount:o})=>[h("span",le,r(t.$filters.formatNumber(o)),1)]),"item-transferCost":a(({transferCost:o})=>[h("span",ae,r(t.$filters.formatNumber(o)),1)]),"item-discountAll":a(({discountAll:o})=>[h("span",ie,r(t.$filters.formatNumber(o)),1)]),"item-person":a(({person:o})=>[l(B,{to:"/acc/persons/card/view/"+o.code},{default:a(()=>[m(r(o.nikename),1)]),_:2},1032,["to"])]),"item-code":a(({code:o})=>[l(B,{to:"/acc/buy/view/"+o},{default:a(()=>[m(r(o),1)]),_:2},1032,["to"])]),_:1},8,["items-selected","headers","items","loading"]),l(z,{modelValue:t.printModal,"onUpdate:modelValue":e[14]||(e[14]=o=>t.printModal=o),width:"auto"},{default:a(()=>[l(O,{subtitle:"برای تغییر تنظیمات پیشفرض به بخش تنظیمات چاپ مراجعه کنید","prepend-icon":"mdi-file-pdf-box",title:"خروجی PDF"},{text:a(()=>[l(L,{class:"mb-2",modelValue:t.printOptions.paper,"onUpdate:modelValue":e[6]||(e[6]=o=>t.printOptions.paper=o),items:t.paperSizes,label:"سایز کاغذ و حالت چاپ"},null,8,["modelValue","items"]),l(V,{inset:"",modelValue:t.printOptions.bidInfo,"onUpdate:modelValue":e[7]||(e[7]=o=>t.printOptions.bidInfo=o),color:"primary",label:"اطلاعات کسب‌وکار","hide-details":""},null,8,["modelValue"]),l(V,{inset:"",modelValue:t.printOptions.pays,"onUpdate:modelValue":e[8]||(e[8]=o=>t.printOptions.pays=o),color:"primary",label:"نمایش پرداخت‌های فاکتور","hide-details":""},null,8,["modelValue"]),l(V,{inset:"",modelValue:t.printOptions.note,"onUpdate:modelValue":e[9]||(e[9]=o=>t.printOptions.note=o),color:"primary",label:"یاداشت پایین فاکتور","hide-details":""},null,8,["modelValue"]),l(V,{inset:"",modelValue:t.printOptions.taxInfo,"onUpdate:modelValue":e[10]||(e[10]=o=>t.printOptions.taxInfo=o),color:"primary",label:"مالیات به تفکیک اقلام","hide-details":""},null,8,["modelValue"]),l(V,{inset:"",modelValue:t.printOptions.discountInfo,"onUpdate:modelValue":e[11]||(e[11]=o=>t.printOptions.discountInfo=o),color:"primary",label:"تخفیف به تفکیک اقلام","hide-details":""},null,8,["modelValue"])]),actions:a(()=>[l(v,{variant:"tonal","prepend-icon":"mdi-printer",color:"primary",text:"چاپ",onClick:e[12]||(e[12]=o=>{t.printModal=!1,d.printInvoice()})}),l(v,{variant:"tonal","prepend-icon":"mdi-undo",color:"secondary",text:"لغو",onClick:e[13]||(e[13]=o=>t.printModal=!1)})]),_:1})]),_:1},8,["modelValue"]),l(O,{class:"mt-3",elevation:"1"},{default:a(()=>[l(R,null,{default:a(()=>[l(F,null,{default:a(()=>[l(A,{cols:"12",md:"6"},{default:a(()=>[h("span",ne,[l(s,{left:""},{default:a(()=>e[18]||(e[18]=[m("mdi-format-list-bulleted")])),_:1}),e[19]||(e[19]=m(" مبلغ کل: "))]),h("span",se,r(t.$filters.formatNumber(t.sumTotal))+" "+r(t.$filters.getActiveMoney().shortName),1)]),_:1}),l(A,{cols:"12",md:"6"},{default:a(()=>[h("span",re,[l(s,{left:""},{default:a(()=>e[20]||(e[20]=[m("mdi-check-all")])),_:1}),e[21]||(e[21]=m(" جمع مبلغ موارد انتخابی: "))]),h("span",de,r(t.$filters.formatNumber(t.sumSelected))+" "+r(t.$filters.getActiveMoney().shortName),1)]),_:1})]),_:1})]),_:1})]),_:1})])}const me=j(J,[["render",ce]]);export{me as default};
