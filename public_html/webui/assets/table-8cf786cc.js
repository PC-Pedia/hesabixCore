import{r as f,a as v,o as V,s as H,b as o,w as l,F as S,d as i,c as P,A as E,aa as W,_ as D,al as y,e as w,t as j}from"./vendor-adef9cb4.js";import{T as q}from"./style-964d1d14.js";import{_ as z,L as G,a as N}from"./main-9b36f05f.js";const J={name:"Table",components:{Tree:q,Loading:G},setup(){const M=f(!0),e=f(!1),C=f(!0),a=f({}),I=f({roots:[],opened:!0,openedIcon:{type:"shape",stroke:"black",strokeWidth:3,viewBox:"0 0 24 24",draw:"M 2 12 L 22 12"},closedIcon:{type:"shape",stroke:"black",strokeWidth:3,viewBox:"0 0 24 24",draw:"M 12 2 L 12 22 M 2 12 L 22 12"}}),T=f(!1),r=f(!1),m=f(!1),p=f(!1),L=f(""),A=f(""),b=f(""),g=f(""),d=f(null),_=async()=>{try{const n=await N.post("/api/plugin/get/actives");C.value=!!n.data.accpro}catch(n){console.error("خطا در بررسی پلاگین‌ها:",n),C.value=!1}},U=async()=>{var n;try{const c=await N.post("/api/accounting/table/get");a.value=c.data,I.value.roots=((n=a.value[1])==null?void 0:n.children)||[],a.value[1]||console.warn("ردیف حساب ریشه '1' پیدا نشد!")}catch(c){console.error("خطا در دریافت داده‌ها:",c)}finally{M.value=!1}},u=(n,c)=>{L.value=n,A.value=c,p.value=!0},k=n=>{d.value=n,b.value="",T.value=!0},x=async()=>{if(b.value.trim()){e.value=!0;try{const n=await N.post("/api/accounting/table/add",{text:b.value,parentId:d.value.id});if(n.data.result===1){const c=n.data.node;a.value[c.id]=c,a.value[d.value.id].children||(a.value[d.value.id].children=[]),a.value[d.value.id].children.push(c.id),T.value=!1,u("موفقیت","ردیف حساب با موفقیت اضافه شد!")}else u("خطا",n.data.message||"خطا در افزودن ردیف حساب!")}catch(n){console.error("خطا در افزودن ردیف حساب:",n),u("خطا","خطا در افزودن ردیف حساب!")}finally{e.value=!1}}},F=n=>{d.value=n,g.value=n.text,r.value=!0},t=async()=>{if(g.value.trim()){e.value=!0;try{const n=await N.post("/api/accounting/table/edit",{id:d.value.id,text:g.value});n.data.result===1?(a.value[d.value.id]={...a.value[d.value.id],...n.data.node},r.value=!1,u("موفقیت","ردیف حساب با موفقیت ویرایش شد!")):u("خطا",n.data.message||"خطا در ویرایش ردیف حساب!")}catch(n){console.error("خطا در ویرایش ردیف حساب:",n),u("خطا","خطا در ویرایش ردیف حساب!")}finally{e.value=!1}}},s=n=>{d.value=n,m.value=!0},B=async()=>{e.value=!0;try{const n=await N.post("/api/accounting/table/delete",{id:d.value.id});n.data.result===1?(delete a.value[d.value.id],Object.values(a.value).forEach(c=>{c.children&&(c.children=c.children.filter(O=>O!==d.value.id))}),m.value=!1,u("موفقیت","ردیف حساب با موفقیت حذف شد!")):u("خطا",n.data.message||"خطا در حذف ردیف حساب!")}catch(n){console.error("خطا در حذف ردیف حساب:",n),u("خطا","خطا در حذف ردیف حساب!")}finally{e.value=!1}};return _(),U(),{isLoading:M,dialogLoading:e,isAccproActive:C,tree:a,config:I,addDialog:T,editDialog:r,deleteDialog:m,messageDialog:p,messageTitle:L,messageText:A,newNodeText:b,editNodeText:g,selectedNode:d,openAddDialog:k,addNode:x,openEditDialog:F,saveEditNode:t,openDeleteDialog:s,confirmDeleteNode:B}}},K={key:0,class:"node-actions"};function Q(M,e,C,a,I,T){const r=v("v-icon"),m=v("v-toolbar-title"),p=v("v-toolbar"),L=v("v-alert"),A=v("loading"),b=v("Tree"),g=v("v-spacer"),d=v("v-btn"),_=v("v-tooltip"),U=v("v-text-field"),u=v("v-card-text"),k=v("v-card"),x=v("v-dialog"),F=v("v-container");return V(),H(S,null,[o(p,{flat:""},{default:l(()=>[o(m,null,{default:l(()=>[o(r,{class:"mx-2"},{default:l(()=>e[11]||(e[11]=[i("mdi-table")])),_:1}),e[12]||(e[12]=i(" جدول حساب‌ها "))]),_:1})]),_:1}),o(F,{fluid:""},{default:l(()=>[a.isAccproActive?E("",!0):(V(),P(L,{key:0,type:"warning",dense:"",outlined:"",class:"mt-3"},{default:l(()=>e[13]||(e[13]=[i(' برای افزودن، ویرایش یا حذف ردیف‌های حساب، لطفاً افزونه "حسابداری پیشرفته" را از بخش بازار تهیه کنید. ')])),_:1})),o(A,{color:"blue",loader:"dots",active:a.isLoading,"onUpdate:active":e[0]||(e[0]=t=>a.isLoading=t),"is-full-page":!1,class:"text-center"},null,8,["active"]),o(b,{nodes:a.tree,config:a.config,class:"tree-view-style"},{"after-input":l(({node:t})=>[a.isAccproActive?(V(),H("div",K,[o(r,{small:"",color:"success",class:"mx-1",onClick:W(s=>a.openAddDialog(t),["stop"])},{default:l(()=>e[14]||(e[14]=[i(" mdi-plus ")])),_:2},1032,["onClick"]),t.is_public?E("",!0):(V(),P(r,{key:0,small:"",color:"primary",class:"mx-1",onClick:W(s=>a.openEditDialog(t),["stop"])},{default:l(()=>e[15]||(e[15]=[i(" mdi-pencil ")])),_:2},1032,["onClick"])),!t.is_public&&(!t.children||t.children.length===0)?(V(),P(r,{key:1,small:"",color:"error",class:"mx-1",onClick:W(s=>a.openDeleteDialog(t),["stop"])},{default:l(()=>e[16]||(e[16]=[i(" mdi-delete ")])),_:2},1032,["onClick"])):E("",!0)])):E("",!0)]),_:1},8,["nodes","config"]),o(x,{modelValue:a.addDialog,"onUpdate:modelValue":e[3]||(e[3]=t=>a.addDialog=t),"max-width":"400",persistent:""},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{flat:"",color:"success",dark:""},{default:l(()=>[o(m,null,{default:l(()=>e[17]||(e[17]=[i("اضافه کردن زیرمجموعه")])),_:1}),o(g),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:e[1]||(e[1]=B=>a.addDialog=!1)},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[18]||(e[18]=[i("mdi-close")])),_:1})]),_:2},1040)]),default:l(()=>[e[19]||(e[19]=w("span",null,"بستن",-1))]),_:1}),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:a.addNode,loading:a.dialogLoading,disabled:!a.newNodeText.trim()},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[20]||(e[20]=[i("mdi-check")])),_:1})]),_:2},1040,["onClick","loading","disabled"])]),default:l(()=>[e[21]||(e[21]=w("span",null,"ثبت",-1))]),_:1})]),_:1}),o(u,{class:"pt-4"},{default:l(()=>[o(U,{modelValue:a.newNodeText,"onUpdate:modelValue":e[2]||(e[2]=t=>a.newNodeText=t),label:"نام ردیف حساب جدید",rules:[t=>!!t.trim()||"این فیلد نمی‌تواند خالی باشد"],disabled:a.dialogLoading},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(x,{modelValue:a.editDialog,"onUpdate:modelValue":e[6]||(e[6]=t=>a.editDialog=t),"max-width":"400",persistent:""},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{flat:"",color:"primary",dark:""},{default:l(()=>[o(m,null,{default:l(()=>e[22]||(e[22]=[i("ویرایش ردیف حساب")])),_:1}),o(g),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:e[4]||(e[4]=B=>a.editDialog=!1)},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[23]||(e[23]=[i("mdi-close")])),_:1})]),_:2},1040)]),default:l(()=>[e[24]||(e[24]=w("span",null,"بستن",-1))]),_:1}),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:a.saveEditNode,loading:a.dialogLoading,disabled:!a.editNodeText.trim()},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[25]||(e[25]=[i("mdi-check")])),_:1})]),_:2},1040,["onClick","loading","disabled"])]),default:l(()=>[e[26]||(e[26]=w("span",null,"ذخیره",-1))]),_:1})]),_:1}),o(u,{class:"pt-4"},{default:l(()=>[o(U,{modelValue:a.editNodeText,"onUpdate:modelValue":e[5]||(e[5]=t=>a.editNodeText=t),label:"نام ردیف حساب",rules:[t=>!!t.trim()||"این فیلد نمی‌تواند خالی باشد"],disabled:a.dialogLoading},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(x,{modelValue:a.deleteDialog,"onUpdate:modelValue":e[8]||(e[8]=t=>a.deleteDialog=t),"max-width":"400",persistent:""},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{flat:"",color:"error",dark:""},{default:l(()=>[o(m,null,{default:l(()=>e[27]||(e[27]=[i("حذف ردیف حساب")])),_:1}),o(g),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:e[7]||(e[7]=B=>a.deleteDialog=!1)},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[28]||(e[28]=[i("mdi-close")])),_:1})]),_:2},1040)]),default:l(()=>[e[29]||(e[29]=w("span",null,"بستن",-1))]),_:1}),o(_,{bottom:""},{activator:l(({on:t,attrs:s})=>[o(d,D({icon:"",onClick:a.confirmDeleteNode,loading:a.dialogLoading},s,y(t)),{default:l(()=>[o(r,null,{default:l(()=>e[30]||(e[30]=[i("mdi-check")])),_:1})]),_:2},1040,["onClick","loading"])]),default:l(()=>[e[31]||(e[31]=w("span",null,"تأیید حذف",-1))]),_:1})]),_:1}),o(u,{class:"pt-4"},{default:l(()=>{var t;return[i(' آیا مطمئنی که می‌خوای ردیف حساب "'+j((t=a.selectedNode)==null?void 0:t.text)+'" رو حذف کنی؟ ',1)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),o(x,{modelValue:a.messageDialog,"onUpdate:modelValue":e[10]||(e[10]=t=>a.messageDialog=t),"max-width":"400"},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{flat:"",color:a.messageTitle==="موفقیت"?"success":"error",dark:""},{default:l(()=>[o(m,null,{default:l(()=>[i(j(a.messageTitle),1)]),_:1}),o(g),o(d,{icon:"",onClick:e[9]||(e[9]=t=>a.messageDialog=!1)},{default:l(()=>[o(r,null,{default:l(()=>e[32]||(e[32]=[i("mdi-close")])),_:1})]),_:1})]),_:1},8,["color"]),o(u,{class:"pt-4"},{default:l(()=>[i(j(a.messageText),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64)}const Z=z(J,[["render",Q],["__scopeId","data-v-3105b351"]]);export{Z as default};
