import{a as h,_ as U}from"./main-9b36f05f.js";import{a as s,o as m,s as v,b as o,w as l,A as w,F as E,d as g,t as C,aa as L,c as N,e as T}from"./vendor-adef9cb4.js";h.defaults.withCredentials=!0;const M={name:"login",data(){const a=this;return{loading:!1,captchaLoading:!1,dialog:!1,showCaptcha:!1,errorMsg:a.$t("login.input_fail"),captchaImage:"",user:{mobile:"",password:"",captcha:"",standard:!0},rules:{mobile:[e=>a.validate(e,"mobile")],password:[e=>a.validate(e,"password")],captcha:[e=>!!e||a.$t("captcha.required")]}}},methods:{validate(a,e){if(e==="mobile"){const i=this.convertPersianToEnglish(a.replace(/\s/g,""));return/^09\d{9}$/.test(i)?!0:this.$t("validator.mobile_not_valid")}else if(e==="password")return a?a.length>5?!0:this.$t("validator.password_len_lower"):!1},convertPersianToEnglish(a){const e=["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"],i=["0","1","2","3","4","5","6","7","8","9"];return a.split("").map(n=>{const t=e.indexOf(n);return t!==-1?i[t]:n}).join("")},async loadCaptcha(){this.captchaLoading=!0;try{const a=await h.get("/api/captcha/image",{responseType:"blob",withCredentials:!0}),e=URL.createObjectURL(a.data);this.captchaImage=e}catch{this.errorMsg="خطا در بارگذاری کپچا",this.dialog=!0}finally{this.captchaLoading=!1}},async submit(){var e;const{valid:a}=await this.$refs.form.validate();if(a){this.loading=!0;const i={mobile:this.convertPersianToEnglish(this.user.mobile.replace(/\s/g,"")),password:this.user.password,standard:this.user.standard};this.showCaptcha&&(i.captcha_answer=this.user.captcha.toString());try{const n=await h.post("/api/user/login",i,{withCredentials:!0});n.data.Success===!0&&(localStorage.setItem("X-AUTH-TOKEN",n.data.data.token),this.$router.push("/profile/business"))}catch(n){const t=((e=n.response)==null?void 0:e.data)||{};this.errorMsg=t.error||this.$t("login.input_fail"),this.dialog=!0,t.captcha_required?(this.showCaptcha=!0,await this.loadCaptcha()):this.showCaptcha=!1}finally{this.loading=!1}}},goto_pwa_page(){this.loading=!0,window.location.href="./install-pwa"}},mounted(){}};const j={class:"d-flex justify-center pb-5"},S={key:0,class:"text-center"};function A(a,e,i,n,t,d){const f=s("v-card-text"),u=s("v-text-field"),y=s("v-img"),c=s("v-col"),_=s("v-row"),p=s("v-btn"),x=s("v-form"),b=s("v-card"),V=s("v-container"),k=s("v-spacer"),I=s("v-dialog");return m(),v(E,null,[o(V,null,{default:l(()=>[o(_,{class:"d-flex justify-center"},{default:l(()=>[o(c,{md:"5"},{default:l(()=>[o(b,{loading:t.loading?"blue":void 0,disabled:t.loading,title:a.$t("app.name"),subtitle:a.$t("user.login_label")},{default:l(()=>[o(f,{class:"text-justify"},{default:l(()=>[g(C(a.$t("login.des")),1)]),_:1}),o(x,{disabled:t.loading,ref:"form","fast-fail":"",onSubmit:e[3]||(e[3]=L(r=>d.submit(),["prevent"]))},{default:l(()=>[o(f,null,{default:l(()=>[o(u,{class:"mb-2",label:a.$t("user.mobile"),placeholder:a.$t("user.mobile_placeholder"),"single-line":"",modelValue:t.user.mobile,"onUpdate:modelValue":e[0]||(e[0]=r=>t.user.mobile=r),type:"tel",variant:"outlined","prepend-inner-icon":"mdi-phone",rules:t.rules.mobile,autocomplete:"tel",name:"mobile"},null,8,["label","placeholder","modelValue","rules"]),o(u,{class:"mb-2",label:a.$t("user.password"),placeholder:a.$t("user.password_placeholder"),"single-line":"",type:"password",variant:"outlined","prepend-inner-icon":"mdi-lock",rules:t.rules.password,modelValue:t.user.password,"onUpdate:modelValue":e[1]||(e[1]=r=>t.user.password=r),autocomplete:"current-password",name:"password"},null,8,["label","placeholder","rules","modelValue"]),t.showCaptcha?(m(),N(_,{key:0,class:"mb-2",dense:""},{default:l(()=>[o(c,{cols:"12",sm:"6"},{default:l(()=>[o(y,{src:t.captchaImage,"max-height":"50","max-width":"150",class:"captcha-img",contain:""},null,8,["src"])]),_:1}),o(c,{cols:"12",sm:"6"},{default:l(()=>[o(u,{dense:"",label:a.$t("captcha.enter_code"),placeholder:"کپچا",modelValue:t.user.captcha,"onUpdate:modelValue":e[2]||(e[2]=r=>t.user.captcha=r),modelModifiers:{number:!0},variant:"outlined",type:"number",rules:t.rules.captcha,required:"","hide-details":"","prepend-inner-icon":"mdi-refresh","onClick:prependInner":d.loadCaptcha,loading:t.captchaLoading,autocomplete:"off",name:"captcha"},null,8,["label","modelValue","rules","onClick:prependInner","loading"])]),_:1})]),_:1})):w("",!0),o(p,{disabled:t.loading,loading:t.loading,block:"",type:"submit",class:"text-none mb-4",color:"indigo-darken-3",size:"x-large",variant:"flat","prepend-icon":"mdi-login"},{default:l(()=>[g(C(a.$t("user.login")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["disabled"]),T("div",j,[o(p,{loading:t.loading,class:"text-none",color:"primary",variant:"tonal",flat:"",onClick:e[4]||(e[4]=r=>d.goto_pwa_page())},{default:l(()=>e[7]||(e[7]=[g("نصب وب اپلیکیشن")])),_:1},8,["loading"])])]),_:1},8,["loading","disabled","title","subtitle"])]),_:1})]),_:1})]),_:1}),t.dialog?(m(),v("div",S,[o(I,{modelValue:t.dialog,"onUpdate:modelValue":e[6]||(e[6]=r=>t.dialog=r),"max-width":"500",persistent:""},{default:l(()=>[o(b,{color:"dangerLight","prepend-icon":"mdi-close-octagon",title:a.$t("dialog.error"),text:t.errorMsg},{actions:l(()=>[o(k),o(p,{color:"primary",text:a.$t("dialog.ok"),variant:"flat",onClick:e[5]||(e[5]=r=>{t.dialog=!1,t.user.password="",t.user.captcha=""})},null,8,["text"])]),_:1},8,["title","text"])]),_:1},8,["modelValue"])])):w("",!0)],64)}const D=U(M,[["render",A],["__scopeId","data-v-a29f1d4a"]]);export{D as default};
