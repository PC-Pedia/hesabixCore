import{at as ve,r as p,H as fe,O as K,n as D,j as _e,a as r,o as S,c as R,w as l,b as t,_ as g,d as c,t as f,s as Q,C as X,F as Y,e as b}from"./vendor-adef9cb4.js";import{_ as ge,a as x,S as k,c as be}from"./main-9b36f05f.js";const ye={class:"text-left"},xe={class:"text-left"},ke={class:"d-flex align-center"},$e={class:"ms-2"},Ce={class:"d-flex align-center"},we={class:"ms-2"},Ve={__name:"list",setup(Se){ve();const T=p(!1),B=p(""),y=p(1),$=p(10),C=p(0),u=p([]),P=p("all"),U=p(!1),w=p(!1),d=p([]),M=p(0),F=p(0),h=fe([{title:"",key:"select",sortable:!1,visible:!0,customizable:!1},{title:"عملیات",key:"operation",sortable:!1,visible:!0},{title:"کد",key:"code",visible:!0},{title:"اشخاص",key:"persons",sortable:!0,visible:!0},{title:"تاریخ",key:"date",visible:!0},{title:"شرح",key:"des",visible:!0},{title:"مبلغ",key:"amount",visible:!0}]),Z=K(()=>h.filter(o=>o.customizable!==!1&&o.key!=="operation")),ee=K(()=>h.filter(o=>o.customizable===!1||o.visible)),te=[{title:"همه",value:"all"},{title:"امروز",value:"today"},{title:"این هفته",value:"thisWeek"},{title:"این ماه",value:"thisMonth"}],V=async(o=null)=>{if(!T.value){T.value=!0;try{const e={page:(o==null?void 0:o.page)||y.value,itemsPerPage:(o==null?void 0:o.itemsPerPage)||$.value,search:B.value,dateFilter:P.value};console.log("Request Params:",e);const n=await x.post("/api/person/receive/list/search",e);console.log("Server Response:",n.data),n.data&&(Array.isArray(n.data)?(u.value=n.data,C.value=n.data.length):n.data.items&&Array.isArray(n.data.items)&&(u.value=n.data.items,C.value=n.data.total||n.data.items.length),u.value=u.value.map(s=>({...s,code:parseInt(s.code),amount:parseFloat(s.amount)})),console.log("Processed Items:",u.value),console.log("Total Items:",C.value),M.value=u.value.reduce((s,m)=>s+parseFloat(m.amount),0))}catch(e){console.error("Error loading data:",e),u.value=[],C.value=0}finally{T.value=!1}}},le=async o=>{if((await k.fire({text:"آیا برای این سند مطمئن هستید؟",showCancelButton:!0,confirmButtonText:"بله",cancelButtonText:"خیر"})).isConfirmed)try{(await x.post("/api/accounting/remove",{code:o})).data.result===1&&(u.value=u.value.filter(s=>s.code!==o),k.fire({text:"سند با موفقیت حذف شد.",icon:"success",confirmButtonText:"قبول"}))}catch(n){console.error("Error deleting item:",n)}},oe=o=>d.value.some(e=>e.code===o),ae=o=>{const e=d.value.findIndex(n=>n.code===o.code);e===-1?d.value.push(o):d.value.splice(e,1),w.value=u.value.length>0&&d.value.length===u.value.length,H()},ne=()=>{w.value?d.value=[...u.value]:d.value=[],H()},H=()=>{d.value.length>0?F.value=d.value.reduce((o,e)=>o+parseFloat(e.amount),0):F.value=0},L=async(o=!0)=>{if(!o&&d.value.length===0){k.fire({text:"هیچ آیتمی انتخاب نشده است.",icon:"info",confirmButtonText:"قبول"});return}try{let e;o?e=await x.post("/api/person/receive/list/print"):e=await x.post("/api/person/receive/list/print",{items:d.value});const n=e.data.id;window.open(`${be()}/front/print/${n}`,"_blank","noreferrer")}catch(e){console.error("Error printing:",e),k.fire({text:"خطا در تولید PDF",icon:"error",confirmButtonText:"قبول"})}},j=async(o=!0)=>{if(!o&&d.value.length===0){k.fire({text:"هیچ آیتمی انتخاب نشده است.",icon:"info",confirmButtonText:"قبول"});return}try{let e;o?e=await x({method:"post",url:"/api/person/receive/list/excel",responseType:"arraybuffer"}):e=await x({method:"post",url:"/api/person/receive/list/excel",responseType:"arraybuffer",data:{items:d.value}});const n=new Blob([e.data]),s=window.URL.createObjectURL(n),m=document.createElement("a");m.href=s,m.setAttribute("download","persons-receive-list.xlsx"),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(e){console.error("Error generating excel:",e),k.fire({text:"خطا در تولید فایل Excel",icon:"error",confirmButtonText:"قبول"})}},se=()=>{localStorage.setItem("receiveTableColumns",JSON.stringify(h))},re=()=>{const o=localStorage.getItem("receiveTableColumns");o&&JSON.parse(o).forEach(n=>{const s=h.find(m=>m.key===n.key);s&&(s.visible=n.visible)})};return D([B,y,$,P],()=>{V()}),D(y,()=>{d.value=[],w.value=!1}),D([y,$],()=>{V()},{deep:!0}),_e(()=>{re(),V()}),(o,e)=>{const n=r("v-btn"),s=r("v-tooltip"),m=r("v-spacer"),i=r("v-icon"),I=r("v-list-subheader"),_=r("v-list-item"),N=r("v-list"),A=r("v-menu"),J=r("v-toolbar"),ie=r("v-select"),de=r("v-text-field"),E=r("v-checkbox"),z=r("v-list-item-title"),ue=r("router-link"),ce=r("v-data-table-server"),O=r("v-col"),q=r("v-row"),W=r("v-card-text"),G=r("v-card"),me=r("v-dialog"),pe=r("v-container");return S(),R(pe,{fluid:"",class:"pa-0"},{default:l(()=>[t(J,{color:"toolbar",title:"دریافت‌ها"},{prepend:l(()=>[t(s,{text:o.$t("dialog.back"),location:"bottom"},{activator:l(({props:a})=>[t(n,g(a,{onClick:e[0]||(e[0]=v=>o.$router.back()),class:"d-none d-sm-flex",variant:"text",icon:"mdi-arrow-right"}),null,16)]),_:1},8,["text"])]),default:l(()=>[t(m),t(s,{text:o.$t("dialog.add_new"),location:"bottom"},{activator:l(({props:a})=>[t(n,g(a,{icon:"mdi-plus",color:"primary",to:"/acc/persons/receive/mod/"}),null,16)]),_:1},8,["text"]),t(A,null,{activator:l(({props:a})=>[t(n,g(a,{icon:"",color:"error"}),{default:l(()=>[t(i,null,{default:l(()=>e[13]||(e[13]=[c("mdi-file-pdf-box")])),_:1}),t(s,{activator:"parent",text:o.$t("dialog.export_pdf"),location:"bottom"},null,8,["text"])]),_:2},1040)]),default:l(()=>[t(N,null,{default:l(()=>[t(I,{color:"primary"},{default:l(()=>[c(f(o.$t("dialog.export_pdf")),1)]),_:1}),t(_,{class:"text-dark",title:o.$t("dialog.selected"),onClick:e[1]||(e[1]=a=>L(!1))},{prepend:l(()=>[t(i,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["title"]),t(_,{class:"text-dark",title:o.$t("dialog.selected_all"),onClick:e[2]||(e[2]=a=>L(!0))},{prepend:l(()=>[t(i,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1}),t(A,null,{activator:l(({props:a})=>[t(n,g(a,{icon:"",color:"success"}),{default:l(()=>[t(i,null,{default:l(()=>e[14]||(e[14]=[c("mdi-file-excel-box")])),_:1}),t(s,{activator:"parent",text:o.$t("dialog.export_excel"),location:"bottom"},null,8,["text"])]),_:2},1040)]),default:l(()=>[t(N,null,{default:l(()=>[t(I,{color:"primary"},{default:l(()=>[c(f(o.$t("dialog.export_excel")),1)]),_:1}),t(_,{class:"text-dark",title:o.$t("dialog.selected"),onClick:e[3]||(e[3]=a=>j(!1))},{prepend:l(()=>[t(i,{color:"green-darken-4",icon:"mdi-check"})]),_:1},8,["title"]),t(_,{class:"text-dark",title:o.$t("dialog.selected_all"),onClick:e[4]||(e[4]=a=>j(!0))},{prepend:l(()=>[t(i,{color:"indigo-darken-4",icon:"mdi-expand-all"})]),_:1},8,["title"])]),_:1})]),_:1}),t(s,{text:"انتخاب ستون‌ها",location:"bottom"},{activator:l(({props:a})=>[t(n,g(a,{icon:"mdi-table-cog",color:"primary",onClick:e[5]||(e[5]=v=>U.value=!0)}),null,16)]),_:1})]),_:1}),t(de,{"hide-details":"",color:"green",class:"pt-0 rounded-0 mb-0",density:"compact",placeholder:o.$t("dialog.search_txt"),modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=a=>B.value=a),type:"text",clearable:""},{"prepend-inner":l(()=>[t(s,{location:"bottom",text:o.$t("dialog.search")},{activator:l(({props:a})=>[t(i,g(a,{color:"danger",icon:"mdi-magnify"}),null,16)]),_:1},8,["text"])]),"append-inner":l(()=>[t(A,{"close-on-content-click":!1},{activator:l(({props:a})=>[t(i,g({size:"sm"},a,{icon:"",color:"primary"}),{default:l(()=>[t(s,{activator:"parent",variant:"plain",text:o.$t("dialog.filters"),location:"bottom"},null,8,["text"]),t(i,{icon:"mdi-filter"})]),_:2},1040)]),default:l(()=>[t(N,null,{default:l(()=>[t(I,{color:"primary"},{default:l(()=>[t(i,{icon:"mdi-filter"}),c(" "+f(o.$t("dialog.filters")),1)]),_:1}),t(_,null,{default:l(()=>[t(ie,{class:"py-2 my-2",modelValue:P.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>P.value=a),V],items:te,label:"فیلتر تاریخ",dense:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["placeholder","modelValue"]),t(ce,{"items-per-page":$.value,"onUpdate:itemsPerPage":e[9]||(e[9]=a=>$.value=a),page:y.value,"onUpdate:page":e[10]||(e[10]=a=>y.value=a),headers:ee.value,items:u.value,"items-length":C.value,loading:T.value,"item-value":"code",class:"elevation-1","items-per-page-options":[5,10,20,50],"items-per-page-text":"تعداد سطر در هر صفحه","onUpdate:options":V},{"header.select":l(()=>[t(E,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=a=>w.value=a),onChange:ne,"hide-details":"",density:"compact"},null,8,["modelValue"])]),"item.select":l(({item:a})=>[t(E,{"model-value":oe(a.code),onChange:v=>ae(a),"hide-details":"",density:"compact"},null,8,["model-value","onChange"])]),"item.operation":l(({item:a})=>[t(A,null,{activator:l(({props:v})=>[t(n,g({variant:"text",size:"small",icon:"mdi-menu"},v),null,16)]),default:l(()=>[t(N,null,{default:l(()=>[t(_,{to:"/acc/accounting/view/"+a.code},{prepend:l(()=>[t(i,{color:"green-darken-4",icon:"mdi-eye"})]),default:l(()=>[t(z,null,{default:l(()=>e[15]||(e[15]=[c("سند حسابداری")])),_:1})]),_:2},1032,["to"]),t(_,{to:{name:"person_receive_mod",params:{id:a.code}}},{prepend:l(()=>[t(i,{icon:"mdi-pencil"})]),default:l(()=>[t(z,null,{default:l(()=>e[16]||(e[16]=[c("ویرایش")])),_:1})]),_:2},1032,["to"]),t(_,{onClick:v=>le(a.code)},{prepend:l(()=>[t(i,{color:"error",icon:"mdi-delete"})]),default:l(()=>[t(z,{class:"text-error"},{default:l(()=>e[17]||(e[17]=[c("حذف")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),"item.persons":l(({item:a})=>[(S(!0),Q(Y,null,X(a.persons,v=>(S(),R(ue,{key:v.code,class:"me-2",to:"/acc/persons/card/view/"+v.code},{default:l(()=>[c(f(v.nikename),1)]),_:2},1032,["to"]))),128))]),"item.code":l(({item:a})=>[b("span",ye,f(o.$filters.formatNumber(a.code)),1)]),"item.amount":l(({item:a})=>[b("span",xe,f(o.$filters.formatNumber(a.amount)),1)]),_:1},8,["items-per-page","page","headers","items","items-length","loading"]),t(G,{variant:"",class:"my-4"},{default:l(()=>[t(W,null,{default:l(()=>[t(q,null,{default:l(()=>[t(O,{cols:"12",sm:"6"},{default:l(()=>[b("div",ke,[t(i,{class:"me-2"},{default:l(()=>e[18]||(e[18]=[c("mdi-format-list-bulleted")])),_:1}),e[19]||(e[19]=b("span",null,"مبلغ کل صفحه:",-1)),b("span",$e,f(o.$filters.formatNumber(M.value))+" "+f(o.$filters.getActiveMoney().shortName),1)])]),_:1}),t(O,{cols:"12",sm:"6"},{default:l(()=>[b("div",Ce,[t(i,{class:"me-2"},{default:l(()=>e[20]||(e[20]=[c("mdi-format-list-checks")])),_:1}),e[21]||(e[21]=b("span",null,"جمع مبلغ موارد انتخابی:",-1)),b("span",we,f(o.$filters.formatNumber(F.value))+" "+f(o.$filters.getActiveMoney().shortName),1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(me,{modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=a=>U.value=a),"max-width":"400px"},{default:l(()=>[t(G,null,{default:l(()=>[t(J,{color:"toolbar",title:"انتخاب ستون‌‌ها",density:"compact"},{default:l(()=>[t(m),t(n,{variant:"text",onClick:e[11]||(e[11]=a=>U.value=!1),type:"icon"},{default:l(()=>[t(i,null,{default:l(()=>e[22]||(e[22]=[c("mdi-close")])),_:1}),t(s,{activator:"parent",location:"bottom"},{default:l(()=>e[23]||(e[23]=[c("بستن")])),_:1})]),_:1})]),_:1}),t(W,{class:"pt-4"},{default:l(()=>[t(q,{dense:""},{default:l(()=>[(S(!0),Q(Y,null,X(Z.value,a=>(S(),R(O,{cols:"12",key:a.key},{default:l(()=>[t(E,{modelValue:a.visible,"onUpdate:modelValue":[v=>a.visible=v,se],label:a.title,"hide-details":"",density:"comfortable"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Pe=ge(Ve,[["__scopeId","data-v-67de630a"]]);export{Pe as default};
