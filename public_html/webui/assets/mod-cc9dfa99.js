import{_ as P,L as $,a as b,S as h}from"./main-9b36f05f.js";import"./vue-persian-datetime-picker.common-0e5ba5b7.js";import{q as N}from"./quickAdd-3f821e67.js";import{m as j}from"./mostdes-26bfade0.js";import{a as f,o as u,s as m,e as o,d as n,b as r,u as v,ab as k,F as C,C as V,t as p,w as _,A as I,_ as w}from"./vendor-adef9cb4.js";const Y={name:"mod",components:{Loading:$,quickAdd:N,mostdes:j},data:()=>({desSubmit:{id:"",des:""},isLoading:!1,canSubmit:!1,updateID:null,sum:0,balance:0,listPersons:[],listBanks:[],listCashdesks:[],listSalarys:[],persons:[],banks:[],salarys:[],cashdesks:[],year:"",currencyConfig:{masked:!1,prefix:"",suffix:"ریال",thousands:",",decimal:".",precision:0,disableNegative:!1,disabled:!1,min:0,max:null,allowBlank:!1,minimumNumberOfCharacters:0,shouldRound:!0,focusOnRight:!0},data:{date:"",des:""}}),watch:{"desSubmit.id":function(){this.data.des=this.desSubmit.des}},mounted(){this.loadData()},beforeRouteUpdate(t,s){this.loadData(t.params.id)},methods:{searchPerson(t,s){s(!0),b.post("/api/person/list/search",{search:t}).then(i=>{this.listPersons=i.data,s(!1)})},calc(){this.sum=0,this.persons.forEach(s=>{this.sum=parseInt(this.sum)+parseInt(s.amount)});let t=0;this.banks.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.salarys.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.cashdesks.forEach(s=>{t=parseInt(t)+parseInt(s.amount)}),this.balance=parseInt(this.sum)-parseInt(t),this.funcCanSubmit()},funcCanSubmit(){parseInt(this.balance)==0&&this.sum>0?this.canSubmit=!0:this.canSubmit=!1},addPerson(){this.persons.push({id:"",amount:"",des:""})},removePerson(t){this.persons.splice(t,1)},addBank(){this.banks.push({person:"",amount:"",des:""})},removeBank(t){this.banks.splice(t,1)},addCashdesk(){this.cashdesks.push({person:"",amount:"",des:""})},removeCashdesk(t){this.cashdesks.splice(t,1)},addSalary(){this.salarys.push({person:"",amount:"",des:""})},removeSalary(t){this.salarys.splice(t,1)},loadData(){this.$route.params.id?(this.updateID=this.$route.params.id,b.post("/api/accounting/doc/get",{code:this.updateID}).then(t=>{this.data.des=t.data.doc.des,this.data.date=t.data.doc.date,t.data.rows.forEach(s=>{s.type=="person"?this.persons.push({id:s.person,amount:s.bs,des:s.des}):s.type=="bank"?this.banks.push({id:s.bank,amount:s.bd,des:s.des}):s.type=="cashdesk"?this.cashdesks.push({id:s.cashdesk,amount:s.bd,des:s.des}):s.type=="salary"&&this.salarys.push({id:s.salary,amount:s.bd,des:s.des})})})):(this.addBank(),this.addPerson(),b.post("/api/year/get").then(t=>{this.year=t.data,this.data.date=t.data.now})),b.post("/api/person/list/search").then(t=>{this.listPersons=t.data}),b.post("/api/bank/list").then(t=>{this.listBanks=t.data}),b.post("/api/cashdesk/list").then(t=>{this.listCashdesks=t.data}),b.post("/api/salary/list").then(t=>{this.listSalarys=t.data})},save(){this.persons.length==0&&h.fire({text:"انتخاب حداقل یک فرد الزامی است.",icon:"error",confirmButtonText:"قبول"});let t=!0;this.banks.forEach(i=>{(i.id==null||i.id=="")&&(t=!1)}),this.salarys.forEach(i=>{(i.id==null||i.id=="")&&(t=!1)}),this.cashdesks.forEach(i=>{(i.id==null||i.id=="")&&(t=!1)}),t==!1&&h.fire({text:"یکی از طرف‌های حساب انتخاب نشده است.",icon:"error",confirmButtonText:"قبول"});let s=!0;if(this.persons.forEach(i=>{(i.id==null||i.id=="")&&(s=!1)}),s==!1&&h.fire({text:"یکی از اشخاص انتخاب نشده است.",icon:"error",confirmButtonText:"قبول"}),s&&t){let i=[];this.data.des==""&&(this.data.des="دریافت از اشخاص:"),this.persons.forEach(a=>{a.des==""&&(a.des="دریافت از اشخاص"),i.push({id:a.id.id,bs:parseInt(a.amount),bd:0,des:a.des,type:"person",table:3})}),this.banks.forEach(a=>{a.des==""&&(a.des="دریافت از اشخاص"),i.push({id:a.id.id,bs:0,bd:parseInt(a.amount),des:a.des,type:"bank",table:9})}),this.salarys.forEach(a=>{a.des==""&&(a.des="دریافت از اشخاص"),i.push({id:a.id.id,bs:0,bd:parseInt(a.amount),des:a.des,type:"salary",table:122})}),this.cashdesks.forEach(a=>{a.des==""&&(a.des="دریافت از اشخاص"),i.push({id:a.id.id,bs:0,bd:parseInt(a.amount),des:a.des,type:"cashdesk",table:121})}),b.post("/api/accounting/insert",{update:this.updateID,date:this.data.date,type:"person_receive",des:this.data.des,rows:i}).then(a=>{a.data.result==1?h.fire({text:"سند ثبت شد.",icon:"success",confirmButtonText:"قبول"}).then(U=>{U.isConfirmed&&this.$router.push("/acc/persons/receive/list")}):a.data.result==4&&h.fire({text:a.data.msg,icon:"error",confirmButtonText:"قبول"})})}}}},T={class:"block block-content-full"},L={id:"fixed-header",class:"block-header block-header-default bg-gray-light pt-2 pb-1"},M={class:"block-title text-primary-dark"},q={class:"block-options"},A=["disabled"],R={class:"block-content py-3 px-0 vl-parent"},F={class:"container"},K={class:"row"},z={class:"col-sm-12 col-md-6 mb-2"},G={class:"col-sm-12 col-md-12"},H={class:"block block-rounded border"},J={class:"block-header block-header-default py-1"},Q={class:"block-options"},W={class:"block-content p-0"},X={class:"row"},Z={class:"col-sm-12 col-md-6 px-1"},ss={class:"block block-rounded border border-gray"},os={class:"block-header bg-default-dark"},ts={class:"block-title"},es={class:"text-white"},ls={class:"text-danger mx-2"},as={class:"block-options"},ds=["onClick"],ns={class:"block-content-sm mx-2"},is={class:"row"},rs={class:"col-sm-12 col-md-12"},cs={class:"row"},us={class:"col-sm-12 col-md-12"},ms={class:"row mb-1"},ps={class:"col-12"},bs={class:"col-12"},fs={class:"row"},hs={class:"col-6"},vs={class:"col-6"},ks={key:0,class:"text-danger"},_s={key:1,class:"text-success"},ys={class:"col-sm-12 col-md-12"},gs={class:"row"},Cs={class:"col-sm-12 col-md-12"},Vs={class:"form-floating my-2"},ws=["onUpdate:modelValue"],Ss={class:"col-sm-12 col-md-6 px-1"},xs={class:"block block-rounded border border-gray"},Us={class:"block-header bg-warning"},Is={class:"block-title"},Bs={class:"text-black"},Ds={class:"mx-2"},Es={class:"block-options"},Os=["onClick"],Ps={class:"block-content-sm mx-2"},$s={class:"row"},Ns={class:"col-sm-12 col-md-12"},js={class:"row"},Ys={class:"col-sm-12 col-md-12"},Ts={class:"col-sm-12 col-md-12"},Ls={class:"row"},Ms={class:"col-sm-12 col-md-12"},qs={class:"form-floating my-2"},As=["onUpdate:modelValue"],Rs={class:"col-sm-12 col-md-6 px-1"},Fs={class:"block block-rounded border border-gray"},Ks={class:"block-header bg-info"},zs={class:"block-title"},Gs={class:"text-black"},Hs={class:"mx-2"},Js={class:"block-options"},Qs=["onClick"],Ws={class:"block-content-sm mx-2"},Xs={class:"row"},Zs={class:"col-sm-12 col-md-12"},so={class:"row"},oo={class:"col-sm-12 col-md-12"},to={class:"col-sm-12 col-md-12"},eo={class:"row"},lo={class:"col-sm-12 col-md-12"},ao={class:"form-floating my-2"},no=["onUpdate:modelValue"],io={class:"col-sm-12 col-md-6 px-1"},ro={class:"block block-rounded border border-gray"},co={class:"block-header bg-light"},uo={class:"block-title"},mo={class:"text-black"},po={class:"mx-2"},bo={class:"block-options"},fo=["onClick"],ho={class:"block-content-sm mx-2"},vo={class:"row"},ko={class:"col-sm-12 col-md-12"},_o={class:"row"},yo={class:"col-sm-12 col-md-12"},go={class:"col-sm-12 col-md-12"},Co={class:"row"},Vo={class:"col-sm-12 col-md-12"},wo={class:"form-floating my-2"},So=["onUpdate:modelValue"],xo={class:"row"},Uo={class:"col-12 text-end"},Io={class:"row"},Bo={class:"col-6 text-end"},Do={class:"col-6 text-start"},Eo={class:"dropdown dropup"},Oo={"aria-labelledby":"dropdown-dropup-secondary",class:"border border-danger dropdown-menu",style:{}},Po={class:"container border border-danger rounded-2 my-3 p-3"},$o={class:"row"},No={class:"row"},jo={class:"col-12 border-bottom border-danger"},Yo={class:"text-danger"},To={class:"row"},Lo={class:"col-12 border-top border-danger"},Mo={class:"text-danger"};function qo(t,s,i,a,U,d){const B=f("loading"),D=f("date-picker"),E=f("mostdes"),O=f("quickAdd"),y=f("v-cob"),g=f("money3");return u(),m("div",T,[o("div",L,[o("h3",M,[o("button",{onClick:s[0]||(s[0]=l=>t.$router.back()),type:"button",class:"float-start d-none d-sm-none d-md-block btn btn-sm btn-link text-warning"},s[24]||(s[24]=[o("i",{class:"fa fw-bold fa-arrow-right"},null,-1)])),s[25]||(s[25]=n(" دریافت از اشخاص "))]),o("div",q,[o("button",{disabled:this.canSubmit!=!0,onClick:s[1]||(s[1]=l=>d.save()),type:"button",class:"btn btn-sm btn-alt-primary"},s[26]||(s[26]=[o("i",{class:"fa fa-save"},null,-1),n(" ثبت ")]),8,A)])]),o("div",R,[r(B,{color:"blue",loader:"dots",active:t.isLoading,"onUpdate:active":s[2]||(s[2]=l=>t.isLoading=l),"is-full-page":!1},null,8,["active"]),o("div",F,[o("div",K,[o("div",z,[r(D,{class:"form-control",modelValue:t.data.date,"onUpdate:modelValue":s[3]||(s[3]=l=>t.data.date=l),format:"jYYYY/jMM/jDD","display-format":"jYYYY/jMM/jDD",min:t.year.start,max:t.year.end},null,8,["modelValue","min","max"])]),s[28]||(s[28]=o("div",{class:"col-sm-12 col-md-6 mb-2"},[o("div",{class:"alert alert-sm alert-info"},[o("i",{class:"fa fa-info-circle me-2"}),n(" دکمه ثبت بعد از صفر بودن مبلغ باقی مانده فعال می شود ")])],-1)),o("div",G,[o("div",H,[o("div",J,[s[27]||(s[27]=o("h3",{class:"block-title text-primary"},[o("i",{class:"fa-regular fa-note-sticky"}),n(" شرح ")],-1)),o("div",Q,[r(E,{submitData:t.desSubmit,type:"personRecive"},null,8,["submitData"])])]),o("div",W,[v(o("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>t.data.des=l),class:"form-control",type:"text"},null,512),[[k,t.data.des]])])])])]),o("div",X,[(u(!0),m(C,null,V(t.persons,(l,c)=>(u(),m("div",Z,[o("div",ss,[o("div",os,[o("h3",ts,[o("small",es,[o("span",ls,p(c+1),1),s[29]||(s[29]=o("i",{class:"fa fa-user"},null,-1)),s[30]||(s[30]=n(" مشخصات شخص "))])]),o("span",as,[r(O,{code:0}),o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:e=>d.removePerson(c)},s[31]||(s[31]=[o("i",{class:"fa fa-trash"},null,-1)]),8,ds)])]),o("div",ns,[o("div",is,[o("div",rs,[o("div",cs,[o("div",us,[s[36]||(s[36]=o("small",{class:"mb-2"},"شخص",-1)),r(y,{dir:"rtl",onSearch:d.searchPerson,options:t.listPersons,label:"nikename",modelValue:l.id,"onUpdate:modelValue":e=>l.id=e,"onOption:deselecting":s[5]||(s[5]=e=>d.funcCanSubmit()),"onOption:selecting":s[6]||(s[6]=e=>d.funcCanSubmit())},{"no-options":_(({search:e,searching:S,loading:x})=>s[32]||(s[32]=[n(" نتیجه‌ای یافت نشد! ")])),option:_(e=>[o("div",ms,[o("div",ps,[s[33]||(s[33]=o("i",{class:"fa fa-user me-2"},null,-1)),n(" "+p(e.nikename),1)]),o("div",bs,[o("div",fs,[o("div",hs,[s[34]||(s[34]=o("i",{class:"fa fa-phone me-2"},null,-1)),n(" "+p(e.mobile),1)]),o("div",vs,[s[35]||(s[35]=o("i",{class:"fa fa-bars"},null,-1)),n(" تراز: "+p(t.$filters.formatNumber(Math.abs(parseInt(e.bs)-parseInt(e.bd))))+" ",1),parseInt(e.bs)-parseInt(e.bd)<0?(u(),m("span",ks," بدهکار ")):I("",!0),parseInt(e.bs)-parseInt(e.bd)>0?(u(),m("span",_s," بستانکار ")):I("",!0)])])])])]),_:2},1032,["onSearch","options","modelValue","onUpdate:modelValue"])]),o("div",ys,[s[37]||(s[37]=o("small",{class:"mb-2"},"مبلغ",-1)),r(g,w({onChange:s[7]||(s[7]=e=>d.calc()),class:"form-control",modelValue:l.amount,"onUpdate:modelValue":e=>l.amount=e,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])])])]),o("div",gs,[o("div",Cs,[o("div",Vs,[v(o("input",{"onUpdate:modelValue":e=>l.des=e,type:"text",class:"form-control"},null,8,ws),[[k,l.des]]),s[38]||(s[38]=o("label",null,"شرح",-1))])])])])])]))),256)),(u(!0),m(C,null,V(t.banks,(l,c)=>(u(),m("div",Ss,[o("div",xs,[o("div",Us,[o("h3",Is,[o("small",Bs,[o("span",Ds,p(c+1),1),s[39]||(s[39]=o("i",{class:"fa fa-bank"},null,-1)),s[40]||(s[40]=n(" حساب بانکی "))])]),o("span",Es,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:e=>d.removeBank(c)},s[41]||(s[41]=[o("i",{class:"fa fa-trash"},null,-1)]),8,Os)])]),o("div",Ps,[o("div",$s,[o("div",Ns,[o("div",js,[o("div",Ys,[s[43]||(s[43]=o("small",{class:"mb-2"},"بانک",-1)),r(y,{dir:"rtl",options:t.listBanks,label:"name",modelValue:l.id,"onUpdate:modelValue":e=>l.id=e,"onOption:deselecting":s[8]||(s[8]=e=>d.funcCanSubmit()),"onSearch:focus":s[9]||(s[9]=e=>d.funcCanSubmit()),"onOption:selecting":s[10]||(s[10]=e=>d.funcCanSubmit())},{"no-options":_(({search:e,searching:S,loading:x})=>s[42]||(s[42]=[n(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",Ts,[s[44]||(s[44]=o("small",{class:"mb-2"},"مبلغ",-1)),r(g,w({onChange:s[11]||(s[11]=e=>d.calc()),class:"form-control",modelValue:l.amount,"onUpdate:modelValue":e=>l.amount=e,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])])])]),o("div",Ls,[o("div",Ms,[o("div",qs,[v(o("input",{"onUpdate:modelValue":e=>l.des=e,type:"text",class:"form-control"},null,8,As),[[k,l.des]]),s[45]||(s[45]=o("label",null,"شرح",-1))])])])])])]))),256)),(u(!0),m(C,null,V(t.salarys,(l,c)=>(u(),m("div",Rs,[o("div",Fs,[o("div",Ks,[o("h3",zs,[o("small",Gs,[o("span",Hs,p(c+1),1),s[46]||(s[46]=o("i",{class:"fa fa-dot-circle"},null,-1)),s[47]||(s[47]=n(" تنخواه گردان "))])]),o("span",Js,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:e=>d.removeSalary(c)},s[48]||(s[48]=[o("i",{class:"fa fa-trash"},null,-1)]),8,Qs)])]),o("div",Ws,[o("div",Xs,[o("div",Zs,[o("div",so,[o("div",oo,[s[50]||(s[50]=o("small",{class:"mb-2"},"تنخواه گردان",-1)),r(y,{dir:"rtl",options:t.listSalarys,label:"name",modelValue:l.id,"onUpdate:modelValue":e=>l.id=e,"onOption:deselecting":s[12]||(s[12]=e=>d.funcCanSubmit()),"onSearch:focus":s[13]||(s[13]=e=>d.funcCanSubmit()),"onOption:selecting":s[14]||(s[14]=e=>d.funcCanSubmit())},{"no-options":_(({search:e,searching:S,loading:x})=>s[49]||(s[49]=[n(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",to,[s[51]||(s[51]=o("small",{class:"mb-2"},"مبلغ",-1)),r(g,w({onChange:s[15]||(s[15]=e=>d.calc()),class:"form-control",modelValue:l.amount,"onUpdate:modelValue":e=>l.amount=e,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])])])]),o("div",eo,[o("div",lo,[o("div",ao,[v(o("input",{"onUpdate:modelValue":e=>l.des=e,type:"text",class:"form-control"},null,8,no),[[k,l.des]]),s[52]||(s[52]=o("label",null,"شرح",-1))])])])])])]))),256)),(u(!0),m(C,null,V(t.cashdesks,(l,c)=>(u(),m("div",io,[o("div",ro,[o("div",co,[o("h3",uo,[o("small",mo,[o("span",po,p(c+1),1),s[53]||(s[53]=o("i",{class:"fa fa-money-bill-wheat"},null,-1)),s[54]||(s[54]=n(" صندوق "))])]),o("span",bo,[o("button",{title:"حذف",class:"btn-block-option text-danger ps-2",onClick:e=>d.removeCashdesk(c)},s[55]||(s[55]=[o("i",{class:"fa fa-trash"},null,-1)]),8,fo)])]),o("div",ho,[o("div",vo,[o("div",ko,[o("div",_o,[o("div",yo,[s[57]||(s[57]=o("small",{class:"mb-2"},"صندوق",-1)),r(y,{dir:"rtl",options:t.listCashdesks,label:"name",modelValue:l.id,"onUpdate:modelValue":e=>l.id=e,"onOption:deselecting":s[16]||(s[16]=e=>d.funcCanSubmit()),"onSearch:focus":s[17]||(s[17]=e=>d.funcCanSubmit()),"onOption:selecting":s[18]||(s[18]=e=>d.funcCanSubmit())},{"no-options":_(({search:e,searching:S,loading:x})=>s[56]||(s[56]=[n(" نتیجه‌ای یافت نشد! ")])),_:2},1032,["options","modelValue","onUpdate:modelValue"])]),o("div",go,[s[58]||(s[58]=o("small",{class:"mb-2"},"مبلغ",-1)),r(g,w({onChange:s[19]||(s[19]=e=>d.calc()),class:"form-control",modelValue:l.amount,"onUpdate:modelValue":e=>l.amount=e,ref_for:!0},t.currencyConfig),null,16,["modelValue","onUpdate:modelValue"])])])])]),o("div",Co,[o("div",Vo,[o("div",wo,[v(o("input",{"onUpdate:modelValue":e=>l.des=e,type:"text",class:"form-control"},null,8,So),[[k,l.des]]),s[59]||(s[59]=o("label",null,"شرح",-1))])])])])])]))),256))]),o("div",xo,[o("div",Uo,[o("div",Io,[o("div",Bo,[o("button",{onClick:s[20]||(s[20]=l=>d.addPerson()),class:"btn btn-primary mx-1"},s[60]||(s[60]=[o("i",{class:"fa fa-plus"},null,-1),n(" افزودن شخص ")]))]),o("div",Do,[o("div",Eo,[s[64]||(s[64]=o("button",{"aria-expanded":"false","aria-haspopup":"true",class:"btn btn-danger dropdown-toggle","data-bs-toggle":"dropdown",id:"dropdown-dropup-secondary",type:"button"}," افزودن حساب ",-1)),o("div",Oo,[o("button",{onClick:s[21]||(s[21]=l=>d.addBank()),type:"button",class:"dropdown-item"},s[61]||(s[61]=[o("i",{class:"fa fa-bank"},null,-1),n(" حساب بانکی ")])),o("button",{onClick:s[22]||(s[22]=l=>d.addCashdesk()),type:"button",class:"dropdown-item",href:"javascript:void(0)"},s[62]||(s[62]=[o("i",{class:"fa fa-money-bill-wheat"},null,-1),n(" صندوق ")])),o("button",{onClick:s[23]||(s[23]=l=>d.addSalary()),type:"button",class:"dropdown-item",href:"javascript:void(0)"},s[63]||(s[63]=[o("i",{class:"fa fa-dot-circle"},null,-1),n(" تنخواه گردان ")]))])])])])])]),o("div",Po,[o("div",$o,[o("div",No,[o("div",jo,[s[65]||(s[65]=n(" مجموع دریافت‌ها: ")),o("span",Yo,p(t.$filters.formatNumber(t.sum)),1)])]),o("div",To,[o("div",Lo,[s[66]||(s[66]=n(" باقی‌مانده: ")),o("span",Mo,p(t.$filters.formatNumber(t.balance)),1)])])])])])])])}const Go=P(Y,[["render",qo]]);export{Go as default};
